<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Comment dire Â« Comme Â» en corÃ©en | ê°™ì•„ìš” Â· ì²˜ëŸ¼ Â· ê°™ì´ Â· ê°™ì€</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body{font-family:'Inter',sans-serif;background:#f0f4f8;color:#0f172a}
    .korean-font{font-family:'Gowun Dodum',sans-serif}
    .card{background:#fff;border-radius:1rem;padding:1.5rem;box-shadow:0 4px 6px -1px rgb(0 0 0 / 0.1),0 2px 4px -2px rgb(0 0 0 / 0.1)}
    .btn{display:inline-block;padding:.5rem 1rem;border-radius:.75rem;font-weight:600;text-align:center;cursor:pointer;transition:all .2s;border:2px solid transparent}
    .btn-secondary{background:#f3f4f6;color:#374151;border-color:#e5e7eb}
    .btn-secondary:hover:not(:disabled){background:#e5e7eb}
    .btn-primary{background:#2563eb;color:#fff;border-color:#1d4ed8}
    .btn-primary:hover:not(:disabled){background:#1d4ed8}
    .btn.selected{background:#dbeafe;border-color:#93c5fd;color:#1e40af}
    .btn:disabled{opacity:.7;cursor:not-allowed}
    .exercise-item{padding:1.5rem;border:1px solid #e5e7eb;border-radius:1rem;margin-bottom:1.5rem;background:#fff;transition:background-color .3s}
    .feedback{padding:1rem;border-radius:.75rem;margin-top:1rem}
    .feedback.correct{background:#dcfce7;color:#166534}
    .feedback.incorrect{background:#fee2e2;color:#991b1b}
    .feedback.soft{background:#fef9c3;color:#854d0e} /* ì˜ë¯¸ ì¼ì¹˜(ë¶€ë¶„ í¬í•¨/ê²½ë¯¸ì°¨ì´) â†’ ì •ë‹µ ì²˜ë¦¬ + ì•ˆë‚´ */
    .made-by-top,.made-by-bottom{ text-align:center; padding:.5rem; color:#475569; font-size:.875rem }
    .made-by-top{ border-bottom:1px solid #e5e7eb }
    .made-by-bottom{ border-top:1px solid #e5e7eb; margin-top:2rem }
    .print-btn{ position:sticky; top:.75rem; float:right; margin-top:-.5rem }
  </style>
</head>

<body class="text-slate-800">
  <div class="container mx-auto p-4 md:p-8 max-w-4xl">
    <!-- ìƒë‹¨ í¬ë ˆë”§ + ì¸ì‡„ -->
    <div class="made-by-top">
      made by ì„±ì¼, Pongdang Â·
      <a href="mailto:Lapeace29@gmail.com" class="underline">Lapeace29@gmail.com</a>
      Â· <button onclick="window.print()" class="btn btn-secondary print-btn">ğŸ–¨ï¸ Imprimer</button>
    </div>

    <!-- Header -->
    <header class="text-center mb-8">
      <h1 class="text-4xl md:text-5xl font-bold text-blue-600 mb-2">Comme en CorÃ©en (2-Ã‰tapes) ğŸ‡°ğŸ‡·</h1>
      <p class="text-lg text-slate-600">Apprends Ã  utiliser ê°™ì•„ìš”, ì²˜ëŸ¼, ê°™ì´, et ê°™ì€ !</p>
    </header>

    <!-- Exercises Section -->
    <section id="exercises">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-3xl font-bold text-slate-700">Exercices (20)</h2>
        <button id="reset-btn" class="btn btn-secondary">Recommencer</button>
      </div>
      <div id="exercise-list"></div>
    </section>

    <!-- í•˜ë‹¨ í¬ë ˆë”§ -->
    <div class="made-by-bottom">
      made by ì„±ì¼, Pongdang Â· <a href="mailto:Lapeace29@gmail.com" class="underline">Lapeace29@gmail.com</a>
    </div>
  </div>

  <script>
  /* ===== ì •ê·œí™” & ê´€ëŒ€í•œ ì±„ì  ìœ í‹¸ ===== */
  function normalizeKo(s=''){
    return s
      .replace(/\s+/g,'')                                // ëª¨ë“  ê³µë°± ì œê±°
      .replace(/[.,!?;:'"â€œâ€â€˜â€™()[\]Â·\-â€“â€”~â€¦]/g,'');        // ë¬¸ì¥ë¶€í˜¸ ì œê±°
  }
  function stripYo(s=''){ return s.replace(/ìš”$/,''); }

  // í¸ì§‘ê±°ë¦¬(ë ˆë²¤ìŠˆíƒ€ì¸)
  function levenshtein(a,b){
    const m=a.length,n=b.length;
    if(m===0) return n; if(n===0) return m;
    const dp=new Array(n+1);
    for(let j=0;j<=n;j++) dp[j]=j;
    for(let i=1;i<=m;i++){
      let prev=dp[0]; dp[0]=i;
      for(let j=1;j<=n;j++){
        const tmp=dp[j];
        dp[j]=Math.min(
          dp[j]+1,               // ì‚­ì œ
          dp[j-1]+1,             // ì‚½ì…
          prev + (a[i-1]===b[j-1]?0:1) // ì¹˜í™˜
        );
        prev=tmp;
      }
    }
    return dp[n];
  }

  // â€˜ë¶€ë¶„ í¬í•¨â€™, ê³µë°±/ë§ˆì¹¨í‘œ ë¬´ì‹œ, â€˜ìš”â€™ ìœ ë¬´/ê²½ë¯¸ ì˜¤íƒ€ í—ˆìš©
  function classifyFill(userRaw, fillAnswer){
    const targetsRaw = fillAnswer.split('/').map(v=>v.trim());
    const userN = normalizeKo(userRaw);
    const targetsN = targetsRaw.map(normalizeKo);
    const targetsNoYo = targetsRaw.map(v=>normalizeKo(stripYo(v)));

    // ì™„ì „ ì¼ì¹˜
    if (targetsN.includes(userN)) {
      return { correct:true, perfect:true, reason:null, ref: targetsRaw[targetsN.indexOf(userN)] };
    }
    // 'ìš”' ìœ ë¬´ë§Œ ë‹¤ë¦„
    if (targetsNoYo.includes(normalizeKo(stripYo(userRaw)))) {
      const idx = targetsNoYo.indexOf(normalizeKo(stripYo(userRaw)));
      return { correct:true, perfect:false, reason:"â€˜ìš”â€™ ìœ ë¬´ë§Œ ë‹¬ë¼ìš”.", ref: targetsRaw[idx] };
    }
    // í•™ìƒë‹µ ì•ˆì— ì •ë‹µ í˜•íƒœ 'ë¶€ë¶„ í¬í•¨'
    for (let k=0; k<targetsN.length; k++){
      if (userN.includes(targetsN[k])) {
        return { correct:true, perfect:false, reason:"ì •ë‹µ í˜•íƒœê°€ í•™ìƒ ë‹µ ì•ˆì— í¬í•¨ë˜ì–´ ìˆì–´ìš”.", ref: targetsRaw[k] };
      }
    }
    // ê²½ë¯¸ ì˜¤íƒ€(í¸ì§‘ê±°ë¦¬ â‰¤1)
    const dists = targetsN.map(t => levenshtein(userN, t));
    const minDist = Math.min(...dists);
    if (minDist <= 1) {
      const idx = dists.indexOf(minDist);
      return { correct:true, perfect:false, reason:"ì•„ì£¼ ì‚¬ì†Œí•œ ì² ì/ë„ì–´ì“°ê¸° ì°¨ì´.", ref: targetsRaw[idx] };
    }
    // ì˜¤ë‹µ
    return { correct:false, perfect:false, reason:null, ref: targetsRaw[0] };
  }

  /* ===== ë§íˆ¬(ë†’ì„) íŒì • ìœ í‹¸ ===== */
  function getPronounClass(text=''){
    if (/ì €ëŠ”|ì „/.test(text)) return 'polite';   // ìš”/ìŠµë‹ˆë‹¤ ê³„ì—´
    if (/ë‚˜ëŠ”|ë‚œ/.test(text)) return 'casual';   // ì•„/ì–´(í•´ì²´)
    return 'neutral';
  }
  function getEndingStyle(text=''){
    const tail = (text || '').trim().replace(/[\s\n]+/g,' ');
    if (/(ìŠµë‹ˆë‹¤|ã…‚ë‹ˆë‹¤|ìŠµë‹ˆê¹Œ\??)[.!?]?$/.test(tail)) return 'deferential';
    if (/ìš”[.!?]?$/.test(tail)) return 'haeyo';
    if (/(ì•„|ì–´)[.!?]?$/.test(tail)) return 'haeche';
    if (/ë‹¤[.!?]?$/.test(tail)) return 'plain';
    return 'unknown';
  }
  function suggestRefByPoliteness(ex, pronounClass, currentRef){
    if (ex.typeAnswer !== 'etre') return currentRef; // 'ê°™ì•„ìš”/ê°™ì•„' ëŒ€ìƒë§Œ
    if (pronounClass === 'casual') return currentRef.replace(/ê°™ì•„ìš”$/, 'ê°™ì•„');
    if (pronounClass === 'polite') return currentRef.replace(/ê°™ì•„$/, 'ê°™ì•„ìš”');
    return currentRef;
  }
  function checkPolitenessConsistency(fullSentence, ex, userFillRaw){
    const p = getPronounClass(fullSentence);
    const e = getEndingStyle(fullSentence);
    const fillHasYo = /ìš”$/.test((userFillRaw||'').trim());
    const fillHaeche = /(ì•„|ì–´)$/.test((userFillRaw||'').trim());

    // 1) ë‚˜ëŠ”/ë‚œ â†’ -ìš”/-(ìŠ¤)ã…‚ë‹ˆë‹¤ ê¸ˆì§€
    if (p==='casual' && (e==='haeyo' || e==='deferential' || fillHasYo)) {
      return { ok:false, reason:"â€˜ë‚˜ëŠ”/ë‚œâ€™ì—ëŠ” -ìš”/-ìŠµë‹ˆë‹¤ ë§íˆ¬ë¥¼ ì“°ì§€ ì•Šì•„ìš”. (í•´ì²´ë¡œ)", target:'casual' };
    }
    // 2) ì €ëŠ”/ì „ â†’ -ì•„/ì–´(í•´ì²´) ê¸ˆì§€
    if (p==='polite' && (e==='haeche' || fillHaeche)) {
      return { ok:false, reason:"â€˜ì €ëŠ”/ì „â€™ì—ëŠ” -ì•„/ì–´(í•´ì²´)ë¥¼ ì“°ì§€ ì•Šì•„ìš”. (-ìš”/-ìŠµë‹ˆë‹¤)", target:'polite' };
    }
    return { ok:true };
  }

  /* ===== ì˜¤ë””ì˜¤(TTS) ìœ í‹¸ ===== */
  function base64ToBlob(base64, mime='audio/wav'){
    const bin = atob(base64); const len = bin.length;
    const bytes = new Uint8Array(len);
    for(let i=0;i<len;i++) bytes[i]=bin.charCodeAt(i);
    return new Blob([bytes], {type:mime});
  }
  async function playAudioTTS(text, voice='man'){
    try{
      const r = await fetch('/.netlify/functions/generate-audio',{
        method:'POST', headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ text, voice })
      });
      const j = await r.json();
      if(!j?.audioData) throw new Error(j?.error || 'TTS error');
      const blob = base64ToBlob(j.audioData, j.mimeType || 'audio/wav');
      const url = URL.createObjectURL(blob);
      const audio = new Audio(url);
      audio.addEventListener('ended', ()=> URL.revokeObjectURL(url), { once:true });
      audio.play();
      return true;
    }catch(e){
      console.error(e);
      return false;
    }
  }

  function hint2Text(ex){
    if (ex.typeAnswer === 'verbe') return "Action(ë™ì‚¬) â†’ â€˜ì²˜ëŸ¼/ê°™ì´â€™ (ex: ë°”ëŒì²˜ëŸ¼ ë‹¬ë ¤ìš”).";
    if (ex.typeAnswer === 'nom')   return "Nom(ëª…ì‚¬ ê¾¸ë°ˆ) â†’ â€˜ê°™ì€â€™ (ex: ì¸í˜• ê°™ì€ ì•„ì´).";
    return "ÃŠtre comme(ì´ë‹¤) â†’ â€˜ê°™ì•„ìš”â€™ (ex: ì˜¤ëŠ˜ì€ ì–´ì œ ê°™ì•„ìš”).";
  }
  function firstAnswer(ex){ return ex.fillAnswer.split('/')[0].trim(); }
  function buildSentence(ex, userAns){
    const ans = (userAns && userAns.trim()) ? userAns.trim() : firstAnswer(ex);
    const mid = ex.koreanParts[0].trimEnd(), tail = ex.koreanParts[1].trimStart();
    return `${mid} ${ans}${tail}`.replace(/\s+/g,' ').trim();
  }

  document.addEventListener('DOMContentLoaded', () => {
    const exercises = [
      { french:"Ce bÃ©bÃ© est comme un ange.", vocab:[{fr:"bÃ©bÃ©",ko:"ì•„ê¸°"},{fr:"ange",ko:"ì²œì‚¬"}], typeAnswer:"etre",  koreanParts:["ì´ ì•„ê¸°ëŠ” ì²œì‚¬","."],           fillAnswer:"ê°™ì•„ìš”",      chosungHint:"ã…‡ ã…‡ã„±ã„´ ã…Šã…… ã„±ã…‡ã…‡." },
      { french:"Le temps est comme de l'or.", vocab:[{fr:"temps",ko:"ì‹œê°„"},{fr:"or",ko:"ê¸ˆ"}],     typeAnswer:"etre",  koreanParts:["ì‹œê°„ì€ ê¸ˆ","."],               fillAnswer:"ê°™ì•„ìš”",      chosungHint:"ã……ã„±ã…‡ ã„± ã„±ã…‡ã…‡." },
      { french:"C'est une amie comme ma famille.", vocab:[{fr:"amie",ko:"ì¹œêµ¬"},{fr:"famille",ko:"ê°€ì¡±"}], typeAnswer:"nom", koreanParts:["ê°€ì¡±"," ì¹œêµ¬ì˜ˆìš”."],       fillAnswer:"ê°™ì€",       chosungHint:"ã„±ã…ˆ ã„±ã…‡ ã…Šã„±ã…‡ã…‡." },
      { french:"J'ai un ami comme un frÃ¨re.", vocab:[{fr:"ami",ko:"ì¹œêµ¬"},{fr:"frÃ¨re",ko:"í˜•ì œ"}],  typeAnswer:"nom",   koreanParts:["í˜•ì œ"," ì¹œêµ¬ê°€ ìˆì–´ìš”."],     fillAnswer:"ê°™ì€",       chosungHint:"ã…ã…ˆ ã„±ã…‡ ã…Šã„±ã„± ã…‡ã…‡ã…‡." },
      { french:"Il court comme le vent.", vocab:[{fr:"courir",ko:"ë‹¬ë¦¬ë‹¤"},{fr:"vent",ko:"ë°”ëŒ"}], typeAnswer:"verbe", koreanParts:["ë°”ëŒ"," ë‹¬ë ¤ìš”."],              fillAnswer:"ì²˜ëŸ¼/ê°™ì´",  chosungHint:"ã…‚ã„¹ã…  ã…Šã„¹ ã„·ã„¹ã…‡." },
      { french:"Elle chante comme une sirÃ¨ne.", vocab:[{fr:"chanter",ko:"ë…¸ë˜í•˜ë‹¤"},{fr:"sirÃ¨ne",ko:"ì¸ì–´"}], typeAnswer:"verbe", koreanParts:["ì¸ì–´"," ë…¸ë˜í•´ìš”."], fillAnswer:"ì²˜ëŸ¼/ê°™ì´",  chosungHint:"ã…‡ã…‡  ã…Šã„¹ ã„´ã„¹ã…ã…‡." },
      { french:"Ceci est comme un rÃªve.", vocab:[{fr:"ceci",ko:"ì´ê²ƒ"},{fr:"rÃªve",ko:"ê¿ˆ"}],       typeAnswer:"etre",  koreanParts:["ì´ê±´ ê¿ˆ","."],                 fillAnswer:"ê°™ì•„ìš”",      chosungHint:"ã…‡ã„± ã„² ã„±ã…‡ã…‡." },
      { french:"C'est une femme comme un renard.", vocab:[{fr:"femme",ko:"ì—¬ì"},{fr:"renard",ko:"ì—¬ìš°"}], typeAnswer:"nom", koreanParts:["ì—¬ìš°"," ì—¬ìì˜ˆìš”."],   fillAnswer:"ê°™ì€",       chosungHint:"ã…‡ã…‡ ã„±ã…‡ ã…‡ã…ˆã…‡ã…‡." },
      { french:"Il danse comme un professionnel.", vocab:[{fr:"danser",ko:"ì¶¤ì¶”ë‹¤"},{fr:"professionnel",ko:"ì „ë¬¸ê°€"}], typeAnswer:"verbe", koreanParts:["ì „ë¬¸ê°€"," ì¶¤ì„ ì¶°ìš”."], fillAnswer:"ì²˜ëŸ¼/ê°™ì´",  chosungHint:"ã…ˆã…ã„±  ã…Šã„¹ ã…Šã…‡ ã…Šã…‡." },
      { french:"Aujourd'hui est comme hier.", vocab:[{fr:"aujourd'hui",ko:"ì˜¤ëŠ˜"},{fr:"hier",ko:"ì–´ì œ"}], typeAnswer:"etre", koreanParts:["ì˜¤ëŠ˜ì€ ì–´ì œ","."],      fillAnswer:"ê°™ì•„ìš”",      chosungHint:"ã…‡ã„´ã…‡ ã…‡ã…ˆ ã„±ã…‡ã…‡." },
      { french:"C'est un cadeau comme un trÃ©sor.", vocab:[{fr:"cadeau",ko:"ì„ ë¬¼"},{fr:"trÃ©sor",ko:"ë³´ë¬¼"}], typeAnswer:"nom", koreanParts:["ë³´ë¬¼"," ì„ ë¬¼ì´ì—ìš”."], fillAnswer:"ê°™ì€",       chosungHint:"ã…‚ã… ã„±ã…‡ ã……ã…ã…‡ã…‡ã…‡." },
      { french:"Elle parle comme un poÃ¨te.", vocab:[{fr:"parler",ko:"ë§í•˜ë‹¤"},{fr:"poÃ¨te",ko:"ì‹œì¸"}], typeAnswer:"verbe", koreanParts:["ì‹œì¸"," ë§í•´ìš”."],     fillAnswer:"ì²˜ëŸ¼/ê°™ì´",  chosungHint:"ã……ã…‡  ã…Šã„¹ ã…ã…ã…‡." },
      { french:"Un coeur large comme la mer.", vocab:[{fr:"coeur",ko:"ë§ˆìŒ"},{fr:"mer",ko:"ë°”ë‹¤"}], typeAnswer:"nom",   koreanParts:["ë°”ë‹¤"," ë„“ì€ ë§ˆìŒ."],          fillAnswer:"ê°™ì€",       chosungHint:"ã…‚ã„· ã„±ã…‡ ã„´ã…‡ ã…ã…‡." },
      { french:"Il dort comme un ours.", vocab:[{fr:"dormir",ko:"ìë‹¤"},{fr:"ours",ko:"ê³°"}],      typeAnswer:"verbe", koreanParts:["ê³°"," ììš”."],                fillAnswer:"ì²˜ëŸ¼/ê°™ì´",  chosungHint:"ã„±ã…  ã…Šã„¹ ã…ˆã…‡." },
      { french:"Un enfant comme une poupÃ©e.", vocab:[{fr:"enfant",ko:"ì•„ì´"},{fr:"poupÃ©e",ko:"ì¸í˜•"}], typeAnswer:"nom", koreanParts:["ì¸í˜•"," ì•„ì´."],         fillAnswer:"ê°™ì€",       chosungHint:"ã…‡ã… ã„±ã…‡ ã…‡ã…‡." },
      { french:"Il marche comme un robot.", vocab:[{fr:"marcher",ko:"ê±·ë‹¤"},{fr:"robot",ko:"ë¡œë´‡"}], typeAnswer:"verbe", koreanParts:["ë¡œë´‡"," ê±¸ì–´ìš”."],      fillAnswer:"ì²˜ëŸ¼/ê°™ì´",  chosungHint:"ã„¹ã…‚ã……  ã…Šã„¹ ã„±ã…‡ã…‡." },
      { french:"Une voix douce comme le sucre.", vocab:[{fr:"voix",ko:"ëª©ì†Œë¦¬"},{fr:"sucre",ko:"ì„¤íƒ•"}], typeAnswer:"nom", koreanParts:["ì„¤íƒ•"," ëª©ì†Œë¦¬."],     fillAnswer:"ê°™ì€",       chosungHint:"ã……ã…Œ ã„±ã…‡ ã…ã……ã„¹." },
      { french:"Il est lent comme une tortue.", vocab:[{fr:"lent",ko:"ëŠë¦¬ë‹¤"},{fr:"tortue",ko:"ê±°ë¶ì´"}], typeAnswer:"verbe", koreanParts:["ê±°ë¶ì´"," ëŠë ¤ìš”."], fillAnswer:"ì²˜ëŸ¼/ê°™ì´",  chosungHint:"ã„±ã…‚ã…‡  ã…Šã„¹ ã„´ã„¹ã…‡." },
      { french:"Cette personne est comme un acteur.", vocab:[{fr:"personne",ko:"ì‚¬ëŒ"},{fr:"acteur",ko:"ë°°ìš°"}], typeAnswer:"etre", koreanParts:["ì´ ì‚¬ëŒì€ ë°°ìš°","."], fillAnswer:"ê°™ì•„ìš”", chosungHint:"ã…‡ ã……ã„¹ã…‡ ã…‚ã…‡ ã„±ã…‡ã…‡." },
      { french:"Il dÃ©pense de l'argent comme de l'eau.", vocab:[{fr:"dÃ©penser",ko:"ëˆì„ ì“°ë‹¤"},{fr:"eau",ko:"ë¬¼"}], typeAnswer:"verbe", koreanParts:["ë¬¼"," ëˆì„ ì¨ìš”."], fillAnswer:"ì²˜ëŸ¼/ê°™ì´", chosungHint:"ã…ã„¹  ã…Šã„¹ ã„·ã…‡ ã…†ã…‡." }
    ];

    const exerciseListContainer = document.getElementById('exercise-list');
    const resetBtn = document.getElementById('reset-btn');

    function renderExercises(){
      exerciseListContainer.innerHTML = '';
      exercises.forEach((ex, index) => {
        const exerciseEl = document.createElement('div');
        exerciseEl.className = 'exercise-item';
        exerciseEl.id = `ex-${index}`;

        const vocabList = ex.vocab.map(v => `<li class="text-sm"><span class="font-semibold">${v.fr}</span>: <span class="korean-font">${v.ko}</span></li>`).join('');

        exerciseEl.innerHTML = `
          <div class="flex items-start">
            <span class="text-xl font-bold text-blue-500 mr-4">${index+1}.</span>
            <div class="w-full">
              <p class="font-semibold text-lg text-slate-800 mb-2">"${ex.french}"</p>
              <ul class="list-disc list-inside bg-slate-50 p-2 rounded-md mb-4">${vocabList}</ul>

              <!-- Step 1 -->
              <div class="mb-4">
                <p class="font-semibold text-slate-700 mb-2">1. Quel est le type de la phrase ?</p>
                <div class="flex flex-wrap gap-2 type-options">
                  <button data-type="verbe" class="btn btn-secondary">Action (Verbe) ğŸƒâ€â™‚ï¸</button>
                  <button data-type="nom" class="btn btn-secondary">Objet (Nom) âœï¸</button>
                  <button data-type="etre" class="btn btn-secondary">Identification (ÃŠtre comme) ğŸ™‹â€â™€ï¸</button>
                </div>
              </div>

              <!-- Step 2 -->
              <div>
                <p class="font-semibold text-slate-700 mb-2">2. ComplÃ©tez la phrase en corÃ©en.</p>
                <div class="flex items-center gap-2">
                  <p class="korean-font text-xl">${ex.koreanParts[0]}</p>
                  <input type="text" class="korean-font text-xl p-2 border-2 border-slate-300 rounded-lg w-48 focus:border-blue-500 focus:ring-blue-500 transition ans-input" placeholder="RÃ©ponse">
                  <p class="korean-font text-xl">${ex.koreanParts[1]}</p>
                  <button class="ml-auto btn btn-secondary listen-btn" title="Ã‰coute">ğŸ”Š Ã‰coute</button>
                </div>

                <div class="flex gap-3 mt-2">
                  <button class="text-sm text-blue-600 hover:underline hint1-btn">Astuce 1 â€” ì´ˆì„± (Aidez-moi ğŸ™)</button>
                  <button class="text-sm text-rose-600 hover:underline hint2-btn">Astuce 2 â€” íŒíŠ¸ (Au secours ğŸ¦º)</button>
                </div>

                <p class="text-sm text-amber-700 korean-font mt-1 hint1-text hidden"></p>
                <p class="text-sm text-rose-700 mt-1 hint2-text hidden"></p>
              </div>

              <div class="mt-4 border-t pt-4">
                <button class="btn btn-primary w-full check-btn">VÃ©rifier</button>
              </div>
              <div class="feedback mt-4 hidden"></div>
            </div>
          </div>
        `;
        exerciseListContainer.appendChild(exerciseEl);
      });
      addEventListeners();
    }

    function addEventListeners(){
      // íƒ€ì… ì„ íƒ í† ê¸€
      document.querySelectorAll('.type-options button').forEach(btn=>{
        btn.addEventListener('click', e=>{
          const parent=e.currentTarget.parentElement;
          parent.querySelectorAll('button').forEach(b=>b.classList.remove('selected'));
          e.currentTarget.classList.add('selected');
        });
      });

      // íŒíŠ¸ 1: ì´ˆì„±
      document.querySelectorAll('.hint1-btn').forEach((button,index)=>{
        button.addEventListener('click',()=>{
          const hintText = document.querySelector(`#ex-${index} .hint1-text`); 
          hintText.textContent = exercises[index].chosungHint;
          hintText.classList.remove('hidden'); button.disabled=true;
        });
      });

      // íŒíŠ¸ 2: ê°œë…(íƒ€ì…ë³„ ì„ íƒ ê°€ì´ë“œ)
      document.querySelectorAll('.hint2-btn').forEach((button,index)=>{
        button.addEventListener('click',()=>{
          const hintText = document.querySelector(`#ex-${index} .hint2-text`);
          hintText.textContent = hint2Text(exercises[index]);
          hintText.classList.remove('hidden'); button.disabled=true;
        });
      });

      // ì˜¤ë””ì˜¤
      document.querySelectorAll('.listen-btn').forEach((button,index)=>{
        button.addEventListener('click', async ()=>{
          const ex = exercises[index];
          const input = document.querySelector(`#ex-${index} .ans-input`);
          const sentence = buildSentence(ex, input?.value);
          await playAudioTTS(sentence, 'man'); // í•„ìš”ì‹œ 'woman' ì‚¬ìš©
        });
      });

      // Enterë¡œ ì±„ì 
      document.querySelectorAll('.ans-input').forEach((inp,index)=>{
        inp.addEventListener('keydown',(e)=>{ if(e.key==='Enter') handleCheck(index); });
      });

      // ì±„ì  ë²„íŠ¼
      document.querySelectorAll('.check-btn').forEach((button,index)=>{
        button.addEventListener('click',()=>handleCheck(index));
      });

      // ë¦¬ì…‹
      resetBtn.addEventListener('click', renderExercises);
    }

    function handleCheck(index){
      const exerciseEl = document.getElementById(`ex-${index}`);
      const ex = exercises[index];
      const feedbackEl = exerciseEl.querySelector('.feedback');

      // Step 1: íƒ€ì…
      const selectedTypeBtn = exerciseEl.querySelector('.type-options .selected');
      const typeAnswer = selectedTypeBtn ? selectedTypeBtn.dataset.type : null;
      const isTypeCorrect = typeAnswer === ex.typeAnswer;

      // Step 2: ì±„ìš°ê¸°
      const inputEl = exerciseEl.querySelector('.ans-input');
      const userFill = (inputEl.value||'').trim();
      const judged = classifyFill(userFill, ex.fillAnswer);

      // ë¬¸ì¥ êµ¬ì„±(í•™ìƒ ì…ë ¥ ê¸°ë°˜, ì—†ìœ¼ë©´ ê¸°ì¤€ ì •ë‹µ)
      const userFullSentence = buildSentence(ex, userFill || judged.ref);

      // ë§íˆ¬(ë†’ì„) ì¼ì¹˜ ê²€ì‚¬
      const politeness = checkPolitenessConsistency(userFullSentence, ex, userFill || judged.ref);

      // ê¸°ë³¸ ì •ì˜¤ íŒì •(ìœ í˜• + ì±„ìš°ê¸°)
      const baseCorrect = isTypeCorrect && judged.correct;

      let html = '';
      let className = 'incorrect';

      // ë§íˆ¬ ë¶ˆì¼ì¹˜ê°€ ìˆìœ¼ë©´ ì˜ë¯¸ê°€ ë§ì•„ë„ âŒ + êµì • ì•ˆë‚´
      if (baseCorrect && !politeness.ok){
        className = 'incorrect';
        html += `
          <p class="font-bold">âš ï¸ ë§íˆ¬(ë†’ì„) ë¶ˆì¼ì¹˜</p>
          <p class="text-sm mt-1">${politeness.reason}</p>
        `;
      } else if (isTypeCorrect && judged.correct){
        className = judged.perfect ? 'correct' : 'soft';
        html += judged.perfect
          ? `<p class="font-bold">ğŸ¥³ ì™„ë²½í•´ìš”!</p>`
          : `
             <p class="font-bold">âœ… ì˜ë¯¸ëŠ” ì •í™•í•´ìš”! (ì •ë‹µ ì²˜ë¦¬)</p>
             <p class="text-sm mt-1">FR: Sens juste. VÃ©rifie la forme exacte ci-dessous.</p>
             ${ judged.reason ? `<p class="text-xs mt-1 text-slate-700">(${judged.reason})</p>` : '' }
            `;
      } else {
        className = 'incorrect';
        html = `<p class="font-bold">ğŸ¤” Presque ! Regardons ensemble :</p><ul class="list-disc list-inside mt-2">`;
        html += isTypeCorrect
          ? `<li><strong>Partie 1 (Type) :</strong> Bien jouÃ©, c'est correct !</li>`
          : `<li><strong>Partie 1 (Type) :</strong> La bonne rÃ©ponse Ã©tait '<strong>${ex.typeAnswer}</strong>'.</li>`;
        html += judged.correct
          ? `<li><strong>Partie 2 (Phrase) :</strong> Sens OK. VÃ©rifie la bonne forme ci-dessous.</li>`
          : `<li><strong>Partie 2 (Phrase) :</strong> Il fallait Ã©crire '<strong>${ex.fillAnswer.replace('/', ' / ')}</strong>'.</li>`;
        html += `</ul>`;
      }

      // í‘œì‹œìš© ê¸°ì¤€ ì •ë‹µ(ë§íˆ¬ êµì • í•„ìš”ì‹œ ì¶”ì²œí˜•ìœ¼ë¡œ ì¡°ì •: ê°™ì•„ìš”â†”ê°™ì•„)
      let refAnswer = judged.ref || ex.fillAnswer.split('/')[0];
      const fullForPronounCheck = buildSentence(ex, refAnswer);
      const pClass = getPronounClass(fullForPronounCheck);
      if (!politeness.ok){
        refAnswer = suggestRefByPoliteness(ex, pClass, refAnswer);
      }

      const fullSentence = ex.koreanParts[0] + ` <span class='font-bold text-blue-700'>${refAnswer}</span>` + ex.koreanParts[1];

      html += `
        <p class="mt-2 border-t border-slate-300 pt-2">
          <strong>Phrase complÃ¨te :</strong>
          <span class="korean-font">${fullSentence}</span>
        </p>
        <p class="text-xs mt-1 text-slate-600">
          âœ… ê³µë°±Â·ë§ˆì¹¨í‘œÂ·â€˜ë¶€ë¶„ í¬í•¨â€™ì€ ë§ê²Œ ì²˜ë¦¬í•˜ì§€ë§Œ, <b>ë§íˆ¬(ë‚˜ëŠ”/ì €ëŠ” â†” ì–´ë¯¸)</b>ëŠ” ë°˜ë“œì‹œ ì¼ì¹˜ì‹œì¼œìš”.
        </p>
      `;

      feedbackEl.className = `feedback ${className}`;
      feedbackEl.innerHTML = html;
      feedbackEl.classList.remove('hidden');
    }

    // ì´ˆê¸° ë Œë”
    renderExercises();
  });
  </script>
</body>
</html>
