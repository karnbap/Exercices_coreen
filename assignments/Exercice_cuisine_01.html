<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Exercices d'Ã©coute en CorÃ©en (20 Questions)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&family=Roboto:wght@400;700&display=swap" rel="stylesheet" />
  <style>
    body{font-family:'Roboto','Noto Sans KR',sans-serif;background:#f0f2f5}
    .audio-btn{transition:all .3s ease}
    .audio-btn:hover{transform:scale(1.06);background:#4a5568}
    .audio-btn.loading{cursor:not-allowed;background:#a0aec0;animation:pulse 1.5s infinite}
    @keyframes pulse{0%,100%{opacity:1}50%{opacity:.7}}
    .answer-box{transition:max-height .5s ease,opacity .5s ease;max-height:0;opacity:0;overflow:hidden}
    .answer-box.show{max-height:150px;opacity:1}
    .particle-btn{transition:all .2s ease}
  </style>
</head>
<body class="bg-gray-100 text-gray-800 p-4 md:p-8">
  <div class="max-w-4xl mx-auto bg-white rounded-2xl shadow-lg p-6 md:p-8">
    <header class="text-center mb-8 border-b pb-4">
      <h1 class="text-3xl md:text-4xl font-bold text-indigo-600">Exercices d'Ã©coute en CorÃ©en (ë“£ê¸° ì—°ìŠµ)</h1>
      <p class="text-gray-600 mt-2">Ã‰coutez attentivement et rÃ©solvez les 20 exercices pour maÃ®triser la grammaire et le vocabulaire.</p>
    </header>

    <!-- Exercice 1 -->
    <section class="mb-12">
      <h2 class="text-2xl font-bold mb-4 text-gray-700 border-l-4 border-indigo-500 pl-4">Exercice 1 : ComplÃ©tez la phrase (ë¹ˆì¹¸ ì±„ìš°ê¸°)</h2>
      <div class="space-y-6">
        <!-- Q1 -->
        <div class="bg-gray-50 p-5 rounded-lg shadow-sm">
          <p class="mb-3 text-lg">1. Ã‰coutez et complÃ©tez la question.</p>
          <div class="flex items-center space-x-4">
            <button class="audio-btn bg-gray-700 text-white w-12 h-12 rounded-full flex items-center justify-center text-2xl"
                    data-audio-id="q1" data-text="í”„ë‘ìŠ¤ ì‚¬ëŒë“¤ì€ ë­ë¥¼ ìì£¼ ë¨¹ì–´ìš”?">ğŸ”Š</button>
            <p class="text-xl font-medium">í”„ë‘ìŠ¤ ì‚¬ëŒë“¤ì€
              <input type="text" id="q1_input" class="border-b-2 border-gray-300 focus:border-indigo-500 outline-none w-24 text-center bg-transparent">
              ìì£¼ ë¨¹ì–´ìš”?
            </p>
          </div>
          <div class="mt-4 text-right">
            <button onclick="toggleAnswer('q1_answer')" class="bg-indigo-500 text-white py-1 px-4 rounded-md hover:bg-indigo-600 transition">RÃ©ponse</button>
          </div>
          <div id="q1_answer" class="answer-box mt-3 p-3 bg-indigo-100 text-indigo-800 rounded-lg">
            <strong>RÃ©ponse :</strong> ë­ë¥¼ (ou ë­˜)<br><strong>Phrase :</strong> í”„ë‘ìŠ¤ ì‚¬ëŒë“¤ì€ ë­ë¥¼[ë­˜] ìì£¼ ë¨¹ì–´ìš”?
          </div>
        </div>

        <!-- Q2 -->
        <div class="bg-gray-50 p-5 rounded-lg shadow-sm">
          <p class="mb-3 text-lg">2. Ã‰coutez et complÃ©tez la phrase nÃ©gative.</p>
          <div class="flex items-center space-x-4">
            <button class="audio-btn bg-gray-700 text-white w-12 h-12 rounded-full flex items-center justify-center text-2xl"
                    data-audio-id="q2" data-text="ì €ëŠ” ì¹œêµ¬ë¥¼ ì•ˆ ë§Œë‚¬ì–´ìš”.">ğŸ”Š</button>
            <p class="text-xl font-medium">ì €ëŠ” ì¹œêµ¬ë¥¼
              <input type="text" id="q2_input" class="border-b-2 border-gray-300 focus:border-indigo-500 outline-none w-32 text-center bg-transparent">.
            </p>
          </div>
          <div class="mt-4 text-right">
            <button onclick="toggleAnswer('q2_answer')" class="bg-indigo-500 text-white py-1 px-4 rounded-md hover:bg-indigo-600 transition">RÃ©ponse</button>
          </div>
          <div id="q2_answer" class="answer-box mt-3 p-3 bg-indigo-100 text-indigo-800 rounded-lg">
            <strong>RÃ©ponse :</strong> ì•ˆ ë§Œë‚¬ì–´ìš”<br><strong>Phrase :</strong> ì €ëŠ” ì¹œêµ¬ë¥¼ ì•ˆ ë§Œë‚¬ì–´ìš”.
          </div>
        </div>

        <!-- Q3 -->
        <div class="bg-gray-50 p-5 rounded-lg shadow-sm">
          <p class="mb-3 text-lg">3. Ã‰coutez et complÃ©tez avec le nom.</p>
          <div class="flex items-center space-x-4">
            <button class="audio-btn bg-gray-700 text-white w-12 h-12 rounded-full flex items-center justify-center text-2xl"
                    data-audio-id="q3" data-text="ì €ëŠ” ìŒ€ì„ ìì£¼ ë¨¹ì–´ìš”.">ğŸ”Š</button>
            <p class="text-xl font-medium">ì €ëŠ”
              <input type="text" id="q3_input" class="border-b-2 border-gray-300 focus:border-indigo-500 outline-none w-16 text-center bg-transparent">ì„ ìì£¼ ë¨¹ì–´ìš”.
            </p>
          </div>
          <div class="mt-4 text-right">
            <button onclick="toggleAnswer('q3_answer')" class="bg-indigo-500 text-white py-1 px-4 rounded-md hover:bg-indigo-600 transition">RÃ©ponse</button>
          </div>
          <div id="q3_answer" class="answer-box mt-3 p-3 bg-indigo-100 text-indigo-800 rounded-lg">
            <strong>RÃ©ponse :</strong> ìŒ€<br><strong>Phrase :</strong> ì €ëŠ” ìŒ€ì„ ìì£¼ ë¨¹ì–´ìš”. (Je mange souvent du riz.)
          </div>
        </div>

        <!-- Q4 -->
        <div class="bg-gray-50 p-5 rounded-lg shadow-sm">
          <p class="mb-3 text-lg">4. Ã‰coutez et complÃ©tez avec l'adverbe.</p>
          <div class="flex items-center space-x-4">
            <button class="audio-btn bg-gray-700 text-white w-12 h-12 rounded-full flex items-center justify-center text-2xl"
                    data-audio-id="q4" data-text="í•œêµ­ ì‚¬ëŒë“¤ì€ ê¹€ì¹˜ì°Œê°œë¥¼ ìì£¼ ë¨¹ì–´ìš”.">ğŸ”Š</button>
            <p class="text-xl font-medium">í•œêµ­ ì‚¬ëŒë“¤ì€ ê¹€ì¹˜ì°Œê°œë¥¼
              <input type="text" id="q4_input" class="border-b-2 border-gray-300 focus:border-indigo-500 outline-none w-20 text-center bg-transparent"> ë¨¹ì–´ìš”.
            </p>
          </div>
          <div class="mt-4 text-right">
            <button onclick="toggleAnswer('q4_answer')" class="bg-indigo-500 text-white py-1 px-4 rounded-md hover:bg-indigo-600 transition">RÃ©ponse</button>
          </div>
          <div id="q4_answer" class="answer-box mt-3 p-3 bg-indigo-100 text-indigo-800 rounded-lg">
            <strong>RÃ©ponse :</strong> ìì£¼<br><strong>Phrase :</strong> í•œêµ­ ì‚¬ëŒë“¤ì€ ê¹€ì¹˜ì°Œê°œë¥¼ ìì£¼ ë¨¹ì–´ìš”.
          </div>
        </div>

        <!-- Q5 -->
        <div class="bg-gray-50 p-5 rounded-lg shadow-sm">
          <p class="mb-3 text-lg">5. Ã‰coutez et complÃ©tez avec le verbe.</p>
          <div class="flex items-center space-x-4">
            <button class="audio-btn bg-gray-700 text-white w-12 h-12 rounded-full flex items-center justify-center text-2xl"
                    data-audio-id="q5" data-text="ì €ëŠ” ì‹ë‹¹ì— ë“¤ì–´ê°€ìš”.">ğŸ”Š</button>
            <p class="text-xl font-medium">ì €ëŠ” ì‹ë‹¹ì—
              <input type="text" id="q5_input" class="border-b-2 border-gray-300 focus:border-indigo-500 outline-none w-28 text-center bg-transparent">.
            </p>
          </div>
          <div class="mt-4 text-right">
            <button onclick="toggleAnswer('q5_answer')" class="bg-indigo-500 text-white py-1 px-4 rounded-md hover:bg-indigo-600 transition">RÃ©ponse</button>
          </div>
          <div id="q5_answer" class="answer-box mt-3 p-3 bg-indigo-100 text-indigo-800 rounded-lg">
            <strong>RÃ©ponse :</strong> ë“¤ì–´ê°€ìš”<br><strong>Phrase :</strong> ì €ëŠ” ì‹ë‹¹ì— ë“¤ì–´ê°€ìš”.
          </div>
        </div>
      </div>
    </section>

    <!-- Exercice 2 -->
    <section class="mb-12">
      <h2 class="text-2xl font-bold mb-4 text-gray-700 border-l-4 border-cyan-500 pl-4">Exercice 2 : Choisissez la bonne particule (ì¡°ì‚¬ ì„ íƒí•˜ê¸°)</h2>
      <div class="space-y-6">
        <!-- Q6 -->
        <div class="bg-gray-50 p-5 rounded-lg shadow-sm">
          <p class="mb-3 text-lg">6. Ã‰coutez et choisissez la particule pour "et".</p>
          <div class="flex items-center space-x-4">
            <button class="audio-btn bg-gray-700 text-white w-12 h-12 rounded-full flex items-center justify-center text-2xl"
                    data-audio-id="q6" data-text="ê¹€ì¹˜ì™€ ë¼ì§€ê³ ê¸°ê°€ ë“¤ì–´ê°€ìš”.">ğŸ”Š</button>
            <p class="text-xl font-medium">ê¹€ì¹˜<span id="q6_blank" class="font-bold text-cyan-600">__</span> ë¼ì§€ê³ ê¸°ê°€ ë“¤ì–´ê°€ìš”.</p>
          </div>
          <div class="flex space-x-4 mt-4" id="q6_options">
            <button onclick="checkParticle('q6','ì™€',true)" class="particle-btn flex-1 bg-gray-200 hover:bg-cyan-200 text-gray-800 font-bold py-2 px-4 rounded">ì™€</button>
            <button onclick="checkParticle('q6','ê³¼',false)" class="particle-btn flex-1 bg-gray-200 hover:bg-cyan-200 text-gray-800 font-bold py-2 px-4 rounded">ê³¼</button>
          </div>
          <div id="q6_answer" class="answer-box mt-3 p-3 bg-cyan-100 text-cyan-800 rounded-lg">
            <strong>RÃ©ponse :</strong> ì™€.<br><strong>Explication :</strong> AprÃ¨s une voyelle (ê¹€ì¹˜), on utilise 'ì™€'.
          </div>
        </div>

        <!-- Q7 -->
        <div class="bg-gray-50 p-5 rounded-lg shadow-sm">
          <p class="mb-3 text-lg">7. Ã‰coutez et choisissez la particule de sujet.</p>
          <div class="flex items-center space-x-4">
            <button class="audio-btn bg-gray-700 text-white w-12 h-12 rounded-full flex items-center justify-center text-2xl"
                    data-audio-id="q7" data-text="ì œ ì¹œêµ¬ê°€ ì˜í™”ë¥¼ ë´ìš”.">ğŸ”Š</button>
            <p class="text-xl font-medium">ì œ ì¹œêµ¬<span id="q7_blank" class="font-bold text-cyan-600">__</span> ì˜í™”ë¥¼ ë´ìš”.</p>
          </div>
          <div class="flex space-x-4 mt-4" id="q7_options">
            <button onclick="checkParticle('q7','ë¥¼',false)" class="particle-btn flex-1 bg-gray-200 hover:bg-cyan-200 text-gray-800 font-bold py-2 px-4 rounded">ë¥¼</button>
            <button onclick="checkParticle('q7','ê°€',true)" class="particle-btn flex-1 bg-gray-200 hover:bg-cyan-200 text-gray-800 font-bold py-2 px-4 rounded">ê°€</button>
          </div>
          <div id="q7_answer" class="answer-box mt-3 p-3 bg-cyan-100 text-cyan-800 rounded-lg">
            <strong>RÃ©ponse :</strong> ê°€.<br><strong>Explication :</strong> 'ì¹œêµ¬' (voyelle) est le sujet, on utilise 'ê°€'.
          </div>
        </div>

        <!-- Q8 -->
        <div class="bg-gray-50 p-5 rounded-lg shadow-sm">
          <p class="mb-3 text-lg">8. Ã‰coutez et choisissez la particule de thÃ¨me.</p>
          <div class="flex items-center space-x-4">
            <button class="audio-btn bg-gray-700 text-white w-12 h-12 rounded-full flex items-center justify-center text-2xl"
                    data-audio-id="q8" data-text="í•œêµ­ ì‚¬ëŒë“¤ì€ ê¹€ì¹˜ì°Œê°œë¥¼ ìì£¼ ë¨¹ì–´ìš”.">ğŸ”Š</button>
            <p class="text-xl font-medium">í•œêµ­ ì‚¬ëŒ<span id="q8_blank" class="font-bold text-cyan-600">__</span> ê¹€ì¹˜ì°Œê°œë¥¼ ìì£¼ ë¨¹ì–´ìš”.</p>
          </div>
          <div class="flex space-x-4 mt-4" id="q8_options">
            <button onclick="checkParticle('q8','ì€',true)" class="particle-btn flex-1 bg-gray-200 hover:bg-cyan-200 text-gray-800 font-bold py-2 px-4 rounded">ì€</button>
            <button onclick="checkParticle('q8','ëŠ”',false)" class="particle-btn flex-1 bg-gray-200 hover:bg-cyan-200 text-gray-800 font-bold py-2 px-4 rounded">ëŠ”</button>
          </div>
          <div id="q8_answer" class="answer-box mt-3 p-3 bg-cyan-100 text-cyan-800 rounded-lg">
            <strong>RÃ©ponse :</strong> ì€.<br><strong>Explication :</strong> AprÃ¨s une consonne (ì‚¬ëŒ), on utilise 'ì€'.
          </div>
        </div>

        <!-- Q9 -->
        <div class="bg-gray-50 p-5 rounded-lg shadow-sm">
          <p class="mb-3 text-lg">9. Ã‰coutez et choisissez la particule d'objet (COD).</p>
          <div class="flex items-center space-x-4">
            <button class="audio-btn bg-gray-700 text-white w-12 h-12 rounded-full flex items-center justify-center text-2xl"
                    data-audio-id="q9" data-text="ì €ëŠ” ë°¥ì„ ë¨¹ì–´ìš”.">ğŸ”Š</button>
            <p class="text-xl font-medium">ì €ëŠ” ë°¥<span id="q9_blank" class="font-bold text-cyan-600">__</span> ë¨¹ì–´ìš”.</p>
          </div>
          <div class="flex space-x-4 mt-4" id="q9_options">
            <button onclick="checkParticle('q9','ì„',true)" class="particle-btn flex-1 bg-gray-200 hover:bg-cyan-200 text-gray-800 font-bold py-2 px-4 rounded">ì„</button>
            <button onclick="checkParticle('q9','ë¥¼',false)" class="particle-btn flex-1 bg-gray-200 hover:bg-cyan-200 text-gray-800 font-bold py-2 px-4 rounded">ë¥¼</button>
          </div>
          <div id="q9_answer" class="answer-box mt-3 p-3 bg-cyan-100 text-cyan-800 rounded-lg">
            <strong>RÃ©ponse :</strong> ì„.<br><strong>Explication :</strong> AprÃ¨s une consonne (ë°¥), on utilise 'ì„'.
          </div>
        </div>

        <!-- Q10 -->
        <div class="bg-gray-50 p-5 rounded-lg shadow-sm">
          <p class="mb-3 text-lg">10. Ã‰coutez et choisissez la particule de lieu/destination.</p>
          <div class="flex items-center space-x-4">
            <button class="audio-btn bg-gray-700 text-white w-12 h-12 rounded-full flex items-center justify-center text-2xl"
                    data-audio-id="q10" data-text="ì €ëŠ” ì§‘ì— ë“¤ì–´ê°€ìš”.">ğŸ”Š</button>
            <p class="text-xl font-medium">ì €ëŠ” ì§‘<span id="q10_blank" class="font-bold text-cyan-600">__</span> ë“¤ì–´ê°€ìš”.</p>
          </div>
          <div class="flex space-x-4 mt-4" id="q10_options">
            <button onclick="checkParticle('q10','ì—',true)" class="particle-btn flex-1 bg-gray-200 hover:bg-cyan-200 text-gray-800 font-bold py-2 px-4 rounded">ì—</button>
            <button onclick="checkParticle('q10','ì—ì„œ',false)" class="particle-btn flex-1 bg-gray-200 hover:bg-cyan-200 text-gray-800 font-bold py-2 px-4 rounded">ì—ì„œ</button>
          </div>
          <div id="q10_answer" class="answer-box mt-3 p-3 bg-cyan-100 text-cyan-800 rounded-lg">
            <strong>RÃ©ponse :</strong> ì—.<br><strong>Explication :</strong> Pour une destination (verbe de mouvement), on utilise 'ì—'.
          </div>
        </div>
      </div>
    </section>

    <!-- Exercice 3 -->
    <section class="mb-12">
      <h2 class="text-2xl font-bold mb-4 text-gray-700 border-l-4 border-green-500 pl-4">Exercice 3 : Vrai ou Faux (O/X í€´ì¦ˆ)</h2>
      <div class="space-y-6">
        <!-- Q11 -->
        <div class="bg-gray-50 p-5 rounded-lg shadow-sm">
          <p class="mb-3 text-lg">11. Ã‰coutez la question. L'affirmation est-elle la bonne traduction ?</p>
          <div class="flex items-center space-x-4 mb-4">
            <button class="audio-btn bg-gray-700 text-white w-12 h-12 rounded-full flex items-center justify-center text-2xl"
                    data-audio-id="q11" data-text="ì˜ ë³´ì—¬ìš”?">ğŸ”Š</button>
            <p class="italic text-gray-600">Affirmation : "Tu me vois bien ?"</p>
          </div>
          <div class="flex space-x-4" id="q11_options">
            <button onclick="checkTrueFalse('q11',true)" class="flex-1 bg-blue-200 hover:bg-blue-300 text-blue-800 font-bold py-2 px-4 rounded">Vrai (O)</button>
            <button onclick="checkTrueFalse('q11',false)" class="flex-1 bg-red-200 hover:bg-red-300 text-red-800 font-bold py-2 px-4 rounded">Faux (X)</button>
          </div>
          <div id="q11_answer" class="answer-box mt-3 p-3 bg-green-100 text-green-800 rounded-lg">
            <strong>RÃ©ponse :</strong> Vrai (O).
          </div>
        </div>

        <!-- Q12 -->
        <div class="bg-gray-50 p-5 rounded-lg shadow-sm">
          <p class="mb-3 text-lg">12. Ã‰coutez la phrase. L'affirmation est-elle correcte ?</p>
          <div class="flex items-center space-x-4 mb-4">
            <button class="audio-btn bg-gray-700 text-white w-12 h-12 rounded-full flex items-center justify-center text-2xl"
                    data-audio-id="q12" data-text="ì €ëŠ” ìŒ€ì„ ìì£¼ ë¨¹ì–´ìš”.">ğŸ”Š</button>
            <p class="italic text-gray-600">Affirmation : "Je mange souvent des pÃ¢tes."</p>
          </div>
          <div class="flex space-x-4" id="q12_options">
            <button onclick="checkTrueFalse('q12',false)" class="flex-1 bg-blue-200 hover:bg-blue-300 text-blue-800 font-bold py-2 px-4 rounded">Vrai (O)</button>
            <button onclick="checkTrueFalse('q12',true)" class="flex-1 bg-red-200 hover:bg-red-300 text-red-800 font-bold py-2 px-4 rounded">Faux (X)</button>
          </div>
          <div id="q12_answer" class="answer-box mt-3 p-3 bg-red-100 text-red-800 rounded-lg">
            <strong>RÃ©ponse :</strong> Faux (X).
          </div>
        </div>

        <!-- Q13 -->
        <div class="bg-gray-50 p-5 rounded-lg shadow-sm">
          <p class="mb-3 text-lg">13. Ã‰coutez la phrase. L'affirmation est-elle correcte ?</p>
          <div class="flex items-center space-x-4 mb-4">
            <button class="audio-btn bg-gray-700 text-white w-12 h-12 rounded-full flex items-center justify-center text-2xl"
                    data-audio-id="q13" data-text="ì œ ì¹œêµ¬ê°€ ì¹œêµ¬ë“¤ì„ ì•ˆ ë§Œë‚¬ì–´ìš”.">ğŸ”Š</button>
            <p class="italic text-gray-600">Affirmation : "Mon ami a rencontrÃ© ses amis."</p>
          </div>
          <div class="flex space-x-4" id="q13_options">
            <button onclick="checkTrueFalse('q13',false)" class="flex-1 bg-blue-200 hover:bg-blue-300 text-blue-800 font-bold py-2 px-4 rounded">Vrai (O)</button>
            <button onclick="checkTrueFalse('q13',true)" class="flex-1 bg-red-200 hover:bg-red-300 text-red-800 font-bold py-2 px-4 rounded">Faux (X)</button>
          </div>
          <div id="q13_answer" class="answer-box mt-3 p-3 bg-red-100 text-red-800 rounded-lg">
            <strong>RÃ©ponse :</strong> Faux (X).
          </div>
        </div>

        <!-- Q14 -->
        <div class="bg-gray-50 p-5 rounded-lg shadow-sm">
          <p class="mb-3 text-lg">14. Ã‰coutez la phrase. L'affirmation est-elle correcte ?</p>
          <div class="flex items-center space-x-4 mb-4">
            <button class="audio-btn bg-gray-700 text-white w-12 h-12 rounded-full flex items-center justify-center text-2xl"
                    data-audio-id="q14" data-text="í”„ë‘ìŠ¤ ì‚¬ëŒë“¤ì€ ë°”ê²ŒíŠ¸ë¥¼ ê°€ë” ë¨¹ì–´ìš”.">ğŸ”Š</button>
            <p class="italic text-gray-600">Affirmation : "Les FranÃ§ais mangent parfois de la baguette."</p>
          </div>
          <div class="flex space-x-4" id="q14_options">
            <button onclick="checkTrueFalse('q14',true)" class="flex-1 bg-blue-200 hover:bg-blue-300 text-blue-800 font-bold py-2 px-4 rounded">Vrai (O)</button>
            <button onclick="checkTrueFalse('q14',false)" class="flex-1 bg-red-200 hover:bg-red-300 text-red-800 font-bold py-2 px-4 rounded">Faux (X)</button>
          </div>
          <div id="q14_answer" class="answer-box mt-3 p-3 bg-green-100 text-green-800 rounded-lg">
            <strong>RÃ©ponse :</strong> Vrai (O).
          </div>
        </div>

        <!-- Q15 -->
        <div class="bg-gray-50 p-5 rounded-lg shadow-sm">
          <p class="mb-3 text-lg">15. Ã‰coutez la phrase. L'affirmation est-elle correcte ?</p>
          <div class="flex items-center space-x-4 mb-4">
            <button class="audio-btn bg-gray-700 text-white w-12 h-12 rounded-full flex items-center justify-center text-2xl"
                    data-audio-id="q15" data-text="ì €ëŠ” ì§‘ì— ë“¤ì–´ê°€ìš”.">ğŸ”Š</button>
            <p class="italic text-gray-600">Affirmation : "J'entre dans un restaurant."</p>
          </div>
          <div class="flex space-x-4" id="q15_options">
            <button onclick="checkTrueFalse('q15',false)" class="flex-1 bg-blue-200 hover:bg-blue-300 text-blue-800 font-bold py-2 px-4 rounded">Vrai (O)</button>
            <button onclick="checkTrueFalse('q15',true)" class="flex-1 bg-red-200 hover:bg-red-300 text-red-800 font-bold py-2 px-4 rounded">Faux (X)</button>
          </div>
          <div id="q15_answer" class="answer-box mt-3 p-3 bg-red-100 text-red-800 rounded-lg">
            <strong>RÃ©ponse :</strong> Faux (X).
          </div>
        </div>
      </div>
    </section>

    <!-- Exercice 4 -->
    <section>
      <h2 class="text-2xl font-bold mb-4 text-gray-700 border-l-4 border-purple-500 pl-4">Exercice 4 : DictÃ©e et Combinaison (ë°›ì•„ì“°ê¸° ë° ë¬¸ì¥ ì—°ê²°)</h2>
      <div class="space-y-6">
        <!-- Q16 -->
        <div class="bg-gray-50 p-5 rounded-lg shadow-sm">
          <p class="mb-3 text-lg">16. <strong>DictÃ©e :</strong> Ã‰coutez et Ã©crivez la phrase complÃ¨te.</p>
          <div class="flex items-center space-x-4 mb-3">
            <button class="audio-btn bg-gray-700 text-white w-12 h-12 rounded-full flex items-center justify-center text-2xl"
                    data-audio-id="q16" data-text="ì €ëŠ” ì¹œêµ¬ë¥¼ ì•ˆ ë§Œë‚˜ê³  ì˜í™”ë¥¼ ì•ˆ ë´¤ì–´ìš”.">ğŸ”Š</button>
            <input type="text" id="q16_input" class="w-full p-2 border-2 border-gray-300 rounded-md focus:border-purple-500 outline-none" placeholder="Ã‰crivez ce que vous entendez...">
          </div>
          <div class="mt-4 text-right"><button onclick="toggleAnswer('q16_answer')" class="bg-purple-500 text-white py-1 px-4 rounded-md hover:bg-purple-600 transition">RÃ©ponse</button></div>
          <div id="q16_answer" class="answer-box mt-3 p-3 bg-purple-100 text-purple-800 rounded-lg">
            <strong>Phrase :</strong> ì €ëŠ” ì¹œêµ¬ë¥¼ ì•ˆ ë§Œë‚˜ê³  ì˜í™”ë¥¼ ì•ˆ ë´¤ì–´ìš”.
          </div>
        </div>

        <!-- Q17 -->
        <div class="bg-gray-50 p-5 rounded-lg shadow-sm">
          <p class="mb-3 text-lg">17. <strong>DictÃ©e :</strong> Ã‰coutez et Ã©crivez la phrase complÃ¨te.</p>
          <div class="flex items-center space-x-4 mb-3">
            <button class="audio-btn bg-gray-700 text-white w-12 h-12 rounded-full flex items-center justify-center text-2xl"
                    data-audio-id="q17" data-text="ê¹€ì¹˜í•˜ê³  ë°¥ì„ ê°™ì´ ë¨¹ì–´ìš”.">ğŸ”Š</button>
            <input type="text" id="q17_input" class="w-full p-2 border-2 border-gray-300 rounded-md focus:border-purple-500 outline-none" placeholder="Ã‰crivez ce que vous entendez...">
          </div>
          <div class="mt-4 text-right"><button onclick="toggleAnswer('q17_answer')" class="bg-purple-500 text-white py-1 px-4 rounded-md hover:bg-purple-600 transition">RÃ©ponse</button></div>
          <div id="q17_answer" class="answer-box mt-3 p-3 bg-purple-100 text-purple-800 rounded-lg">
            <strong>Phrase :</strong> ê¹€ì¹˜í•˜ê³  ë°¥ì„ ê°™ì´ ë¨¹ì–´ìš”.
          </div>
        </div>

        <!-- Q18 -->
        <div class="bg-gray-50 p-5 rounded-lg shadow-sm">
          <p class="mb-3 text-lg">18. <strong>Combinaison (-ê³ ) :</strong> Combinez les deux phrases.</p>
          <div class="mb-4"><p class="text-xl font-medium">Phrase 1 : ë¼ì§€ê³ ê¸°ë¥¼ ëƒ„ë¹„ì— ë„£ì–´ìš”.<br>Phrase 2 : ë³¶ì•„ìš”.</p></div>
          <input type="text" id="q18_input" class="w-full p-2 border-2 border-gray-300 rounded-md focus:border-purple-500 outline-none" placeholder="Combinez les deux phrases ici...">
          <div class="mt-4 text-right"><button onclick="toggleAnswer('q18_answer')" class="bg-purple-500 text-white py-1 px-4 rounded-md hover:bg-purple-600 transition">RÃ©ponse</button></div>
          <div id="q18_answer" class="answer-box mt-3 p-3 bg-purple-100 text-purple-800 rounded-lg">
            <strong>RÃ©ponse :</strong> ë¼ì§€ê³ ê¸°ë¥¼ ëƒ„ë¹„ì— ë„£ê³  ë³¶ì•„ìš”.
          </div>
        </div>

        <!-- Q19 -->
        <div class="bg-gray-50 p-5 rounded-lg shadow-sm">
          <p class="mb-3 text-lg">19. <strong>Combinaison (-ê³ ) :</strong> Combinez les deux phrases.</p>
          <div class="mb-4"><p class="text-xl font-medium">Phrase 1 : ì €ëŠ” ì¹œêµ¬ë¥¼ ë§Œë‚˜ìš”.<br>Phrase 2 : ì˜í™”ë¥¼ ë´ìš”.</p></div>
          <input type="text" id="q19_input" class="w-full p-2 border-2 border-gray-300 rounded-md focus:border-purple-500 outline-none" placeholder="Combinez les deux phrases ici...">
          <div class="mt-4 text-right"><button onclick="toggleAnswer('q19_answer')" class="bg-purple-500 text-white py-1 px-4 rounded-md hover:bg-purple-600 transition">RÃ©ponse</button></div>
          <div id="q19_answer" class="answer-box mt-3 p-3 bg-purple-100 text-purple-800 rounded-lg">
            <strong>RÃ©ponse :</strong> ì €ëŠ” ì¹œêµ¬ë¥¼ ë§Œë‚˜ê³  ì˜í™”ë¥¼ ë´ìš”.
          </div>
        </div>

        <!-- Q20 -->
        <div class="bg-gray-50 p-5 rounded-lg shadow-sm">
          <p class="mb-3 text-lg">20. <strong>Combinaison (-ê³ ) :</strong> Combinez les deux phrases.</p>
          <div class="mb-4"><p class="text-xl font-medium">Phrase 1 : ì‹ë‹¹ì— ë“¤ì–´ê°€ìš”.<br>Phrase 2 : ê°™ì´ ë¨¹ì–´ìš”.</p></div>
          <input type="text" id="q20_input" class="w-full p-2 border-2 border-gray-300 rounded-md focus:border-purple-500 outline-none" placeholder="Combinez les deux phrases ici...">
          <div class="mt-4 text-right"><button onclick="toggleAnswer('q20_answer')" class="bg-purple-500 text-white py-1 px-4 rounded-md hover:bg-purple-600 transition">RÃ©ponse</button></div>
          <div id="q20_answer" class="answer-box mt-3 p-3 bg-purple-100 text-purple-800 rounded-lg">
            <strong>RÃ©ponse :</strong> ì‹ë‹¹ì— ë“¤ì–´ê°€ê³  ê°™ì´ ë¨¹ì–´ìš”.
          </div>
        </div>
      </div>
    </section>
  </div>

  <script>
    /************ ì˜¤ë””ì˜¤ ìœ í‹¸ ************/
    const audioState = {
      current: null,             // í˜„ì¬ ì¬ìƒ ì¤‘ì¸ Audio
      currentUrl: null,          // í˜„ì¬ Blob URL
      busyButtons: new Set(),    // ì¤‘ë³µ í´ë¦­ ë°©ì§€
      controllers: new Map(),    // fetch ì·¨ì†Œìš© AbortController
    };

    function safeResetButton(btn, originalHTML){
      btn.classList.remove('loading');
      btn.innerHTML = originalHTML;
      btn.disabled = false;
      audioState.busyButtons.delete(btn);
    }

    function stopAndCleanup(){
      try{
        if (audioState.current){
          audioState.current.pause();
          audioState.current.src = '';
          audioState.current.load(); // Safari ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€
          audioState.current = null;
        }
        if (audioState.currentUrl){
          URL.revokeObjectURL(audioState.currentUrl);
          audioState.currentUrl = null;
        }
      }catch(e){ console.warn('cleanup error', e); }
    }

    function base64ToArrayBuffer(base64) {
      const bin = atob(base64);
      const len = bin.length;
      const bytes = new Uint8Array(len);
      for (let i=0;i<len;i++) bytes[i] = bin.charCodeAt(i);
      return bytes.buffer;
    }

    function pcmToWav(pcmData, sampleRate){
      const pcm16 = new Int16Array(pcmData);
      const header = new ArrayBuffer(44);
      const view = new DataView(header);
      const write = (o,s)=>{ for(let i=0;i<s.length;i++) view.setUint8(o+i, s.charCodeAt(i)); };

      write(0,'RIFF'); view.setUint32(4, 36+pcm16.byteLength, true);
      write(8,'WAVE'); write(12,'fmt ');
      view.setUint32(16,16,true); view.setUint16(20,1,true);
      const ch=1; view.setUint16(22,ch,true);
      view.setUint32(24,sampleRate,true);
      view.setUint32(28,sampleRate*ch*2,true);
      view.setUint16(32,ch*2,true);
      view.setUint16(34,16,true);
      write(36,'data'); view.setUint32(40, pcm16.byteLength, true);

      return new Blob([header, pcm16], { type: 'audio/wav' });
    }

    async function fetchWithTimeout(url, options={}, timeoutMs=15000){
      const controller = new AbortController();
      const id = setTimeout(()=>controller.abort(), timeoutMs);
      const merged = { ...options, signal: controller.signal };
      const res = await fetch(url, merged);
      clearTimeout(id);
      return res;
    }

    async function generateAndPlayAudio(text, btn){
      if (audioState.busyButtons.has(btn)) return; // ë²„íŠ¼ë³„ ì¤‘ë³µ ë°©ì§€
      audioState.busyButtons.add(btn);

      const originalHTML = btn.innerHTML;
      btn.classList.add('loading');
      btn.disabled = true;
      btn.innerHTML = 'â€¦';

      // ì´ì „ ì¬ìƒ/ë¦¬ì†ŒìŠ¤ ì •ë¦¬
      stopAndCleanup();

      // ë²„íŠ¼ë³„ ì§„í–‰ ì¤‘ fetch ì·¨ì†Œ ì„¸íŒ…
      const id = btn.dataset.audioId || crypto.randomUUID();
      const prevController = audioState.controllers.get(id);
      if (prevController) prevController.abort();
      const controller = new AbortController();
      audioState.controllers.set(id, controller);

      try {
        const res = await fetchWithTimeout('/.netlify/functions/generate-audio', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ text }),
          signal: controller.signal
        }, 15000);

        if (!res.ok) {
          let msg = `HTTP ${res.status}`;
          try { const j = await res.json(); if (j?.error) msg = j.error; } catch {}
          throw new Error(msg);
        }

        const result = await res.json();

        // ë°±ì—”ë“œê°€ mp3/wav urlì„ ì¤„ ìˆ˜ë„, base64 PCMì„ ì¤„ ìˆ˜ë„ ìˆë‹¤ëŠ” ì „ì œì˜ ì•ˆì „ ì²˜ë¦¬
        let blobUrl = null;

        if (result.audioUrl && typeof result.audioUrl === 'string') {
          // (ì„ í˜¸) ì„œë²„ì—ì„œ ì´ë¯¸ í˜¸ìŠ¤íŒ…ëœ ì˜¤ë””ì˜¤ URLì„ ë°˜í™˜í•œ ê²½ìš°
          blobUrl = result.audioUrl;
        } else if (result.audioData) {
          const mimeType = result.mimeType || 'audio/wav;rate=24000';
          if (mimeType.startsWith('audio/')) {
            const rateMatch = mimeType.match(/rate=(\d+)/);
            const sr = rateMatch ? parseInt(rateMatch[1],10) : 24000;
            const pcm = base64ToArrayBuffer(result.audioData);
            const wav = pcmToWav(pcm, sr);
            blobUrl = URL.createObjectURL(wav);
          } else {
            throw new Error('Invalid mimeType in response');
          }
        } else {
          throw new Error('No audio payload in response');
        }

        audioState.currentUrl = blobUrl;
        const audio = new Audio(blobUrl);
        audioState.current = audio;

        // ì¬ìƒ ì´ë²¤íŠ¸ í•¸ë“¤ë§ (ëª¨ë“  ê²½ë¡œì—ì„œ ë²„íŠ¼ ìƒíƒœ ë³µì›)
        const finalize = () => safeResetButton(btn, originalHTML);
        audio.addEventListener('ended', () => { finalize(); stopAndCleanup(); }, { once:true });
        audio.addEventListener('error', () => { finalize(); stopAndCleanup(); }, { once:true });

        // iOS/Safari ì¬ìƒ ê±°ë¶€ ëŒ€ë¹„: play() Promise ì—ëŸ¬ ì²˜ë¦¬
        try {
          await audio.play();
        } catch (err) {
          finalize();
          stopAndCleanup();
          console.warn('Autoplay/gesture blocked or play error:', err);
          alert('ë¸Œë¼ìš°ì €ê°€ ì¬ìƒì„ ë§‰ì•˜ìŠµë‹ˆë‹¤. ë²„íŠ¼ì„ ë‹¤ì‹œ í•œ ë²ˆ ëˆŒëŸ¬ ì£¼ì„¸ìš”.');
          return;
        }

      } catch (e) {
        console.error('Audio generation/playback error:', e);
        safeResetButton(btn, originalHTML);
      } finally {
        // ì´ ë²„íŠ¼ì˜ fetch ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ì •ë¦¬
        audioState.controllers.delete(id);
      }
    }

    /************ UI ë¡œì§(ë‹µì•ˆ ë°•ìŠ¤ í† ê¸€/ì±„ì ) ************/
    function toggleAnswer(id){
      document.getElementById(id)?.classList.toggle('show');
    }

    function checkParticle(qId, chosen, isCorrect){
      const answerBox = document.getElementById(qId + '_answer');
      const options = document.getElementById(qId + '_options');
      const blank = document.getElementById(qId + '_blank');

      if (blank) blank.textContent = chosen;
      if (answerBox) answerBox.classList.add('show');

      options?.querySelectorAll('button')?.forEach(btn=>{
        btn.disabled = true;
        if (btn.textContent === chosen) {
          btn.classList.remove('bg-gray-200','hover:bg-cyan-200');
          btn.classList.add(isCorrect ? 'bg-green-500' : 'bg-red-500','text-white');
          if (blank) blank.classList.add(isCorrect ? 'text-green-600' : 'text-red-600');
        } else {
          btn.classList.add('opacity-50');
        }
      });
    }

    function checkTrueFalse(qId, isChoiceCorrect){
      const answerBox = document.getElementById(qId + '_answer');
      const options = document.getElementById(qId + '_options');
      answerBox?.classList.add('show');
      options?.querySelectorAll('button')?.forEach(btn=>{
        btn.disabled = true;
        const isVrai = btn.textContent.includes('Vrai');
        const isCorrectBtn = (isVrai && isChoiceCorrect) || (!isVrai && !isChoiceCorrect);
        if (isCorrectBtn) btn.classList.add('ring-4','ring-green-500');
        else btn.classList.add('opacity-50');
      });
    }

    /************ ì´ë²¤íŠ¸ ë°”ì¸ë”© ************/
    // DOMContentLoaded ë³´ì¥ í›„ ë°”ì¸ë”© (ì¼ë¶€ ë¸Œë¼ìš°ì €ì—ì„œ ì¡°ê¸° ë°”ì¸ë”© ì´ìŠˆ ì˜ˆë°©)
    document.addEventListener('DOMContentLoaded', ()=>{
      document.querySelectorAll('.audio-btn').forEach(btn=>{
        btn.addEventListener('click', (e)=>{
          e.stopPropagation();
          const text = btn.dataset.text || '';
          generateAndPlayAudio(text, btn);
        });
      });
      // í˜ì´ì§€ ë– ë‚  ë•Œ ë¦¬ì†ŒìŠ¤ í•´ì œ
      window.addEventListener('pagehide', stopAndCleanup);
      window.addEventListener('beforeunload', stopAndCleanup);
    });
  </script>
</body>
</html>
