<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Exercice de Dictée : Comme en Coréen</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body{font-family:'Inter',sans-serif;background:#f3f4f6}
    .korean-font{font-family:'Gowun Dodum',sans-serif}
    .card{background:#fff;border-radius:1rem;padding:1.5rem;box-shadow:0 4px 6px -1px rgb(0 0 0 / .1),0 2px 4px -2px rgb(0 0 0 / .1)}
    .btn{display:inline-flex;align-items:center;justify-content:center;padding:.6rem 1.2rem;border-radius:.75rem;font-weight:600;text-align:center;cursor:pointer;transition:all .2s;border:none}
    .btn:disabled{opacity:.6;cursor:not-allowed}
    .btn-primary{background:#3b82f6;color:#fff}.btn-primary:hover:not(:disabled){background:#2563eb}
    .btn-secondary{background:#e5e7eb;color:#374151}.btn-secondary:hover:not(:disabled){background:#d1d5db}
    .btn-hint{background:#fefce8;color:#a16207;padding:.4rem .8rem;font-size:.875rem;border:1px solid #fde047}.btn-hint:hover:not(:disabled){background:#fef08a}
    .dictation-card{padding:1.5rem;border:1px solid #e5e7eb;border-radius:1rem;margin-bottom:1.5rem;background:#fff}
    .feedback{padding:1rem;border-radius:.75rem;margin-top:1rem;font-size:.95rem}
    .feedback.correct{background:#dcfce7;color:#166534;border:1px solid #86efac}
    .feedback.incorrect{background:#fee2e2;color:#991b1b;border:1px solid #fca5a5}
    .small-muted{font-size:.875rem;color:#6b7280}
    .made-by-top,.made-by-bottom{text-align:center}
    .pill{display:inline-block;border-radius:9999px;padding:.25rem .6rem;font-size:.8rem}
    .pill-green{background:#e7f8ee;color:#0a7a3b;border:1px solid #9be4b8}
    .pill-red{background:#fde8e8;color:#9b1c1c;border:1px solid #f7b4b4}
    .row-gap{row-gap:.5rem}
    .spinner{width:18px;height:18px;border:3px solid #fff;border-top-color:transparent;border-radius:50%;animation:spin .8s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    @media print {.no-print{display:none!important}}
    .btn-rec-recording{ background:#ef4444 !important; color:#fff !important; }
    .dot-rec{ width:10px;height:10px;border-radius:9999px;background:#ef4444;display:inline-block;animation:blink 1s infinite; }
    @keyframes blink { 50%{ opacity:.2 } }
  </style>
</head>
<body class="text-slate-800">
  <div class="container mx-auto p-4 md:p-8 max-w-3xl">
    <header class="text-center mb-8">
      <h1 class="text-4xl md:text-5xl font-bold text-indigo-600 mb-2">Dictée : Comme en Coréen 🎧</h1>
      <p class="text-lg text-slate-600">Écoutez → Écrivez en coréen → Traduisez en français → Enregistrez votre prononciation.</p>
      <div class="mt-4 flex flex-wrap items-center justify-center gap-3 no-print">
        <button type="button" class="btn btn-secondary" onclick="window.print()" aria-label="Imprimer la page">🖨️ Imprimer / 페이지 인쇄</button>
      </div>
      <div class="made-by-top mt-3 text-sm text-slate-500">
        made by <b>성일, Pongdang</b> · <a href="mailto:Lapeace29@gmail.com" class="underline">Lapeace29@gmail.com</a>
      </div>
    </header>

    <section class="card mb-8 no-print">
      <label class="block font-semibold mb-2">Nom de l'étudiant / 학생 이름</label>
      <input id="student-name" type="text" class="w-full p-3 border-2 rounded-lg focus:border-indigo-500"
             placeholder="Ex. Camille, Noé, Chloé..." />
      <p class="small-muted mt-2">
        Dès le début, nous enregistrons : votre nom, le nombre d’écoutes/indices/essais, et vos scores de prononciation.
        / 시작하면 이름, 듣기·힌트·시도 횟수, 발음 점수까지 기록돼요.
      </p>
    </section>

    <section id="explanations" class="mb-10 card">
      <h2 class="text-2xl font-bold mb-3 text-slate-700">Rappel : La Règle d'Or 🔑</h2>
      <div class="space-y-2 text-slate-700">
        <p>🙋‍♀️ <strong class="korean-font text-green-600">같아요</strong> : “~와/과 같다” (간단 비교).</p>
        <p>✍️ <strong class="korean-font text-purple-600">같은</strong> : 명사 수식(“~같은 + 명사”).</p>
        <p>🏃‍♂️ <strong class="korean-font text-blue-600">처럼 / 같이</strong> : 동작 비교(동사와 함께). <span class="small-muted">같이는 ‘함께’ 의미도 있어요.</span></p>
      </div>
    </section>

    <section id="dictation-exercises"></section>

    <section class="mt-8 flex flex-wrap items-center gap-3 no-print">
      <button type="button" class="btn btn-secondary" id="restart-btn">↺ Réessayer / 다시하기</button>
      <button type="button" class="btn btn-primary" id="finish-btn">✅ Terminer / 끝내기</button>
    </section>

    <div class="made-by-bottom mt-6 text-sm text-slate-500">
      made by <b>성일, Pongdang</b> · <a href="mailto:Lapeace29@gmail.com" class="underline">Lapeace29@gmail.com</a>
    </div>
  </div>

  <!-- 공용 발음 모듈 -->
  <script src="/assets/pronun-client.js"></script>

  <script>
    const exercises = [
      { sentence: "천사 같아요.", translation: "Elle est comme un ange.", hint1: "ㅊㅅ ㄱㅇㅇ", hint2: "천사 = ange", voice: "Kore" },
      { sentence: "이건 꿈 같아요.", translation: "Ceci est comme un rêve.", hint1: "ㅇㄱ ㄲ ㄱㅇㅇ", hint2: "꿈 = rêve", voice: "Puck" },
      { sentence: "가족 같은 친구예요.", translation: "C'est une amie comme ma famille.", hint1: "ㄱㅈ ㄱㅇ ㅊㄱㅇㅇ", hint2: "가족 = famille", voice: "Charon" },
      { sentence: "바다 같은 넓은 마음.", translation: "Un coeur large comme la mer.", hint1: "ㅂㄷ ㄱㅇ ㄴㅇ ㅁㅇ", hint2: "바다 = mer, 넓은 = large", voice: "alloy" },
      { sentence: "소처럼 먹어요.", translation: "Il/Elle mange comme une vache.", hint1: "ㅅㅊㄹ ㅁㅇㅇ", hint2: "소 = vache", voice: "Fenrir" },
      { sentence: "그 사람은 바람처럼 달려요.", translation: "Il court comme le vent.", hint1: "ㄱㄴ ㅂㄹㅊㄹ ㄷㄹㅇ", hint2: "바람 = vent", voice: "Orus" },
      { sentence: "가수같이 노래를 잘해요.", translation: "Il/Elle chante bien comme un(e) chanteur(se).", hint1: "ㄱㅅㄱㅇ ㄴㄹㄹ ㅈㅎㅇ", hint2: "가수 = chanteur/chanteuse", voice: "Aoede" },
      { sentence: "로봇같이 걸어요.", translation: "Il/Elle marche comme un robot.", hint1: "ㄹㅂㄱㅇ ㄱㅇㅇ", hint2: "로봇
