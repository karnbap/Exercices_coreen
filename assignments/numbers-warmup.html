<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Coréen — Nombres | Explications + Warming up</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="../assets/style.css">
  <style>
    body{font-family:'Poppins','Noto Sans KR',sans-serif;}
    .quiz-container{max-width:860px;margin:2rem auto;padding:2rem;background:#f9fafb;border-radius:1rem;box-shadow:0 10px 15px -3px rgba(0,0,0,.08),0 4px 6px -2px rgba(0,0,0,.04)}
    .btn{padding:.75rem 1.25rem;border-radius:.65rem;font-weight:600;cursor:pointer;transition:all .2s;border:none}
    .btn-primary{background:#3b82f6;color:#fff}.btn-primary:hover{background:#2563eb}
    .btn-sound{background:#10b981;color:#fff}.btn-sound:hover{background:#059669}
    .small-muted{ font-size:.9rem; color:#64748b; }
    .readable { line-height: 1.9; }
    .readable p { margin-top: 0.9rem; margin-bottom: 0.9rem; }
    .readable .kicker { font-size: .96rem; letter-spacing: .02em; color:#64748b; }
    .info-card { background:#fff; border:1px solid #e5e7eb; border-radius:1rem; padding:1.15rem 1.25rem; box-shadow:0 1px 2px rgba(16,24,40,.06); }
    .info-card h3 { font-weight:700; font-size:1.125rem; color:#0f172a; margin-bottom:.5rem; }
    .callout { background:#fef9c3; border:1px solid #fde68a; color:#92400e; padding:.9rem 1rem; border-radius:.85rem; }
    .soft-divider { height:1px; margin:1.35rem 0; background:linear-gradient(to right, transparent, #e5e7eb, transparent); }
    .table-soft th { background:#f8fafc; color:#0f172a; }
    .table-soft th, .table-soft td { padding:1rem; }
    .brand-tag{position:fixed;right:16px;bottom:12px;font-size:12px;color:#9ca3af}
  </style>
</head>
<body class="bg-gray-50">

  <!-- 설명 -->
  <div class="min-h-screen flex flex-col items-center justify-center text-center p-6">
    <div class="max-w-3xl w-full mx-auto readable">
      <h1 class="text-4xl md:text-5xl font-extrabold text-slate-900 mb-3 leading-tight">Exercice : Les Nombres Coréens 🔢</h1>
      <p class="kicker mb-6">순수 한국어 / Natifs vs 한자어 / Hanja-coréens</p>

      <div class="grid md:grid-cols-2 gap-6 text-left">
        <div class="info-card">
          <h3>1️⃣ Petite explication / 간단 설명</h3>
          <div class="callout">👉 « 한자 = chinois(언어) »가 아니에요! Hanja=문자 체계, Chinois=언어.</div>
          <ul class="list-disc list-inside mt-3 space-y-1.5">
            <li><strong>한자 (Hanja)</strong> = système d’écriture</li>
            <li><strong>Chinois</strong> = langue</li>
          </ul>
        </div>
        <div class="info-card">
          <h3>2️⃣ Deux systèmes / 두 가지 숫자</h3>
          <p class="mb-2"><strong>순수 한국어</strong> ↔ <strong>한자어</strong></p>
          <div class="grid grid-cols-2 gap-3">
            <div class="p-3 rounded-lg bg-blue-50 border border-blue-200">
              <div class="font-semibold text-blue-900">Natifs</div>
              <div class="text-xl font-bold">하나, 둘, 셋…</div>
              <div class="small-muted">Âge, personnes, objets…</div>
            </div>
            <div class="p-3 rounded-lg bg-green-50 border border-green-200">
              <div class="font-semibold text-green-900">Hanja-coréens</div>
              <div class="text-xl font-bold">일, 이, 삼…</div>
              <div class="small-muted">Dates, argent, minutes…</div>
            </div>
          </div>
        </div>
        <div class="info-card md:col-span-2">
          <h3>⚡ Exception & Tendance</h3>
          <ul class="list-disc list-inside space-y-1.5">
            <li>Heures(시) → <b>natifs</b> · Minutes(분) → <b>Hanja-coréens</b></li>
            <li>« 1 h = 60 min » 체계 이후 시=natifs / 분=Hanja</li>
          </ul>
        </div>
        <div class="info-card md:col-span-2">
          <h3>✅ Résumé / 요약</h3>
          <div class="overflow-x-auto">
            <table class="w-full text-left border-collapse text-sm table-soft">
              <thead>
                <tr>
                  <th class="border border-slate-200">Système / 체계</th>
                  <th class="border border-slate-200">Usage / 용도</th>
                  <th class="border border-slate-200">Exemples / 예</th>
                </tr>
              </thead>
              <tbody>
                <tr class="odd:bg-white even:bg-gray-50">
                  <td class="border border-slate-200 font-semibold">순수 한국어 / Natifs</td>
                  <td class="border border-slate-200">Compter librement, classificateurs, durées libres</td>
                  <td class="border border-slate-200">
                    한 달, 두 달 / 한 개, 두 명, 세 잔, 한 권 / 한 시, 두 시
                  </td>
                </tr>
                <tr class="odd:bg-white even:bg-gray-50">
                  <td class="border border-slate-200 font-semibold">한자어 / Hanja-coréens</td>
                  <td class="border border-slate-200">Valeurs « écrites » (calendrier, montre, monnaie…)</td>
                  <td class="border border-slate-200">
                    1월, 2월 / 10분, 30초 / 2025년 9월 7일, 1,000원 / 3층, 302호
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="soft-divider"></div>
    </div>
  </div>

  <!-- 워밍업 (듣기 0.9배속 + 녹음·평가) -->
  <div class="quiz-container">
    <h2 class="text-3xl font-bold text-slate-800 mb-2 text-center">Méthode 5×5 🗣️ / 5개씩 훈련법</h2>
    <p class="text-lg text-slate-600 mb-8 text-center">Écouter → Répéter → <b>Enregistrer & Évaluer</b> / 듣고 따라 말한 뒤 <b>녹음·평가</b></p>

    <div class="space-y-6">
      <div class="p-4 bg-white rounded-lg shadow-sm">
        <div class="flex items-center justify-between">
          <p class="font-semibold text-lg text-slate-700">Natifs (1–5) : <span class="text-gray-500">하나, 둘, 셋, 넷, 다섯</span></p>
          <button class="btn btn-sound" onclick="onPlayPause('하나, 둘, 셋, 넷, 다섯','alloy',{ speed:0.9 })"><i class="fas fa-play"></i></button>
        </div>
        <div id="wu-pronun-1" class="mt-3 p-3 rounded-lg border border-indigo-200 bg-indigo-50/60"></div>
      </div>

      <div class="p-4 bg-white rounded-lg shadow-sm">
        <div class="flex items-center justify-between">
          <p class="font-semibold text-lg text-slate-700">Natifs (6–10) : <span class="text-gray-500">여섯, 일곱, 여덟, 아홉, 열</span></p>
          <button class="btn btn-sound" onclick="onPlayPause('여섯, 일곱, 여덟, 아홉, 열','shimmer',{ speed:0.9 })"><i class="fas fa-play"></i></button>
        </div>
        <div id="wu-pronun-2" class="mt-3 p-3 rounded-lg border border-indigo-200 bg-indigo-50/60"></div>
      </div>

      <div class="p-4 bg-white rounded-lg shadow-sm">
        <div class="flex items-center justify-between">
          <p class="font-semibold text-lg text-slate-700">Hanja (1–5) : <span class="text-gray-500">일, 이, 삼, 사, 오</span></p>
          <button class="btn btn-sound" onclick="onPlayPause('일, 이, 삼, 사, 오','alloy',{ speed:0.9 })"><i class="fas fa-play"></i></button>
        </div>
        <div id="wu-pronun-3" class="mt-3 p-3 rounded-lg border border-indigo-200 bg-indigo-50/60"></div>
      </div>

      <div class="p-4 bg-white rounded-lg shadow-sm">
        <div class="flex items-center justify-between">
          <p class="font-semibold text-lg text-slate-700">Hanja (6–10) : <span class="text-gray-500">육, 칠, 팔, 구, 십</span></p>
          <button class="btn btn-sound" onclick="onPlayPause('육, 칠, 팔, 구, 십','alloy',{ speed:0.9 })"><i class="fas fa-play"></i></button>
        </div>
        <div id="wu-pronun-4" class="mt-3 p-3 rounded-lg border border-indigo-200 bg-indigo-50/60"></div>
      </div>
    </div>

    <div class="mt-8 text-center">
      <a href="./numbers-exercises.html" class="btn btn-primary text-lg">Commencer l'exercice ! (연습문제 시작!) <i class="fas fa-arrow-right"></i></a>
    </div>
  </div>

  <div class="brand-tag">made by 성일, Pongdang · Lapeace29@gmail.com</div>

  <!-- 기본 TTS/Functions 설정 -->
  <script>
    window.PONGDANG_TTS = window.PONGDANG_TTS || { provider: 'openai' };
    window.PONGDANG_FN_BASE = window.PONGDANG_FN_BASE || '/.netlify/functions';
    // 전사/숫자치환 문구 숨기기(클라이언트가 지원 안하면 아래 scrubber가 제거)
    window.PRONUN_OPTIONS = { hideTranscript: true, hideNumericSwap: true };
  </script>
  <script src="../assets/pronun-utils.js"></script>
  <script src="../assets/pronun-vowel-middleware.js"></script>
  <script src="../assets/pronun-client.js"></script>

  <script>
    const FN_BASE = (window.PONGDANG_FN_BASE || '/.netlify/functions');
    let currentAudio=null,currentBlobUrl=null,currentFetchAbort=null,isPlayingOrFetching=false,audioClickLocked=false;
    const VOICE_MAP={openai:{default:"alloy",alloy:"alloy",shimmer:"verse"},google:{default:"ko-KR-Standard-A",alloy:"ko-KR-Standard-A",shimmer:"ko-KR-Standard-B"}};
    const mapVoice=(p,v)=> (VOICE_MAP[p]||{} )[v] || (VOICE_MAP[p]||{}).default || v;

    function base64ToBlob(b64,mime='audio/mpeg'){const c=b64.includes(',')?b64.split(',')[1]:b64;const s=atob(c);const a=new Uint8Array(s.length);for(let i=0;i<s.length;i++)a[i]=s.charCodeAt(i);return new Blob([a],{type:mime});}
    function updatePlayBtnUI(btn,playing){ if(!btn) return; btn.innerHTML = playing? '<i class="fas fa-pause"></i>' : '<i class="fas fa-play"></i>'; }
    async function onPlayPause(text,voice='alloy',opts={}){
      const btn=event?.currentTarget;
      if(audioClickLocked||isPlayingOrFetching){ if(currentAudio){ try{ if(currentAudio.paused){ await currentAudio.play(); updatePlayBtnUI(btn,true);} else { currentAudio.pause(); updatePlayBtnUI(btn,false);} }catch(_){} } return;}
      audioClickLocked=true; setTimeout(()=>audioClickLocked=false,220);
      try{
        if(currentAudio && currentAudio.src && currentAudio._meta===text){ if(currentAudio.paused){ await currentAudio.play(); updatePlayBtnUI(btn,true);} else { currentAudio.pause(); updatePlayBtnUI(btn,false);} return; }
        isPlayingOrFetching=true;
        if(currentFetchAbort){ try{currentFetchAbort.abort();}catch(_){}
        } if(currentAudio){ try{currentAudio.pause();}catch(_){}
        }
        const ac=new AbortController(); currentFetchAbort=ac;
        const primary=(window.PONGDANG_TTS?.provider)||'openai';
        const payload={ text, voice: mapVoice(primary,voice), provider: primary, speed:(opts.speed ?? opts.speakingRate) };
        const res=await fetch(`${FN_BASE}/generate-audio`,{method:'POST',headers:{'Content-Type':'application/json','Cache-Control':'no-store'},body:JSON.stringify(payload),signal:ac.signal});
        if(!res.ok){ throw new Error('TTS error '+res.status); }
        const data=await res.json();
        let src=null;
        if(data.audioBase64||data.audioContent){ const blob=base64ToBlob(data.audioBase64||data.audioContent,data.mimeType||'audio/mpeg'); src=URL.createObjectURL(blob); currentBlobUrl=src; }
        else if(data.audioUrl){ src=data.audioUrl; }
        const audio=new Audio(src); currentAudio=audio; audio._meta=text;
        audio.addEventListener('playing',()=>updatePlayBtnUI(btn,true));
        audio.addEventListener('pause',()=>updatePlayBtnUI(btn,false));
        audio.addEventListener('ended',()=>updatePlayBtnUI(btn,false));
        await audio.play();
      }catch(e){ alert('오디오 생성/재생 오류. 잠시 후 다시 시도해주세요.'); }
      finally{ isPlayingOrFetching=false; }
    }

    // Pronun mount + “전사”류 문구 제거 스크러버
    function scrubPronun(container){
      if(!container) return;
      const killWords=['전사','transcription','transcrit'];
      const sweep=()=>{
        const nodes=container.querySelectorAll('*');
        nodes.forEach(n=>{
          if(n.childNodes && n.childNodes.length){
            n.childNodes.forEach(c=>{
              if(c.nodeType===3 && killWords.some(k=>c.textContent?.toLowerCase().includes(k))){
                c.textContent='';
              }
            });
          }
        });
      };
      sweep();
      const mo=new MutationObserver(sweep);
      mo.observe(container,{childList:true,subtree:true});
    }

    document.addEventListener('DOMContentLoaded',()=>{
      const blocks=[
        ['wu-pronun-1','하나, 둘, 셋, 넷, 다섯'],
        ['wu-pronun-2','여섯, 일곱, 여덟, 아홉, 열'],
        ['wu-pronun-3','일, 이, 삼, 사, 오'],
        ['wu-pronun-4','육, 칠, 팔, 구, 십'],
      ];
      blocks.forEach(([id,text])=>{
        const el=document.getElementById(id);
        if(el && window.Pronun){
          Pronun.mount(el,{
            getReferenceText:()=>text,
            isKoCorrect:()=>true,
            onResult:()=>{}
          });
          scrubPronun(el);
        }
      });
    });
  </script>

  <div class="brand-tag">made by 성일, Pongdang · Lapeace29@gmail.com</div>
</body>
</html>
