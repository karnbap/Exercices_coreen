<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exercices de CorÃ©en : Ã‰coute et Ã‰criture pour CÃ©dou</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7fafc;
        }
        .bg-gradient-header {
            background-image: linear-gradient(to right, #FF7E5F, #FEB47B);
        }
        .btn-hint-1 {
            background-color: #FACC15;
            color: #854D0E;
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.2s;
        }
        .btn-hint-1:hover {
            background-color: #EAB308;
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }
        .btn-hint-2 {
            background-color: #34D399;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.2s;
        }
        .btn-hint-2:hover {
            background-color: #10B981;
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }
        .btn-check {
            background-color: #3B82F6;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.2s;
        }
        .btn-check:hover {
            background-color: #2563EB;
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }
        .input-text {
            border-color: #D1D5DB;
            border-width: 1px;
            border-radius: 0.5rem;
            padding: 0.5rem 1rem;
            width: 100%;
        }
        .result-box {
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            margin-top: 0.5rem;
            transition: all 0.3s ease-in-out;
        }
        .result-correct {
            background-color: #D1FAE5;
            color: #065F46;
        }
        .result-incorrect {
            background-color: #FEE2E2;
            color: #991B1B;
        }
        .question-card {
            background-color: white;
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center py-10 px-4">
    <div class="max-w-2xl w-full">
        <header class="bg-gradient-header rounded-t-xl text-white p-8 mb-6 text-center">
            <h1 class="text-3xl font-bold">âœ¨ Exercices de CorÃ©en (DÃ©butant) âœ¨</h1>
            <p class="mt-2 text-lg">Ã‰coutez, Ã©crivez et mÃ©morisez les mots et phrases de base. ðŸ‡°ðŸ‡·</p>
        </header>
        
        <div id="quiz-container" class="space-y-6">
            <!-- Les questions seront affichÃ©es ici -->
        </div>

        <div id="results-summary" class="mt-8 p-6 bg-white rounded-xl shadow-lg hidden">
            <h2 class="text-2xl font-bold text-center text-gray-800">ðŸŽ‰ Exercice terminÃ© ! ðŸŽ‰</h2>
            <p class="mt-2 text-center text-gray-600">Vous avez obtenu <span id="score" class="font-bold text-blue-500 text-xl">0</span> sur 50 questions !</p>
            <div class="mt-4 text-center">
                <button onclick="resetQuiz()" class="btn-hint-2 px-6 py-2">Recommencer</button>
            </div>
        </div>
        
    </div>

    <script>
        // Netlify í™˜ê²½ ë³€ìˆ˜ì—ì„œ API í‚¤ë¥¼ ê°€ì ¸ì˜¤ê±°ë‚˜, ë¡œì»¬ í™˜ê²½ì—ì„œëŠ” ë¹ˆ ë¬¸ìžì—´ë¡œ ë‘¡ë‹ˆë‹¤.
        // Netlifyì—ì„œ ë¹Œë“œí•  ë•Œ, í™˜ê²½ ë³€ìˆ˜ ì´ë¦„ì„ "GEMINI_API_KEY"ë¡œ ì„¤ì •í•´ì£¼ì„¸ìš”.
        const apiKey = typeof process !== 'undefined' ? process.env.GEMINI_API_KEY : "";

        // Logique du lecteur audio personnalisÃ©
        const playAudio = async (text) => {
            const payload = {
                contents: [{
                    parts: [{ text: text }]
                }],
                generationConfig: {
                    responseModalities: ["AUDIO"],
                    speechConfig: {
                        voiceConfig: {
                            prebuiltVoiceConfig: { voiceName: "Puck" }
                        }
                    }
                },
                model: "gemini-2.5-flash-preview-tts"
            };
            
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) {
                    throw new Error(`API call failed with status: ${response.status}`);
                }
                const result = await response.json();
                const part = result?.candidates?.[0]?.content?.parts?.[0];
                const audioData = part?.inlineData?.data;
                const mimeType = part?.inlineData?.mimeType;

                if (audioData && mimeType && mimeType.startsWith("audio/")) {
                    const sampleRateMatch = mimeType.match(/rate=(\d+)/);
                    if (sampleRateMatch) {
                        const sampleRate = parseInt(sampleRateMatch[1], 10);
                        const pcmData = base64ToArrayBuffer(audioData);
                        const pcm16 = new Int16Array(pcmData);
                        const wavBlob = pcmToWav(pcm16, sampleRate);
                        const audioUrl = URL.createObjectURL(wavBlob);
                        const audio = new Audio(audioUrl);
                        audio.play();
                    } else {
                        console.error('Sample rate not found in mimeType:', mimeType);
                    }
                } else {
                    console.error('Invalid audio data received:', result);
                }
            } catch (error) {
                console.error('Error during audio generation:', error);
            }
        };

        const base64ToArrayBuffer = (base64) => {
            const binaryString = atob(base64);
            const len = binaryString.length;
            const bytes = new Uint8Array(len);
            for (let i = 0; i < len; i++) {
                bytes[i] = binaryString.charCodeAt(i);
            }
            return bytes.buffer;
        };

        const pcmToWav = (pcmData, sampleRate) => {
            const numChannels = 1;
            const bytesPerSample = 2; // Int16Array
            const blockAlign = numChannels * bytesPerSample;
            const byteRate = sampleRate * blockAlign;

            const buffer = new ArrayBuffer(44 + pcmData.byteLength);
            const view = new DataView(buffer);

            // RIFF header
            writeString(view, 0, 'RIFF');
            view.setUint32(4, 36 + pcmData.byteLength, true);
            writeString(view, 8, 'WAVE');

            // fmt chunk
            writeString(view, 12, 'fmt ');
            view.setUint32(16, 16, true);
            view.setUint16(20, 1, true); // PCM format
            view.setUint16(22, numChannels, true);
            view.setUint32(24, sampleRate, true);
            view.setUint32(28, byteRate, true);
            view.setUint16(32, blockAlign, true);
            view.setUint16(34, 16, true); // bits per sample

            // data chunk
            writeString(view, 36, 'data');
            view.setUint32(40, pcmData.byteLength, true);
            for (let i = 0; i < pcmData.length; i++) {
                view.setInt16(44 + i * 2, pcmData[i], true);
            }

            return new Blob([view], { type: 'audio/wav' });
        };

        const writeString = (view, offset, string) => {
            for (let i = 0; i < string.length; i++) {
                view.setUint8(offset + i, string.charCodeAt(i));
            }
        };

        const questions = [
            // Mots 1-10: Nouveaux mots
            { type: 'mot', audioText: "ë”", hintFr: "plus / encore une fois", hintKrInitial: "ã„·", answer: "ë”" },
            { type: 'mot', audioText: "ì €", hintFr: "Je (formel)", hintKrInitial: "ã…ˆ", answer: "ì €" },
            { type: 'mot', audioText: "ë°˜ì°¬", hintFr: "accompagnements", hintKrInitial: "ã…‚ã…Š", answer: "ë°˜ì°¬" },
            { type: 'mot', audioText: "ì£¼ì„¸ìš”", hintFr: "donnez-moi", hintKrInitial: "ã…ˆã……ã…‡", answer: "ì£¼ì„¸ìš”" },
            { type: 'mot', audioText: "ê´œì°®ì•„ìš”", hintFr: "Ã‡a va / C'est bon", hintKrInitial: "ã„±ã…Šã…‡ã…‡", answer: "ê´œì°®ì•„ìš”" },
            { type: 'mot', audioText: "ë§›ìžˆì–´ìš”", hintFr: "C'est dÃ©licieux", hintKrInitial: "ã…ã…‡ã…†ã…‡", answer: "ë§›ìžˆì–´ìš”" },
            { type: 'mot', audioText: "ë¬¼", hintFr: "Eau", hintKrInitial: "ã…", answer: "ë¬¼" },
            { type: 'mot', audioText: "ë§¥ì£¼", hintFr: "BiÃ¨re", hintKrInitial: "ã…ã…‰", answer: "ë§¥ì£¼" },
            { type: 'mot', audioText: "ì†Œì£¼", hintFr: "Soju (alcool corÃ©en)", hintKrInitial: "ã……ã…ˆ", answer: "ì†Œì£¼" },
            { type: 'mot', audioText: "ë©”ë‰´íŒ", hintFr: "Menu", hintKrInitial: "ã…ã„´ã…", answer: "ë©”ë‰´íŒ" },
            
            // Phrases 1-10: Nouvelles phrases
            { type: 'phrase', audioText: "ë°˜ì°¬ ì¢€ ë” ì£¼ì„¸ìš”", hintFr: "Donnez-moi un peu plus d'accompagnements", hintKrInitial: "ã…‚ã…Š ã…ˆ ã„· ã…ˆã……ã…‡", answer: "ë°˜ì°¬ ì¢€ ë” ì£¼ì„¸ìš”" },
            { type: 'phrase', audioText: "ì´ë¦„ì´ ë­ì˜ˆìš”?", hintFr: "Quel est votre nom ?", hintKrInitial: "ã…‡ã„¹ã…‡ ã…ã…‡ã…‡?", answer: "ì´ë¦„ì´ ë­ì˜ˆìš”?" },
            { type: 'phrase', audioText: "ì €ëŠ” CÃ©dricì´ë¼ê³  í•´ìš”", hintFr: "Je m'appelle CÃ©dric", hintKrInitial: "ã…ˆã„´ ã……ã„·ã„¹ã…‡ã„¹ã„± ã…Žã…‡", answer: "ì €ëŠ” CÃ©dricì´ë¼ê³  í•´ìš”" },
            { type: 'phrase', audioText: "ì–´ë””ì— ì‚´ì•„ìš”?", hintFr: "OÃ¹ habitez-vous ?", hintKrInitial: "ã…‡ã„·ã…‡ ã……ã„¹ã…‡?", answer: "ì–´ë””ì— ì‚´ì•„ìš”?" },
            { type: 'phrase', audioText: "ì´ê±° ì£¼ì„¸ìš”", hintFr: "Donnez-moi Ã§a svp", hintKrInitial: "ã…‡ã„± ã…ˆã……ã…‡", answer: "ì´ê±° ì£¼ì„¸ìš”" },
            { type: 'phrase', audioText: "ê·¸ê±° ì–¼ë§ˆì˜ˆìš”?", hintFr: "Ã‡a coÃ»te combien ?!", hintKrInitial: "ã„±ã„± ã…‡ã…ã…‡ã…‡?", answer: "ê·¸ê±° ì–¼ë§ˆì˜ˆìš”?" },
            { type: 'phrase', audioText: "í™”ìž¥ì‹¤ ì–´ë””ì˜ˆìš”?", hintFr: "OÃ¹ sont les toilettes ?", hintKrInitial: "ã…Žã…ˆã…… ã…‡ã„·ã…‡ã…‡?", answer: "í™”ìž¥ì‹¤ ì–´ë””ì˜ˆìš”?" },
            { type: 'phrase', audioText: "ì•ˆë…•ížˆ ê°€ì„¸ìš”", hintFr: "Au revoir (Ã  une personne qui part)", hintKrInitial: "ã…‡ã„´ã…Ž ã„±ã……ã…‡", answer: "ì•ˆë…•ížˆ ê°€ì„¸ìš”" },
            { type: 'phrase', audioText: "ì•ˆë…•ížˆ ê³„ì„¸ìš”", hintFr: "Au revoir (Ã  une personne qui reste)", hintKrInitial: "ã…‡ã„´ã…Ž ã„±ã……ã…‡", answer: "ì•ˆë…•ížˆ ê³„ì„¸ìš”" },
            { type: 'phrase', audioText: "ì¹œêµ¬", hintFr: "ami(e) du mÃªme Ã¢ge", hintKrInitial: "ã…Šã„±", answer: "ì¹œêµ¬" },
            
            // Mots 11-20: Nombres et vocabulaire
            { type: 'mot', audioText: "í•˜ë‚˜", hintFr: "1", hintKrInitial: "ã…Žã„´", answer: "í•˜ë‚˜" },
            { type: 'mot', audioText: "ë‘˜", hintFr: "2", hintKrInitial: "ã„·", answer: "ë‘˜" },
            { type: 'mot', audioText: "ì…‹", hintFr: "3", hintKrInitial: "ã……", answer: "ì…‹" },
            { type: 'mot', audioText: "ë„·", hintFr: "4", hintKrInitial: "ã„´", answer: "ë„·" },
            { type: 'mot', audioText: "ë‹¤ì„¯", hintFr: "5", hintKrInitial: "ã„·ã……", answer: "ë‹¤ì„¯" },
            { type: 'mot', audioText: "ì—¬ì„¯", hintFr: "6", hintKrInitial: "ã…‡ã……", answer: "ì—¬ì„¯" },
            { type: 'mot', audioText: "ì¼ê³±", hintFr: "7", hintKrInitial: "ã…‡ã„±", answer: "ì¼ê³±" },
            { type: 'mot', audioText: "ì—¬ëŸ", hintFr: "8", hintKrInitial: "ã…‡ã„·", answer: "ì—¬ëŸ" },
            { type: 'mot', audioText: "ì•„í™‰", hintFr: "9", hintKrInitial: "ã…‡ã…Ž", answer: "ì•„í™‰" },
            { type: 'mot', audioText: "ì—´", hintFr: "10", hintKrInitial: "ã…‡", answer: "ì—´" },

            // Phrases 11-20: Voyager en CorÃ©e
            { type: 'phrase', audioText: "ì´ê±° ì–¼ë§ˆì˜ˆìš”?", hintFr: "Ã‡a coÃ»te combien ?", hintKrInitial: "ã…‡ã„± ã…‡ã…ã…‡ã…‡?", answer: "ì´ê±° ì–¼ë§ˆì˜ˆìš”?" },
            { type: 'phrase', audioText: "ìž ì‹œë§Œìš”", hintFr: "Un instant s'il vous plaÃ®t", hintKrInitial: "ã…ˆã……ã…ã…‡", answer: "ìž ì‹œë§Œìš”" },
            { type: 'phrase', audioText: "ê³ êµ¬ë§ˆ ì£¼ì„¸ìš”", hintFr: "Donnez-moi une patate douce (ê³ êµ¬ë§ˆ)", hintKrInitial: "ã„±ã„±ã… ã…ˆã……ã…‡", answer: "ê³ êµ¬ë§ˆ ì£¼ì„¸ìš”" },
            { type: 'phrase', audioText: "ì–´ë””ë¡œ ê°€ìš”?", hintFr: "OÃ¹ allez-vous ?", hintKrInitial: "ã…‡ã„·ã„¹ ã„±ã…‡?", answer: "ì–´ë””ë¡œ ê°€ìš”?" },
            { type: 'phrase', audioText: "ê°ì‚¬í•©ë‹ˆë‹¤", hintFr: "Merci", hintKrInitial: "ã„±ã……ã…Žã„´ã„·", answer: "ê°ì‚¬í•©ë‹ˆë‹¤" },
            { type: 'phrase', audioText: "ì£„ì†¡í•©ë‹ˆë‹¤", hintFr: "DÃ©solÃ©(e) (trÃ¨s poli)", hintKrInitial: "ã…ˆã……ã…Žã„´ã„·", answer: "ì£„ì†¡í•©ë‹ˆë‹¤" },
            { type: 'phrase', audioText: "ê´œì°®ì•„ìš”", hintFr: "Ã‡a va", hintKrInitial: "ã„±ã…Šã…‡ã…‡", answer: "ê´œì°®ì•„ìš”" },
            { type: 'phrase', audioText: "ë©”ë‰´íŒ ì£¼ì„¸ìš”", hintFr: "Donnez-moi le menu", hintKrInitial: "ã…ã„´ã… ã…ˆã……ã…‡", answer: "ë©”ë‰´íŒ ì£¼ì„¸ìš”" },
            { type: 'phrase', audioText: "ë¬¼ ì£¼ì„¸ìš”", hintFr: "Donnez-moi de l'eau", hintKrInitial: "ã… ã…ˆã……ã…‡", answer: "ë¬¼ ì£¼ì„¸ìš”" },
            { type: 'phrase', audioText: "ë§›ìžˆì–´ìš”!", hintFr: "C'est dÃ©licieux !", hintKrInitial: "ã…ã…‡ã…†ã…‡!", answer: "ë§›ìžˆì–´ìš”!" },

            // Mots 21-30: Divers
            { type: 'mot', audioText: "ê¹€ì¹˜", hintFr: "Kimchi", hintKrInitial: "ã„±ã…Š", answer: "ê¹€ì¹˜" },
            { type: 'mot', audioText: "ë°¥", hintFr: "Riz cuit", hintKrInitial: "ã…‚", answer: "ë°¥" },
            { type: 'mot', audioText: "êµ­", hintFr: "Soupe", hintKrInitial: "ã„±", answer: "êµ­" },
            { type: 'mot', audioText: "ì§‘", hintFr: "Maison", hintKrInitial: "ã…ˆ", answer: "ì§‘" },
            { type: 'mot', audioText: "ì¹œêµ¬", hintFr: "Ami", hintKrInitial: "ã…Šã„±", answer: "ì¹œêµ¬" },
            { type: 'mot', audioText: "ì„ ìƒë‹˜", hintFr: "Professeur", hintKrInitial: "ã……ã……ã„´", answer: "ì„ ìƒë‹˜" },
            { type: 'mot', audioText: "í•™ìƒ", hintFr: "Ã‰tudiant", hintKrInitial: "ã…Žã……", answer: "í•™ìƒ" },
            { type: 'mot', audioText: "í•™êµ", hintFr: "Ã‰cole", hintKrInitial: "ã…Žã„±", answer: "í•™êµ" },
            { type: 'mot', audioText: "ì‚¬ê³¼", hintFr: "Pomme", hintKrInitial: "ã……ã„±", answer: "ì‚¬ê³¼" },
            { type: 'mot', audioText: "ë°”ë‚˜ë‚˜", hintFr: "Banane", hintKrInitial: "ã…‚ã„´ã„´", answer: "ë°”ë‚˜ë‚˜" }
        ];

        let score = 0;
        const quizContainer = document.getElementById('quiz-container');

        const renderQuiz = () => {
            quizContainer.innerHTML = '';
            let motCounter = 0;
            let phraseCounter = 0;

            questions.forEach((q, index) => {
                const questionCard = document.createElement('div');
                questionCard.className = 'question-card mb-4';

                let questionLabel = '';
                if (q.type === 'phrase') {
                    phraseCounter++;
                    questionLabel = `Phrase ${phraseCounter}`;
                } else {
                    motCounter++;
                    questionLabel = `Mot ${motCounter}`;
                }
                
                questionCard.innerHTML = `
                    <div class="flex flex-col space-y-4">
                        <p class="text-sm text-gray-500 font-medium mb-1">${questionLabel}</p>
                        <p class="text-gray-700 text-lg">
                            ${q.hintFr}
                        </p>
                        <div class="flex items-center space-x-2">
                            <button class="btn-hint-1" id="hint-initial-${index}" onclick="showHintInitial(${index})">
                                Indice (consonne initiales)
                            </button>
                            <button class="btn-hint-2" id="hint-audio-${index}" onclick="playAudio('${q.audioText}')">
                                ðŸ”Š Indice (Ã‰couter)
                            </button>
                        </div>
                        <p id="initial-text-${index}" class="text-xl text-gray-700 font-bold hidden mt-2"></p>
                        <input type="text" id="answer-${index}" class="input-text" placeholder="Ã‰crivez la rÃ©ponse ici en corÃ©en..." onkeydown="handleEnter(event, ${index})">
                    </div>
                    <div class="mt-4 flex justify-end">
                        <button onclick="checkAnswer(${index})" class="btn-check">
                            VÃ©rifier
                        </button>
                    </div>
                    <div id="result-box-${index}" class="result-box hidden mt-4"></div>
                `;
                quizContainer.appendChild(questionCard);
            });
        };

        const showHintInitial = (index) => {
            const initialTextElement = document.getElementById(`initial-text-${index}`);
            initialTextElement.innerText = questions[index].hintKrInitial;
            initialTextElement.classList.remove('hidden');
        };

        const checkAnswer = (index) => {
            const q = questions[index];
            const resultBox = document.getElementById(`result-box-${index}`);
            const inputElement = document.getElementById(`answer-${index}`);
            const userAnswer = inputElement.value;
            const checkButton = document.querySelector(`#quiz-container .question-card:nth-child(${index + 1}) .btn-check`);

            // Nettoyer la rÃ©ponseë¥¼ ìœ„í•´ ë¶ˆí•„ìš”í•œ ë¬¸ìž¥ ë¶€í˜¸ì™€ ê³µë°±ì„ ì œê±°í•©ë‹ˆë‹¤.
            const cleanedUserAnswer = userAnswer.trim().replace(/[.,!?]/g, '');
            const cleanedCorrectAnswer = q.answer.trim().replace(/[.,!?]/g, '');

            if (cleanedUserAnswer.toLowerCase() === cleanedCorrectAnswer.toLowerCase()) {
                resultBox.className = 'result-box result-correct';
                resultBox.innerText = `âœ… C'est la bonne rÃ©ponse ! La rÃ©ponse est "${q.answer}".`;
                score++;
            } else {
                resultBox.className = 'result-box result-incorrect';
                resultBox.innerText = `âŒ Ce n'est pas la bonne rÃ©ponse. La rÃ©ponse est "${q.answer}".`;
            }
            resultBox.classList.remove('hidden');

            // ì •ë‹µ í™•ì¸ ë²„íŠ¼ì€ í•œë²ˆ ëˆ„ë¥´ë©´ ì‚¬ë¼ì§‘ë‹ˆë‹¤.
            checkButton.classList.add('hidden');
        };

        const handleEnter = (event, index) => {
            if (event.key === 'Enter') {
                checkAnswer(index);
            }
        };

        const showSummary = () => {
            const summaryContainer = document.getElementById('results-summary');
            const scoreElement = document.getElementById('score');
            
            quizContainer.classList.add('hidden');
            summaryContainer.classList.remove('hidden');
            scoreElement.innerText = score;
        };

        const resetQuiz = () => {
            score = 0;
            document.getElementById('results-summary').classList.add('hidden');
            quizContainer.classList.remove('hidden');
            renderQuiz();
        };

        window.onload = () => {
            renderQuiz();
        };
    </script>
</body>
</html>
