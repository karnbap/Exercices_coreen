<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exercice CorÃ©en: Le Sens CachÃ© de ì€/ëŠ”</title>
    <script src="https://cdn.tailwindcss.com/"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        .made-by { font-size: 0.8rem; color: #888; text-align: center; padding: 15px; }
        .question-card { scroll-margin-top: 80px; }
        .correct { border: 2px solid #22c55e; background-color: #f0fdf4; }
        .incorrect { border: 2px solid #ef4444; background-color: #fef2f2; }
        [type="radio"]:checked { background-image: url("data:image/svg+xml,%3csvg viewBox='0' 0 16 16' fill='%234f46e5' xmlns='http://www.w3.org/2000/svg'%3e%3ccircle cx='8' cy='8' r='3'/%3e%3c/svg%3e"); }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div class="made-by">Made by ì„±ì¼, Pongdang</div>

    <div class="max-w-4xl mx-auto p-5">
        <header class="flex justify-between items-center mb-6">
            <div>
                <h1 class="text-3xl font-bold text-slate-700">Exercice: Le Sens CachÃ© de ì€/ëŠ”</h1>
                <p class="text-slate-500">ì—°ìŠµë¬¸ì œ: ì¡°ì‚¬ì˜ ìˆ¨ì€ ëœ» 'ì€/ëŠ”'</p>
            </div>
            <button onclick="window.print()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition">
                Imprimer / í”„ë¦°íŠ¸
            </button>
        </header>

        <!-- Student Info -->
        <div id="student-info" class="mb-8 bg-white p-6 rounded-xl shadow-md">
            <label for="studentName" class="block text-lg font-semibold mb-2">Entrez votre nom / ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:</label>
            <input type="text" id="studentName" class="w-full p-3 border rounded-lg" placeholder="">
            <button id="start-btn" class="mt-4 w-full bg-indigo-600 text-white py-3 rounded-lg text-lg font-bold hover:bg-indigo-700 transition">Commencer l'exercice (ì‹œì‘)</button>
        </div>

        <!-- Main Content -->
        <main id="quiz-content" class="hidden">
            
            <!-- Explanation -->
            <div class="bg-sky-100 border-l-4 border-sky-500 text-sky-800 p-6 rounded-lg mb-8 space-y-6">
                <div>
                    <h2 class="text-2xl font-bold mb-3">â­ Pourquoi ì€/ëŠ” est si spÃ©cial ?</h2>
                    <p class="mb-2">En franÃ§ais, pour comparer, on doit souvent faire de longues phrases. Par exemple :</p>
                    <p class="p-4 bg-white rounded-md italic text-gray-600">
                        "J'aime les pommes, mais je n'aime pas les bananes, et je n'aime pas non plus les poires."
                    </p>
                    <p class="mt-2">En corÃ©en, grÃ¢ce Ã  <strong>ì€/ëŠ”</strong>, on peut dire tout Ã§a de maniÃ¨re super efficace !</p>
                    <p class="p-4 bg-white rounded-md font-bold text-indigo-700">
                        ì €ëŠ” ì‚¬ê³¼<span class="text-red-600">ëŠ”</span> ì¢‹ì•„í•´ìš”.
                    </p>
                    <p class="mt-2">En utilisant <span class="text-red-600 font-bold">ëŠ”</span>, on met "la pomme" en avant et tout le monde comprend qu'on n'aime pas forcÃ©ment les autres fruits. C'est un peu un "super-pouvoir" du corÃ©en ! C'est difficile au dÃ©but, mais suivons les Ã©tapes ensemble pour le maÃ®triser ! ğŸ’ª</p>
                </div>
                
                <div>
                    <h2 class="text-2xl font-bold mb-3">ğŸ§ Les bases Ã  connaÃ®tre</h2>
                    <div class="space-y-4 mt-2">
                        <div class="p-4 bg-white rounded-md">
                            <h3 class="font-bold">C'est quoi un "ë°›ì¹¨" ? (batchim)</h3>
                            <p>Le <strong>ë°›ì¹¨</strong> est la <strong>consonne finale</strong> d'une syllabe. C'est elle qui dÃ©cide si on utilise <strong>ì€</strong> (avec ë°›ì¹¨) ou <strong>ëŠ”</strong> (sans ë°›ì¹¨).<br>
                            - Ex: <span class="font-bold">ì±…</span> (chaek) â†’ se termine par <span class="font-bold text-red-600">ã„±</span> (k) â†’ <strong>ì±…<span class="text-red-600">ì€</span></strong>.<br>
                            - Ex: <span class="font-bold">ì €</span> (jeo) â†’ se termine par <span class="font-bold text-red-600">ã…“</span> (eo) â†’ <strong>ì €<span class="text-red-600">ëŠ”</span></strong>.
                            </p>
                        </div>
                         <div class="p-4 bg-white rounded-md">
                            <h3 class="font-bold">âš ï¸ ì€/ëŠ” vs ì´/ê°€ (Sujet)</h3>
                            <p>
                                <strong>ì´/ê°€</strong> : Identifie le sujet. C'est lui et personne d'autre. RÃ©pond Ã  "qui ?" ou "quoi ?".<br>
                                <span class="text-gray-600">Ex: <strong>í´<span class="text-blue-600">ì´</span></strong> ì™”ì–´ìš”. (C'est Paul qui est venu.)</span><br><br>
                                <strong>ì€/ëŠ”</strong> : Met le sujet en contraste avec d'autres. <br>
                                <span class="text-gray-600">Ex: <strong>í´<span class="text-red-600">ì€</span></strong> ì™”ì–´ìš”. (Paul, LUI, il est venu... les autres, non.)</span>
                            </p>
                        </div>
                         <div class="p-4 bg-white rounded-md">
                            <h3 class="font-bold">âš ï¸ ì€/ëŠ” vs ì„/ë¥¼ (Objet)</h3>
                            <p>
                                <strong>ì„/ë¥¼</strong> : Marque simplement l'objet de l'action.<br>
                                <span class="text-gray-600">Ex: ì €ëŠ” <strong>ë¹µ<span class="text-blue-600">ì„</span></strong> ë¨¹ì—ˆì–´ìš”. (J'ai mangÃ© du pain. - Simple constat.)</span><br><br>
                                <strong>ì€/ëŠ”</strong> : Met l'objet en contraste avec d'autres objets possibles.<br>
                                <span class="text-gray-600">Ex: ì €ëŠ” <strong>ë¹µ<span class="text-red-600">ì€</span></strong> ë¨¹ì—ˆì–´ìš”. (J'ai mangÃ© du pain [<em>...mais pas le reste</em>].)</span>
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <form id="quiz-form"></form>

            <div class="mt-8 flex justify-between items-center">
                <a href="/" class="text-indigo-600 hover:underline">â† Exercices prÃ©cÃ©dents (ì´ì „)</a>
            </div>
        </main>
        
        <!-- Results -->
        <div id="results" class="hidden mt-8 text-center bg-white p-8 rounded-xl shadow-lg">
            <h2 class="text-3xl font-bold mb-4">RÃ©sultats / ê²°ê³¼</h2>
            <div id="result-message" class="text-2xl font-semibold p-6 rounded-lg mb-4"></div>
            <p class="text-lg">Votre score : <span id="score" class="font-bold"></span>%</p>
            <p class="text-slate-600">Temps total : <span id="total-time"></span> secondes.</p>
            <p class="mt-6 text-slate-700">Voici le dÃ©tail de vos rÃ©ponses ci-dessous :</p>
            <p class="text-slate-500 text-sm">(ì•„ë˜ì—ì„œ ìì„¸í•œ ë‹µë³€ ë‚´ìš©ì„ í™•ì¸í•˜ì„¸ìš”.)</p>
            <button id="restart-btn" class="mt-8 bg-indigo-600 text-white py-3 px-8 rounded-lg text-lg font-bold hover:bg-indigo-700 transition">Recommencer (ë‹¤ì‹œí•˜ê¸°)</button>
        </div>
    </div>

    <div class="made-by">Made by ì„±ì¼, Pongdang</div>

<script>
    // --- DATA ---
    const namePlaceholders = ['Super CÃ©dou', 'Championne Julie', 'GÃ©nie Martin', 'As de CorÃ©en Sophie', 'LÃ©gende Alex'];
    let studentName = '', startTime, endTime, currentSectionIndex = 0, questions = [], userAnswers = [];

    // --- DOM ELEMENTS ---
    const studentInfoDiv = document.getElementById('student-info');
    const studentNameInput = document.getElementById('studentName');
    const quizContentDiv = document.getElementById('quiz-content');
    const resultsDiv = document.getElementById('results');
    const startBtn = document.getElementById('start-btn');
    const quizForm = document.getElementById('quiz-form');
    const restartBtn = document.getElementById('restart-btn');

    // --- FUNCTIONS ---
    function generateQuestions() {
        return [
            { section: 'Partie 1: Choisir la bonne particule (ì¡°ì‚¬ ê³ ë¥´ê¸°)', type: 'multiple-choice', ko: 'ì €ëŠ” ê°œ___ ì¢‹ì•„í•´ìš”. (ê³ ì–‘ì´ëŠ” ì•ˆ ì¢‹ì•„í•´ìš”)', fr: 'J\'aime les chiens (mais pas les chats).', options: ['ëŠ”', 'ê°€', 'ë¥¼'], answer: 'ëŠ”', vocab: [{ko:'ê°œ', fr:'chien'}], explanation: "On compare 'les chiens' et 'les chats'. La particule de contraste ì€/ëŠ” est parfaite ici." },
            { section: 'Partie 1: Choisir la bonne particule (ì¡°ì‚¬ ê³ ë¥´ê¸°)', type: 'multiple-choice', ko: 'ì´ ì‹ë‹¹___ ë¹„ì‹¸ìš”. (ë‹¤ë¥¸ ì‹ë‹¹ì€ ì•ˆ ë¹„ì‹¸ìš”)', fr: 'Ce restaurant est cher (contrairement aux autres).', options: ['ì€', 'ì´', 'ì—'], answer: 'ì€', vocab: [{ko:'ì‹ë‹¹', fr:'restaurant'}], explanation: "On met 'ce restaurant' en opposition aux autres. C'est une comparaison, donc on utilise ì€/ëŠ”." },
            { section: 'Partie 1: Choisir la bonne particule (ì¡°ì‚¬ ê³ ë¥´ê¸°)', type: 'multiple-choice', ko: 'ì˜¤ëŠ˜___ ë‚ ì”¨ê°€ ì¶¥ë„¤ìš”. (ì–´ì œëŠ” ì•ˆ ì¶”ì› ì–´ìš”)', fr: 'Aujourd\'hui il fait froid (contrairement Ã  hier).', options: ['ì€', 'ì´', 'ì—'], answer: 'ì€', vocab: [{ko:'ì˜¤ëŠ˜', fr:'aujourd\'hui'}], explanation: "On contraste la mÃ©tÃ©o d'aujourd'hui avec celle d'hier. Le mot 'ì˜¤ëŠ˜' se termine par un ë°›ì¹¨ (ã„´), donc on utilise ì€." },
            { section: 'Partie 1: Choisir la bonne particule (ì¡°ì‚¬ ê³ ë¥´ê¸°)', type: 'multiple-choice', ko: 'í•œêµ­ì–´___ ì¬ë¯¸ìˆì–´ìš”. (ì¼ë³¸ì–´ëŠ” ì¬ë¯¸ì—†ì–´ìš”)', fr: 'Le corÃ©en est amusant (contrairement au japonais).', options: ['ëŠ”', 'ê°€', 'ë¥¼'], answer: 'ëŠ”', vocab: [{ko:'í•œêµ­ì–´', fr:'langue corÃ©enne'}], explanation: "Le corÃ©en est comparÃ© au japonais. 'í•œêµ­ì–´' n'a pas de ë°›ì¹¨, donc on utilise ëŠ”." },
            { section: 'Partie 1: Choisir la bonne particule (ì¡°ì‚¬ ê³ ë¥´ê¸°)', type: 'multiple-choice', ko: 'ì´ ì˜í™”___ ë´¤ì–´ìš”. (ë‹¤ë¥¸ ì˜í™”ëŠ” ëª» ë´¤ì–´ìš”)', fr: 'J\'ai vu ce film (mais pas les autres).', options: ['ëŠ”', 'ê°€', 'ë¥¼'], answer: 'ëŠ”', vocab: [{ko:'ì˜í™”', fr:'film'}], explanation: "On met en avant 'ce film' par rapport aux autres. 'ì˜í™”' n'a pas de ë°›ì¹¨, donc on ajoute ëŠ”." },
            { section: 'Partie 2: Deviner le sens cachÃ© (ìˆ¨ì€ ëœ» ì°¾ê¸°)', type: 'multiple-choice', ko: 'ë¬¸ì¥: "ì»¤í”¼<span class="text-red-500 font-bold">ëŠ”</span> ë§ˆì…¨ì–´ìš”."<br>ì´ ë¬¸ì¥ì˜ ìˆ¨ì€ ëœ»ì€ ë¬´ì—‡ì¼ê¹Œìš”?', fr: 'Phrase: "J\'ai bu le cafÃ©."<br>Quel est le sens cachÃ© de cette phrase ?', options: ['ë‹¤ë¥¸ ê²ƒì€ ì•ˆ ë§ˆì…¨ì–´ìš” (Je n\'ai rien bu d\'autre)', 'ëª¨ë“  ê²ƒì„ ë§ˆì…¨ì–´ìš” (J\'ai tout bu)', 'ì»¤í”¼ê°€ ë§›ì—†ì–´ìš” (Le cafÃ© n\'est pas bon)'], answer: 'ë‹¤ë¥¸ ê²ƒì€ ì•ˆ ë§ˆì…¨ì–´ìš” (Je n\'ai rien bu d\'autre)', vocab: [{ko:'ì»¤í”¼', fr:'cafÃ©'}], explanation: "L'utilisation de ëŠ” suggÃ¨re que vous avez bu le cafÃ©, mais peut-Ãªtre pas le thÃ© ou le jus d'orange qui Ã©taient aussi disponibles." },
            { section: 'Partie 2: Deviner le sens cachÃ© (ìˆ¨ì€ ëœ» ì°¾ê¸°)', type: 'multiple-choice', ko: 'ë¬¸ì¥: "í´<span class="text-red-500 font-bold">ì€</span> ë˜‘ë˜‘í•´ìš”."<br>ì´ ë¬¸ì¥ì˜ ìˆ¨ì€ ëœ»ì€ ë¬´ì—‡ì¼ê¹Œìš”?', fr: 'Phrase: "Paul est intelligent."<br>Quel est le sens cachÃ© de cette phrase ?', options: ['ë‹¤ë¥¸ ì‚¬ëŒì€ ì•ˆ ë˜‘ë˜‘í•´ìš” (Les autres ne sont pas intelligents)', 'ëª¨ë‘ ë˜‘ë˜‘í•´ìš” (Tout le monde est intelligent)', 'í´ì€ ì•ˆ ë˜‘ë˜‘í•´ìš” (Paul n\'est pas intelligent)'], answer: 'ë‹¤ë¥¸ ì‚¬ëŒì€ ì•ˆ ë˜‘ë˜‘í•´ìš” (Les autres ne sont pas intelligents)', vocab: [{ko:'í´', fr:'Paul'}, {ko:'ë˜‘ë˜‘í•˜ë‹¤', fr:'intelligent'}], explanation: "En disant 'í´ì€', on met Paul en avant. Cela sous-entend souvent une comparaison avec d'autres personnes qui, elles, ne le sont peut-Ãªtre pas." },
            { section: 'Partie 2: Deviner le sens cachÃ© (ìˆ¨ì€ ëœ» ì°¾ê¸°)', type: 'multiple-choice', ko: 'ë¬¸ì¥: "ê²¨ìš¸<span class="text-red-500 font-bold">ì€</span> ì¶”ì›Œìš”."<br>ì´ ë¬¸ì¥ì˜ ìˆ¨ì€ ëœ»ì€ ë¬´ì—‡ì¼ê¹Œìš”?', fr: 'Phrase: "L\'hiver est froid."<br>Quel est le sens cachÃ© de cette phrase ?', options: ['ë‹¤ë¥¸ ê³„ì ˆì€ ì•ˆ ì¶”ì›Œìš” (Les autres saisons ne sont pas froides)', 'ëª¨ë“  ê³„ì ˆì´ ì¶”ì›Œìš” (Toutes les saisons sont froides)', 'ê²¨ìš¸ì€ ë”°ëœ»í•´ìš” (L\'hiver est chaud)'], answer: 'ë‹¤ë¥¸ ê³„ì ˆì€ ì•ˆ ì¶”ì›Œìš” (Les autres saisons ne sont pas froides)', vocab: [{ko:'ê²¨ìš¸', fr:'hiver'}, {ko:'ì¶¥ë‹¤', fr:'froid'}], explanation: "On dÃ©crit une caractÃ©ristique de l'hiver, en le contrastant implicitement avec les autres saisons comme l'Ã©tÃ©, qui est chaud." },
            { section: 'Partie 2: Deviner le sens cachÃ© (ìˆ¨ì€ ëœ» ì°¾ê¸°)', type: 'multiple-choice', ko: 'ë¬¸ì¥: "ì±…<span class="text-red-500 font-bold">ì€</span> ì½ì—ˆì–´ìš”."<br>ì´ ë¬¸ì¥ì˜ ìˆ¨ì€ ëœ»ì€ ë¬´ì—‡ì¼ê¹Œìš”?', fr: 'Phrase: "J\'ai lu le livre."<br>Quel est le sens cachÃ© de cette phrase ?', options: ['ìˆ™ì œëŠ” ì•ˆ í–ˆì–´ìš” (Je n\'ai pas fait les devoirs)', 'ëª¨ë“  ê²ƒì„ ë‹¤ í–ˆì–´ìš” (J\'ai tout fait)', 'ì±…ì´ ì¬ë¯¸ì—†ì–´ìš” (Le livre n\'est pas amusant)'], answer: 'ìˆ™ì œëŠ” ì•ˆ í–ˆì–´ìš” (Je n\'ai pas fait les devoirs)', vocab: [{ko:'ì±…', fr:'livre'}, {ko:'ìˆ™ì œ', fr:'devoirs'}], explanation: "Cela veut dire que l'action de 'lire le livre' a Ã©tÃ© faite, mais cela sous-entend que d'autres actions (comme faire les devoirs) n'ont pas Ã©tÃ© faites." },
            { section: 'Partie 2: Deviner le sens cachÃ© (ìˆ¨ì€ ëœ» ì°¾ê¸°)', type: 'multiple-choice', ko: 'ë¬¸ì¥: "ì§€í•˜ì² <span class="text-red-500 font-bold">ì€</span> ë¹¨ë¼ìš”."<br>ì´ ë¬¸ì¥ì˜ ìˆ¨ì€ ëœ»ì€ ë¬´ì—‡ì¼ê¹Œìš”?', fr: 'Phrase: "Le mÃ©tro est rapide."<br>Quel est le sens cachÃ© de cette phrase ?', options: ['ë²„ìŠ¤ëŠ” ëŠë ¤ìš” (Le bus est lent)', 'ëª¨ë“  êµí†µìˆ˜ë‹¨ì´ ë¹¨ë¼ìš” (Tous les transports sont rapides)', 'ì§€í•˜ì² ì´ ëŠë ¤ìš” (Le mÃ©tro est lent)'], answer: 'ë²„ìŠ¤ëŠ” ëŠë ¤ìš” (Le bus est lent)', vocab: [{ko:'ì§€í•˜ì² ', fr:'mÃ©tro'}, {ko:'ë²„ìŠ¤', fr:'bus'}], explanation: "En mettant l'accent sur le mÃ©tro, on le compare souvent Ã  d'autres moyens de transport, comme le bus, qui est gÃ©nÃ©ralement plus lent." },
            { section: 'Partie 3: ComplÃ©ter avec un mot (ë‹¨ì–´ ì“°ê¸°)', type: 'write-word', ko: 'ì˜¤ëŠ˜ì€ ë¥ì§€ë§Œ, ___ ì¶”ì› ì–´ìš”.', fr: 'Situation: Aujourd\'hui il fait chaud. Mais hier il faisait froid.<br>Phrase: Aujourd\'hui il fait chaud, mais ___ il faisait froid.', answer: 'ì–´ì œëŠ”', vocab: [{ko:'ì–´ì œ', fr:'hier'}], explanation: "On oppose 'aujourd'hui' (ì˜¤ëŠ˜) Ã  'hier' (ì–´ì œ). Pour marquer ce contraste sur 'hier', on ajoute ëŠ”." },
            { section: 'Partie 3: ComplÃ©ter avec un mot (ë‹¨ì–´ ì“°ê¸°)', type: 'write-word', ko: 'ì €ëŠ” ê°œëŠ” ì¢‹ì•„í•˜ì§€ë§Œ, ___ ë¬´ì„œì›Œìš”.', fr: 'Situation: J\'aime les chiens. Mais j\'ai peur des chats.<br>Phrase: J\'aime les chiens, mais j\'ai peur ___ .', answer: 'ê³ ì–‘ì´ëŠ”', vocab: [{ko:'ê³ ì–‘ì´', fr:'chat'}], explanation: "Ici, 'les chats' (ê³ ì–‘ì´) sont mis en opposition aux chiens. Il faut donc ajouter ëŠ”." },
            { section: 'Partie 3: ComplÃ©ter avec un mot (ë‹¨ì–´ ì“°ê¸°)', type: 'write-word', ko: 'ì‚¬ê³¼ëŠ” ë§›ìˆì§€ë§Œ, ___ ë§›ì—†ì–´ìš”.', fr: 'Situation: Les pommes sont dÃ©licieuses. Mais les bananes ne sont pas bonnes.<br>Phrase: Les pommes sont bonnes, mais ___ ne sont pas bonnes.', answer: 'ë°”ë‚˜ë‚˜ëŠ”', vocab: [{ko:'ë°”ë‚˜ë‚˜', fr:'banane'}], explanation: "La phrase compare les pommes et les bananes. Pour contraster 'banane' (ë°”ë‚˜ë‚˜), on utilise ëŠ”." },
            { section: 'Partie 3: ComplÃ©ter avec un mot (ë‹¨ì–´ ì“°ê¸°)', type: 'write-word', ko: 'ì €ëŠ” í•œêµ­ì–´ëŠ” ê³µë¶€í•˜ì§€ë§Œ, ___ ê³µë¶€ ì•ˆ í•´ìš”.', fr: 'Situation: J\'Ã©tudie le corÃ©en. Mais je n\'Ã©tudie pas le chinois.<br>Phrase: J\'Ã©tudie le corÃ©en, mais je n\'Ã©tudie pas ___ .', answer: 'ì¤‘êµ­ì–´ëŠ”', vocab: [{ko:'ì¤‘êµ­ì–´', fr:'chinois'}], explanation: "Le mot Ã  complÃ©ter est 'chinois' (ì¤‘êµ­ì–´), qui est contrastÃ© avec 'corÃ©en'. On ajoute ëŠ”." },
            { section: 'Partie 3: ComplÃ©ter avec un mot (ë‹¨ì–´ ì“°ê¸°)', type: 'write-word', ko: 'ì €ëŠ” ì˜í™”ëŠ” ë´¤ì§€ë§Œ, ___ ëª» ì½ì—ˆì–´ìš”.', fr: 'Situation: J\'ai vu le film. Mais je n\'ai pas pu lire le livre.<br>Phrase: J\'ai vu le film, mais je n\'ai pas pu lire ___ .', answer: 'ì±…ì€', vocab: [{ko:'ì±…', fr:'livre'}], explanation: "On oppose 'le film' et 'le livre' (ì±…). 'ì±…' a un ë°›ì¹¨, donc on utilise ì€ pour le contraste." },
            { section: 'Partie 4: Traduire la situation (ìƒí™© ë²ˆì—­í•˜ê¸°)', type: 'translate-sentence', situation_fr: 'Situation : Vous aimez les pommes, mais pas les autres fruits.', prompt_fr: 'La phrase Ã  traduire : J\'aime les pommes (mais...).', answer: 'ì €ëŠ” ì‚¬ê³¼ëŠ” ì¢‹ì•„í•´ìš”', vocab: [{ko:'ì‚¬ê³¼', fr:'pomme'}, {ko:'ì¢‹ì•„í•˜ë‹¤', fr:'aimer'}], explanation: "Pour dire que vous aimez 'les pommes' en particulier, mettez l'accent dessus avec ëŠ”. 'ì‚¬ê³¼' + 'ëŠ”'." },
            { section: 'Partie 4: Traduire la situation (ìƒí™© ë²ˆì—­í•˜ê¸°)', type: 'translate-sentence', situation_fr: 'Situation : Vous parlez bien corÃ©en, mais pas bien anglais.', prompt_fr: 'La phrase Ã  traduire : Je parle bien corÃ©en (mais...).', answer: 'ì €ëŠ” í•œêµ­ì–´ëŠ” ì˜í•´ìš”', vocab: [{ko:'í•œêµ­ì–´', fr:'corÃ©en'}, {ko:'ì˜í•˜ë‹¤', fr:'bien faire'}], explanation: "On met 'le corÃ©en' (í•œêµ­ì–´) en avant. Comme il n'y a pas de ë°›ì¹¨, on utilise ëŠ”." },
            { section: 'Partie 4: Traduire la situation (ìƒí™© ë²ˆì—­í•˜ê¸°)', type: 'translate-sentence', situation_fr: 'Situation : L\'Ã©tÃ© est chaud, mais l\'hiver est froid.', prompt_fr: 'La phrase Ã  traduire : L\'Ã©tÃ© est chaud (contrairement Ã  l\'hiver).', answer: 'ì—¬ë¦„ì€ ë”ì›Œìš”', vocab: [{ko:'ì—¬ë¦„', fr:'Ã©tÃ©'}, {ko:'ë¥ë‹¤', fr:'chaud'}], explanation: "Pour contraster 'l'Ã©tÃ©' (ì—¬ë¦„) avec les autres saisons, on utilise ì€ car il y a un ë°›ì¹¨ (ã…)." },
            { section: 'Partie 4: Traduire la situation (ìƒí™© ë²ˆì—­í•˜ê¸°)', type: 'translate-sentence', situation_fr: 'Situation : Vous avez lu le livre, mais pas le journal.', prompt_fr: 'La phrase Ã  traduire : J\'ai lu le livre (mais...).', answer: 'ì €ëŠ” ì±…ì€ ì½ì—ˆì–´ìš”', vocab: [{ko:'ì±…', fr:'livre'}, {ko:'ì½ë‹¤', fr:'lire'}], explanation: "On souligne l'action sur 'le livre' (ì±…). Il y a un ë°›ì¹¨ (ã„±), donc on ajoute ì€." },
            { section: 'Partie 4: Traduire la situation (ìƒí™© ë²ˆì—­í•˜ê¸°)', type: 'translate-sentence', situation_fr: 'Situation : Le mÃ©tro est rapide, mais le bus est lent.', prompt_fr: 'La phrase Ã  traduire : Le mÃ©tro est rapide (contrairement au bus).', answer: 'ì§€í•˜ì² ì€ ë¹¨ë¼ìš”', vocab: [{ko:'ì§€í•˜ì² ', fr:'mÃ©tro'}, {ko:'ë¹ ë¥´ë‹¤', fr:'rapide'}], explanation: "On compare 'le mÃ©tro' (ì§€í•˜ì² ) au bus. 'ì§€í•˜ì² ' a un ë°›ì¹¨ (ã„¹), donc on utilise ì€." }
        ];
    }
    
    function startQuiz() {
        studentName = studentNameInput.value.trim();
        if (studentName === '') {
            alert('Veuillez entrer votre nom. / ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            return;
        }
        startTime = new Date();
        studentInfoDiv.classList.add('hidden');
        quizContentDiv.classList.remove('hidden');
        // Scroll to the explanation area first
        quizContentDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
        renderQuestions();
        showSection(0);
    }

    function renderQuestions() {
        const sections = [...new Set(questions.map(q => q.section))];
        let formHtml = '';
        sections.forEach((sectionTitle, sectionIndex) => {
            formHtml += `<div id="section-${sectionIndex}" class="section-wrapper" style="display: none;">
                <h2 class="text-2xl font-bold mt-8 mb-4 border-b-2 pb-2 border-indigo-200">${sectionTitle}</h2>`;
            
            questions.forEach((q, questionIndex) => {
                if (q.section === sectionTitle) {
                    let questionHtml = `<div id="q-${questionIndex}" class="question-card bg-white p-6 rounded-xl shadow-md mb-6">`;
                    
                    if (q.type === 'translate-sentence') {
                        questionHtml += `<p class="text-slate-500 mb-2">${q.situation_fr}</p>
                                         <p class="text-lg font-semibold mb-1"><span class="text-indigo-600">La phrase Ã  traduire :</span> ${q.prompt_fr}</p>`;
                    } else {
                         questionHtml += `<p class="text-lg font-semibold mb-1"><span class="text-indigo-600">Question ${questionIndex + 1}:</span> ${q.ko}</p>
                                          <p class="text-slate-500 mb-4">${q.fr || ''}</p>`;
                    }
                    
                    if (q.vocab && q.vocab.length > 0) {
                        questionHtml += `<div class="mt-4 p-3 bg-slate-100 rounded-md text-sm">
                            <h4 class="font-bold text-slate-600 mb-1">Vocabulaire (ë‹¨ì–´)</h4>
                            <ul class="flex flex-wrap gap-x-4 gap-y-1">`;
                        q.vocab.forEach(v => {
                            questionHtml += `<li><span class="font-semibold text-indigo-700">${v.ko}</span>: ${v.fr}</li>`;
                        });
                        questionHtml += `</ul></div>`;
                    }

                    if (q.type === 'multiple-choice') {
                        questionHtml += `<div id="options-${questionIndex}" class="space-y-3 mt-4">`;
                        q.options.forEach(option => {
                            questionHtml += `<label class="p-4 border rounded-lg cursor-pointer hover:bg-indigo-50 transition block">
                                <input type="radio" name="q${questionIndex}" value="${option}" class="mr-3 accent-indigo-600">
                                <span>${option}</span>
                            </label>`;
                        });
                        questionHtml += `</div>`;
                    } else if (q.type === 'write-word' || q.type === 'translate-sentence') {
                         questionHtml += `<input type="text" id="q${questionIndex}-input" class="w-full p-2 border rounded-lg mt-4" placeholder="Ã‰crivez votre rÃ©ponse ici...">`;
                    }
                    questionHtml += `<div id="feedback-${questionIndex}" class="mt-3 text-sm"></div>
                                     <div class="mt-4"><a href="#" onclick="showHint(${questionIndex}); return false;" class="text-sm text-blue-600 hover:underline">Aidez moi ! ğŸ™ (ë„ì™€ì£¼ì„¸ìš”!)</a></div>
                                     </div>`;
                    formHtml += questionHtml;
                }
            });

            formHtml += `<div class="mt-6 flex justify-end items-center space-x-3">`;
            if (sectionIndex > 0) {
                formHtml += `<button type="button" onclick="navigate(-1)" class="bg-slate-300 text-slate-700 px-5 py-2 rounded-lg hover:bg-slate-400 transition">Partie PrÃ©cÃ©dente (ì´ì „)</button>`;
            }
            if (sectionIndex < sections.length - 1) {
                formHtml += `<button type="button" onclick="navigate(1)" class="bg-indigo-500 text-white px-5 py-2 rounded-lg hover:bg-indigo-600 transition">Partie Suivante (ë‹¤ìŒ)</button>`;
            } else {
                formHtml += `<button type="button" id="finish-btn-final" class="bg-green-600 text-white px-5 py-2 rounded-lg font-bold hover:bg-green-700 transition">Terminer (ëë‚´ê¸°)</button>`;
            }
            formHtml += `</div></div>`;
        });
        quizForm.innerHTML = formHtml;
        document.getElementById('finish-btn-final').addEventListener('click', finishQuiz);
    }

    function showHint(index) {
        const q = questions[index];
        const feedbackDiv = document.getElementById(`feedback-${index}`);
        let hintText = "ğŸ›Ÿ Au secours ! (ì‚´ë ¤ì£¼ì„¸ìš”!)<br>";
        if (q.explanation) {
            hintText += q.explanation;
            feedbackDiv.innerHTML = `<p class="mt-2 p-3 bg-yellow-100 border-l-4 border-yellow-500 text-yellow-800 rounded-md">${hintText}</p>`;
        }
    }

    function showSection(index) {
        document.querySelectorAll('.section-wrapper').forEach(card => card.style.display = 'none');
        const targetSection = document.getElementById(`section-${index}`);
        if (targetSection) {
            targetSection.style.display = 'block';
            if (index > 0) {
                 targetSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }
    }
    
    function navigate(direction) {
        const sections = [...new Set(questions.map(q => q.section))];
        const currentSectionTitle = sections[currentSectionIndex];
        questions.forEach((q, index) => {
            if (q.section === currentSectionTitle) {
                saveAnswer(index);
            }
        });
        currentSectionIndex += direction;
        showSection(currentSectionIndex);
    }

    function saveAnswer(index) {
        const q = questions[index];
        if (q.type === 'multiple-choice') {
            const selected = document.querySelector(`input[name="q${index}"]:checked`);
            userAnswers[index] = selected ? selected.value : null;
        } else {
            const input = document.getElementById(`q${index}-input`);
            userAnswers[index] = input ? input.value.trim() : null;
        }
    }

    function finishQuiz() {
        const sections = [...new Set(questions.map(q => q.section))];
        const lastSectionTitle = sections[currentSectionIndex];
        questions.forEach((q, index) => {
            if (q.section === lastSectionTitle) saveAnswer(index);
        });

        endTime = new Date();
        resultsDiv.classList.remove('hidden');
        resultsDiv.scrollIntoView({ behavior: 'smooth' });
        
        quizContentDiv.classList.remove('hidden');
        document.querySelectorAll('.section-wrapper').forEach((card, index) => {
            card.style.display = 'block';
            card.querySelectorAll('.flex.justify-end').forEach(nav => nav.style.display = 'none');
        });


        let correctCount = 0;
        const questionsPayload = questions.map((q, i) => {
            const userAnswer = userAnswers[i] || "";
            let isCorrect = false;
            
            if (q.type === 'multiple-choice') {
                isCorrect = userAnswer === q.answer;
                 document.querySelector(`#q-${i}`).querySelectorAll('label').forEach(label => {
                    const radio = label.querySelector('input');
                    if (radio.value === q.answer) label.classList.add('correct');
                    else if (radio.checked) label.classList.add('incorrect');
                    radio.disabled = true;
                });
            } else { // write-word & translate-sentence
                const cleanUserAnswer = userAnswer.replace(/[.?\s]/g, '');
                const cleanAnswer = q.answer.replace(/[.?\s]/g, '');
                isCorrect = cleanUserAnswer.includes(cleanAnswer);
                const input = document.getElementById(`q${i}-input`);
                input.disabled = true;
                input.classList.add(isCorrect ? 'correct' : 'incorrect');
                if (!isCorrect) {
                    const feedbackDiv = document.getElementById(`feedback-${i}`);
                    feedbackDiv.innerHTML = `<p class="mt-2 text-green-700">Exemple de rÃ©ponse : <strong>${q.answer}</strong></p>`;
                }
            }

            if (isCorrect) {
                correctCount++;
            }
            
            const payload_fr = q.fr || q.situation_fr;
            const payload_ko = q.ko || q.prompt_fr;

            return { 
                number: i + 1, 
                ko: payload_ko.replace(/<[^>]*>?/gm, ''), 
                fr: payload_fr.replace(/<[^>]*>?/gm, ''), 
                userAnswer: userAnswer,
                isCorrect: isCorrect,
            };
        });

        const score = (correctCount / questions.length) * 100;
        document.getElementById('score').innerText = score.toFixed(0);
        const totalTimeSeconds = Math.round((endTime - startTime) / 1000);
        document.getElementById('total-time').innerText = totalTimeSeconds;
        
        const resultMessageDiv = document.getElementById('result-message');
        let message, frMessage, bgColor;
        if (score === 100) { [frMessage, message, bgColor] = ["Parfait absolu ! ğŸ‘‘ğŸ‰", "ì™„ë²½ ê·¸ ìì²´! ğŸ‘‘ğŸ‰", 'bg-green-100 text-green-800']; }
        else if (score >= 80) { [frMessage, message, bgColor] = ["TrÃ¨s bien jouÃ© ! ğŸ‘", "ì•„ì£¼ ì˜í–ˆì–´ìš”! ğŸ‘", 'bg-blue-100 text-blue-800']; }
        else if (score >= 60) { [frMessage, message, bgColor] = ["Pas mal du tout ! ğŸ˜", "ê½¤ ì˜í–ˆì–´ìš”! ğŸ˜", 'bg-yellow-100 text-yellow-800']; }
        else { [frMessage, message, bgColor] = ["Allez, on repart ! â˜•ğŸ’ª", "ì, ë‹¤ì‹œ ê°€ì! â˜•ğŸ’ª", 'bg-red-100 text-red-800']; }
        resultMessageDiv.innerHTML = `${frMessage}<br>${message}`;
        resultMessageDiv.className = `text-2xl font-semibold p-6 rounded-lg mb-4 ${bgColor}`;

        const payload = { 
            studentName, 
            startTime: startTime.toISOString(), 
            endTime: endTime.toISOString(), 
            totalTimeSeconds, 
            questions: questionsPayload,
        };
        
        fetch('/.netlify/functions/send-results', {
            method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload)
        }).catch(error => {
            console.error("Error sending results:", error);
        });
    }
    
    // --- INIT ---
    document.addEventListener('DOMContentLoaded', () => {
        studentNameInput.placeholder = "Ex: Super CÃ©dou, Championne Julie...";
        questions = generateQuestions();
        userAnswers = new Array(questions.length).fill(null);
        currentSectionIndex = 0;
    });
    
    startBtn.addEventListener('click', startQuiz);
    restartBtn.addEventListener('click', () => window.location.reload());
</script>
</body>
</html>

