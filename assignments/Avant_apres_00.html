// ğŸ” ê²°ê³¼ ìƒì„¸ ë¦¬ë·° ë Œë” (ë¼ë²¨ì„ ì‰¬ìš´ ë¶ˆì–´+í•œê¸€ë¡œ)
function renderDetailedReview(){
  const reviewEl = document.getElementById('detailed-review');
  if(!reviewEl) return;

  const items = questionsData.filter(q=>q.type!=='explanation');
  if(!items.length){
    reviewEl.innerHTML = '';
    return;
  }

  const rows = items.map((qd, idx) => {
    // í•™ìƒ ë‹µ í‘œí˜„
    let ua = '';
    if (typeof qd.userAnswer === 'string') ua = qd.userAnswer || '';
    else if (qd.userAnswer && (qd.userAnswer.dictation1 || qd.userAnswer.dictation2)) {
      ua = [qd.userAnswer.dictation1, qd.userAnswer.dictation2].filter(Boolean).join(' / ');
    }

    // ì •ë‹µ í…ìŠ¤íŠ¸(ìš°ì„ : correctAnswer â†’ ko)
    const gold = (qd.correctAnswer || qd.ko || '');

    // ì˜¤íƒ€ í—ˆìš©ìœ¼ë¡œ ë§ì€ ê²½ìš° ì•ˆë‚´
    const looseEqual = normalizeForLoose(ua) === normalizeForLoose(gold);
    const hint = (qd.isCorrect && !looseEqual)
      ? `<span class="text-amber-700 text-xs ml-2">(Petite faute tolÃ©rÃ©e / ì˜¤íƒ€ í—ˆìš©)</span>`
      : '';

    // íƒ€ì… ë¼ë²¨(ì‰¬ìš´ ë¶ˆì–´+í•œê¸€)
    const typeLabel = ({
      'multiple-choice':'Choix / ì„ íƒ',
      'fill-in-the-blank':'Trou / ë¹ˆì¹¸',
      'translate-sentence':'Traduction / ë²ˆì—­',
      'listening-dictation':'DictÃ©e / ë“£ê¸°'
    })[qd.type] || qd.type;

    // ì •ì˜¤ í‘œì‹œ ë±ƒì§€
    const badge = qd.isCorrect
      ? `<span class="inline-block px-2 py-0.5 rounded-full text-xs font-bold bg-green-100 text-green-700">Correct / ì •ë‹µ</span>`
      : `<span class="inline-block px-2 py-0.5 rounded-full text-xs font-bold bg-rose-100 text-rose-700">Incorrect / ì˜¤ë‹µ</span>`;

    // ë©”íƒ€(ì²­ì·¨/íŒíŠ¸ ì‚¬ìš©)
    const meta = `
      <div class="text-xs text-slate-500 mt-2">
        Ã‰coute(ë“£ê¸°): ${qd.listenCount||0} Â· Indice dÃ©but(ì´ˆì„±): ${qd.hint1Count||0} Â· Indice mot(ë‹¨ì–´): ${qd.hint2Count||0}
      </div>`;

    return `
      <div class="p-4 rounded-lg border border-slate-200 bg-slate-50">
        <div class="flex items-center gap-2 mb-1">
          <span class="text-sm font-semibold text-slate-600">${idx+1}. ${typeLabel}</span>
          ${badge}
        </div>
        ${qd.fr ? `<div class="text-sm text-slate-600 mb-1">FranÃ§ais(ë¶ˆì–´): ${qd.fr}</div>` : ''}
        ${qd.ko ? `<div class="text-sm text-slate-600 mb-1">RÃ©ponse correcte / ì •ë‹µ: <span class="font-semibold text-slate-800">${qd.ko}</span></div>` : ''}
        ${qd.correctAnswer ? `<div class="text-sm text-slate-600 mb-1">Forme correcte / ì •ë‹µ í˜•íƒœ: <span class="font-semibold text-slate-800">${qd.correctAnswer}</span></div>` : ''}
        <div class="text-sm mt-1">
          Ma rÃ©ponse / ë‚´ ë‹µ:
          <span class="font-semibold ${qd.isCorrect?'text-emerald-700':'text-rose-700'}">${ua || '(Non saisi / ë¯¸ì…ë ¥)'}</span>
          ${hint}
        </div>
        ${meta}
      </div>
    `;
  }).join('');

  reviewEl.innerHTML = `
    <h3 class="text-xl font-bold text-slate-900 mb-3">RÃ©sultats dÃ©taillÃ©s / ê²°ê³¼ ìƒì„¸ ë¦¬ë·°</h3>
    <div class="space-y-3">${rows}</div>
  `;
  reviewEl.scrollIntoView({ behavior:'smooth', block:'start' });
}
