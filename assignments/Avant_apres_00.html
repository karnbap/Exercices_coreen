// 🔎 결과 상세 리뷰 렌더 (라벨을 쉬운 불어+한글로)
function renderDetailedReview(){
  const reviewEl = document.getElementById('detailed-review');
  if(!reviewEl) return;

  const items = questionsData.filter(q=>q.type!=='explanation');
  if(!items.length){
    reviewEl.innerHTML = '';
    return;
  }

  const rows = items.map((qd, idx) => {
    // 학생 답 표현
    let ua = '';
    if (typeof qd.userAnswer === 'string') ua = qd.userAnswer || '';
    else if (qd.userAnswer && (qd.userAnswer.dictation1 || qd.userAnswer.dictation2)) {
      ua = [qd.userAnswer.dictation1, qd.userAnswer.dictation2].filter(Boolean).join(' / ');
    }

    // 정답 텍스트(우선: correctAnswer → ko)
    const gold = (qd.correctAnswer || qd.ko || '');

    // 오타 허용으로 맞은 경우 안내
    const looseEqual = normalizeForLoose(ua) === normalizeForLoose(gold);
    const hint = (qd.isCorrect && !looseEqual)
      ? `<span class="text-amber-700 text-xs ml-2">(Petite faute tolérée / 오타 허용)</span>`
      : '';

    // 타입 라벨(쉬운 불어+한글)
    const typeLabel = ({
      'multiple-choice':'Choix / 선택',
      'fill-in-the-blank':'Trou / 빈칸',
      'translate-sentence':'Traduction / 번역',
      'listening-dictation':'Dictée / 듣기'
    })[qd.type] || qd.type;

    // 정오 표시 뱃지
    const badge = qd.isCorrect
      ? `<span class="inline-block px-2 py-0.5 rounded-full text-xs font-bold bg-green-100 text-green-700">Correct / 정답</span>`
      : `<span class="inline-block px-2 py-0.5 rounded-full text-xs font-bold bg-rose-100 text-rose-700">Incorrect / 오답</span>`;

    // 메타(청취/힌트 사용)
    const meta = `
      <div class="text-xs text-slate-500 mt-2">
        Écoute(듣기): ${qd.listenCount||0} · Indice début(초성): ${qd.hint1Count||0} · Indice mot(단어): ${qd.hint2Count||0}
      </div>`;

    return `
      <div class="p-4 rounded-lg border border-slate-200 bg-slate-50">
        <div class="flex items-center gap-2 mb-1">
          <span class="text-sm font-semibold text-slate-600">${idx+1}. ${typeLabel}</span>
          ${badge}
        </div>
        ${qd.fr ? `<div class="text-sm text-slate-600 mb-1">Français(불어): ${qd.fr}</div>` : ''}
        ${qd.ko ? `<div class="text-sm text-slate-600 mb-1">Réponse correcte / 정답: <span class="font-semibold text-slate-800">${qd.ko}</span></div>` : ''}
        ${qd.correctAnswer ? `<div class="text-sm text-slate-600 mb-1">Forme correcte / 정답 형태: <span class="font-semibold text-slate-800">${qd.correctAnswer}</span></div>` : ''}
        <div class="text-sm mt-1">
          Ma réponse / 내 답:
          <span class="font-semibold ${qd.isCorrect?'text-emerald-700':'text-rose-700'}">${ua || '(Non saisi / 미입력)'}</span>
          ${hint}
        </div>
        ${meta}
      </div>
    `;
  }).join('');

  reviewEl.innerHTML = `
    <h3 class="text-xl font-bold text-slate-900 mb-3">Résultats détaillés / 결과 상세 리뷰</h3>
    <div class="space-y-3">${rows}</div>
  `;
  reviewEl.scrollIntoView({ behavior:'smooth', block:'start' });
}
