<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Exercices d'Ã©coute en CorÃ©en (20 Questions)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Roboto', 'Noto Sans KR', sans-serif; background-color: #f0f2f5; }
    .audio-btn { transition: all 0.3s ease; }
    .audio-btn:hover { transform: scale(1.1); background-color: #4a5568; }
    .audio-btn.loading { cursor: not-allowed; background-color: #a0aec0; animation: pulse 1.5s infinite; }
    @keyframes pulse { 0%,100%{opacity:1;} 50%{opacity:.7;} }
    .answer-box { transition: max-height .5s ease-in-out, opacity .5s ease-in-out; max-height:0; opacity:0; overflow:hidden; }
    .answer-box.show { max-height: 200px; opacity:1; }
    .particle-btn { transition: all .2s ease; }
  </style>
</head>
<body class="bg-gray-100 text-gray-800 p-4 md:p-8">

  <div class="max-w-4xl mx-auto bg-white rounded-2xl shadow-lg p-6 md:p-8"
       id="exerciseCard"
       data-teacher-email="prof@exemple.com">
    <header class="text-center mb-6 border-b pb-4">
      <h1 class="text-3xl md:text-4xl font-bold text-indigo-600">Exercices d'Ã©coute en CorÃ©en (ë“£ê¸° ì—°ìŠµ)</h1>
      <p class="text-gray-600 mt-2">Ã‰coutez attentivement et rÃ©solvez les 20 exercices pour maÃ®triser la grammaire et le vocabulaire.</p>
    </header>

    <!-- Student Info -->
    <section class="mb-8">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 bg-gray-50 p-4 rounded-xl">
        <div>
          <label for="student_name" class="block text-sm text-gray-600 mb-1">Nom de l'Ã©lÃ¨ve (ì„ íƒ)</label>
          <input id="student_name" type="text" placeholder="Votre nom"
                 class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-indigo-500">
        </div>
        <div>
          <label for="student_email" class="block text-sm text-gray-600 mb-1">Email de l'Ã©lÃ¨ve (ì„ íƒ)</label>
          <input id="student_email" type="email" placeholder="you@example.com"
                 class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-indigo-500">
        </div>
      </div>
    </section>

    <!-- Exercice 1: ComplÃ©tez la phrase -->
    <section class="mb-12">
      <h2 class="text-2xl font-bold mb-4 text-gray-700 border-l-4 border-indigo-500 pl-4">
        Exercice 1 : ComplÃ©tez la phrase (ë¹ˆì¹¸ ì±„ìš°ê¸°)
      </h2>
      <div class="space-y-6">
        <!-- Q1 -->
        <div class="bg-gray-50 p-5 rounded-lg shadow-sm">
          <p class="mb-3 text-lg">1. Ã‰coutez et complÃ©tez la question.</p>
          <div class="flex items-center gap-4">
            <button class="audio-btn bg-gray-700 text-white w-12 h-12 rounded-full flex items-center justify-center text-2xl"
                    data-text="í”„ë‘ìŠ¤ ì‚¬ëŒë“¤ì€ ë­ë¥¼ ìì£¼ ë¨¹ì–´ìš”?">ğŸ”Š</button>
            <p class="text-xl font-medium">
              í”„ë‘ìŠ¤ ì‚¬ëŒë“¤ì€
              <input type="text" id="q1_input"
                     class="border-b-2 border-gray-300 focus:border-indigo-500 outline-none w-24 text-center bg-transparent">
              ìì£¼ ë¨¹ì–´ìš”?
            </p>
          </div>
          <div class="mt-4 text-right">
            <button onclick="toggleAnswer('q1_answer')" class="bg-indigo-500 text-white py-1 px-4 rounded-md hover:bg-indigo-600 transition">RÃ©ponse</button>
          </div>
          <div id="q1_answer" class="answer-box mt-3 p-3 bg-indigo-100 text-indigo-800 rounded-lg">
            <strong>RÃ©ponse :</strong> ë­ë¥¼ (ou ë­˜)<br>
            <strong>Phrase :</strong> í”„ë‘ìŠ¤ ì‚¬ëŒë“¤ì€ ë­ë¥¼[ë­˜] ìì£¼ ë¨¹ì–´ìš”?
          </div>
        </div>
        <!-- Q2 -->
        <div class="bg-gray-50 p-5 rounded-lg shadow-sm">
          <p class="mb-3 text-lg">2. Ã‰coutez et complÃ©tez la phrase nÃ©gative.</p>
          <div class="flex items-center gap-4">
            <button class="audio-btn bg-gray-700 text-white w-12 h-12 rounded-full flex items-center justify-center text-2xl"
                    data-text="ì €ëŠ” ì¹œêµ¬ë¥¼ ì•ˆ ë§Œë‚¬ì–´ìš”.">ğŸ”Š</button>
            <p class="text-xl font-medium">
              ì €ëŠ” ì¹œêµ¬ë¥¼
              <input type="text" id="q2_input"
                     class="border-b-2 border-gray-300 focus:border-indigo-500 outline-none w-32 text-center bg-transparent">.
            </p>
          </div>
          <div class="mt-4 text-right">
            <button onclick="toggleAnswer('q2_answer')" class="bg-indigo-500 text-white py-1 px-4 rounded-md hover:bg-indigo-600 transition">RÃ©ponse</button>
          </div>
          <div id="q2_answer" class="answer-box mt-3 p-3 bg-indigo-100 text-indigo-800 rounded-lg">
            <strong>RÃ©ponse :</strong> ì•ˆ ë§Œë‚¬ì–´ìš”<br>
            <strong>Phrase :</strong> ì €ëŠ” ì¹œêµ¬ë¥¼ ì•ˆ ë§Œë‚¬ì–´ìš”.
          </div>
        </div>
        <!-- Q3 -->
        <div class="bg-gray-50 p-5 rounded-lg shadow-sm">
          <p class="mb-3 text-lg">3. Ã‰coutez et complÃ©tez avec le nom.</p>
          <div class="flex items-center gap-4">
            <button class="audio-btn bg-gray-700 text-white w-12 h-12 rounded-full flex items-center justify-center text-2xl"
                    data-text="ì €ëŠ” ìŒ€ì„ ìì£¼ ë¨¹ì–´ìš”.">ğŸ”Š</button>
            <p class="text-xl font-medium">
              ì €ëŠ”
              <input type="text" id="q3_input"
                     class="border-b-2 border-gray-300 focus:border-indigo-500 outline-none w-16 text-center bg-transparent">ì„ ìì£¼ ë¨¹ì–´ìš”.
            </p>
          </div>
          <div class="mt-4 text-right">
            <button onclick="toggleAnswer('q3_answer')" class="bg-indigo-500 text-white py-1 px-4 rounded-md hover:bg-indigo-600 transition">RÃ©ponse</button>
          </div>
          <div id="q3_answer" class="answer-box mt-3 p-3 bg-indigo-100 text-indigo-800 rounded-lg">
            <strong>RÃ©ponse :</strong> ìŒ€<br>
            <strong>Phrase :</strong> ì €ëŠ” ìŒ€ì„ ìì£¼ ë¨¹ì–´ìš”. (Je mange souvent du riz.)
          </div>
        </div>
        <!-- Q4 -->
        <div class="bg-gray-50 p-5 rounded-lg shadow-sm">
          <p class="mb-3 text-lg">4. Ã‰coutez et complÃ©tez avec l'adverbe.</p>
          <div class="flex items-center gap-4">
            <button class="audio-btn bg-gray-700 text-white w-12 h-12 rounded-full flex items-center justify-center text-2xl"
                    data-text="í•œêµ­ ì‚¬ëŒë“¤ì€ ê¹€ì¹˜ì°Œê°œë¥¼ ìì£¼ ë¨¹ì–´ìš”.">ğŸ”Š</button>
            <p class="text-xl font-medium">
              í•œêµ­ ì‚¬ëŒë“¤ì€ ê¹€ì¹˜ì°Œê°œë¥¼
              <input type="text" id="q4_input"
                     class="border-b-2 border-gray-300 focus:border-indigo-500 outline-none w-20 text-center bg-transparent"> ë¨¹ì–´ìš”.
            </p>
          </div>
          <div class="mt-4 text-right">
            <button onclick="toggleAnswer('q4_answer')" class="bg-indigo-500 text-white py-1 px-4 rounded-md hover:bg-indigo-600 transition">RÃ©ponse</button>
          </div>
          <div id="q4_answer" class="answer-box mt-3 p-3 bg-indigo-100 text-indigo-800 rounded-lg">
            <strong>RÃ©ponse :</strong> ìì£¼<br>
            <strong>Phrase :</strong> í•œêµ­ ì‚¬ëŒë“¤ì€ ê¹€ì¹˜ì°Œê°œë¥¼ ìì£¼ ë¨¹ì–´ìš”. (Les CorÃ©ens mangent souvent du Kimchi-jjigae.)
          </div>
        </div>
        <!-- Q5 -->
        <div class="bg-gray-50 p-5 rounded-lg shadow-sm">
          <p class="mb-3 text-lg">5. Ã‰coutez et complÃ©tez avec le verbe.</p>
          <div class="flex items-center gap-4">
            <button class="audio-btn bg-gray-700 text-white w-12 h-12 rounded-full flex items-center justify-center text-2xl"
                    data-text="ì €ëŠ” ì‹ë‹¹ì— ë“¤ì–´ê°€ìš”.">ğŸ”Š</button>
            <p class="text-xl font-medium">
              ì €ëŠ” ì‹ë‹¹ì—
              <input type="text" id="q5_input"
                     class="border-b-2 border-gray-300 focus:border-indigo-500 outline-none w-28 text-center bg-transparent">.
            </p>
          </div>
          <div class="mt-4 text-right">
            <button onclick="toggleAnswer('q5_answer')" class="bg-indigo-500 text-white py-1 px-4 rounded-md hover:bg-indigo-600 transition">RÃ©ponse</button>
          </div>
          <div id="q5_answer" class="answer-box mt-3 p-3 bg-indigo-100 text-indigo-800 rounded-lg">
            <strong>RÃ©ponse :</strong> ë“¤ì–´ê°€ìš”<br>
            <strong>Phrase :</strong> ì €ëŠ” ì‹ë‹¹ì— ë“¤ì–´ê°€ìš”. (J'entre dans le restaurant.)
          </div>
        </div>
      </div>
    </section>

    <!-- Exercice 2: Choisissez la bonne particule -->
    <section class="mb-12">
      <h2 class="text-2xl font-bold mb-4 text-gray-700 border-l-4 border-cyan-500 pl-4">
        Exercice 2 : Choisissez la bonne particule (ì¡°ì‚¬ ì„ íƒí•˜ê¸°)
      </h2>
      <div class="space-y-6">
        <!-- Q6 -->
        <div class="bg-gray-50 p-5 rounded-lg shadow-sm">
          <p class="mb-3 text-lg">6. Ã‰coutez et choisissez la particule pour "et".</p>
          <div class="flex items-center gap-4">
            <button class="audio-btn bg-gray-700 text-white w-12 h-12 rounded-full flex items-center justify-center text-2xl"
                    data-text="ê¹€ì¹˜ì™€ ë¼ì§€ê³ ê¸°ê°€ ë“¤ì–´ê°€ìš”.">ğŸ”Š</button>
            <p class="text-xl font-medium">ê¹€ì¹˜<span id="q6_blank" class="font-bold text-cyan-600">__</span> ë¼ì§€ê³ ê¸°ê°€ ë“¤ì–´ê°€ìš”.</p>
          </div>
          <div class="flex gap-4 mt-4" id="q6_options">
            <button onclick="checkParticle('q6','ì™€',true)" class="particle-btn flex-1 bg-gray-200 hover:bg-cyan-200 text-gray-800 font-bold py-2 px-4 rounded">ì™€</button>
            <button onclick="checkParticle('q6','ê³¼',false)" class="particle-btn flex-1 bg-gray-200 hover:bg-cyan-200 text-gray-800 font-bold py-2 px-4 rounded">ê³¼</button>
          </div>
          <div id="q6_answer" class="answer-box mt-3 p-3 bg-cyan-100 text-cyan-800 rounded-lg">
            <strong>RÃ©ponse :</strong> ì™€.<br><strong>Explication :</strong> AprÃ¨s une voyelle (ê¹€ì¹˜), on utilise 'ì™€'.
          </div>
        </div>
        <!-- Q7 -->
        <div class="bg-gray-50 p-5 rounded-lg shadow-sm">
          <p class="mb-3 text-lg">7. Ã‰coutez et choisissez la particule de sujet.</p>
          <div class="flex items-center gap-4">
            <button class="audio-btn bg-gray-700 text-white w-12 h-12 rounded-full flex items-center justify-center text-2xl"
                    data-text="ì œ ì¹œêµ¬ê°€ ì˜í™”ë¥¼ ë´ìš”.">ğŸ”Š</button>
            <p class="text-xl font-medium">ì œ ì¹œêµ¬<span id="q7_blank" class="font-bold text-cyan-600">__</span> ì˜í™”ë¥¼ ë´ìš”.</p>
          </div>
          <div class="flex gap-4 mt-4" id="q7_options">
            <button onclick="checkParticle('q7','ë¥¼',false)" class="particle-btn flex-1 bg-gray-200 hover:bg-cyan-200 text-gray-800 font-bold py-2 px-4 rounded">ë¥¼</button>
            <button onclick="checkParticle('q7','ê°€',true)" class="particle-btn flex-1 bg-gray-200 hover:bg-cyan-200 text-gray-800 font-bold py-2 px-4 rounded">ê°€</button>
          </div>
          <div id="q7_answer" class="answer-box mt-3 p-3 bg-cyan-100 text-cyan-800 rounded-lg">
            <strong>RÃ©ponse :</strong> ê°€.<br><strong>Explication :</strong> 'ì¹œêµ¬' (voyelle) est le sujet, on utilise 'ê°€'.
          </div>
        </div>
        <!-- Q8 -->
        <div class="bg-gray-50 p-5 rounded-lg shadow-sm">
          <p class="mb-3 text-lg">8. Ã‰coutez et choisissez la particule de thÃ¨me.</p>
          <div class="flex items-center gap-4">
            <button class="audio-btn bg-gray-700 text-white w-12 h-12 rounded-full flex items-center justify-center text-2xl"
                    data-text="í•œêµ­ ì‚¬ëŒë“¤ì€ ê¹€ì¹˜ì°Œê°œë¥¼ ìì£¼ ë¨¹ì–´ìš”.">ğŸ”Š</button>
            <p class="text-xl font-medium">í•œêµ­ ì‚¬ëŒ<span id="q8_blank" class="font-bold text-cyan-600">__</span> ê¹€ì¹˜ì°Œê°œë¥¼ ìì£¼ ë¨¹ì–´ìš”.</p>
          </div>
          <div class="flex gap-4 mt-4" id="q8_options">
            <button onclick="checkParticle('q8','ì€',true)" class="particle-btn flex-1 bg-gray-200 hover:bg-cyan-200 text-gray-800 font-bold py-2 px-4 rounded">ì€</button>
            <button onclick="checkParticle('q8','ëŠ”',false)" class="particle-btn flex-1 bg-gray-200 hover:bg-cyan-200 text-gray-800 font-bold py-2 px-4 rounded">ëŠ”</button>
          </div>
          <div id="q8_answer" class="answer-box mt-3 p-3 bg-cyan-100 text-cyan-800 rounded-lg">
            <strong>RÃ©ponse :</strong> ì€.<br><strong>Explication :</strong> AprÃ¨s une consonne (ì‚¬ëŒ), on utilise 'ì€'.
          </div>
        </div>
        <!-- Q9 -->
        <div class="bg-gray-50 p-5 rounded-lg shadow-sm">
          <p class="mb-3 text-lg">9. Ã‰coutez et choisissez la particule d'objet (COD).</p>
          <div class="flex items-center gap-4">
            <button class="audio-btn bg-gray-700 text-white w-12 h-12 rounded-full flex items-center justify-center text-2xl"
                    data-text="ì €ëŠ” ë°¥ì„ ë¨¹ì–´ìš”.">ğŸ”Š</button>
            <p class="text-xl font-medium">ì €ëŠ” ë°¥<span id="q9_blank" class="font-bold text-cyan-600">__</span> ë¨¹ì–´ìš”.</p>
          </div>
          <div class="flex gap-4 mt-4" id="q9_options">
            <button onclick="checkParticle('q9','ì„',true)" class="particle-btn flex-1 bg-gray-200 hover:bg-cyan-200 text-gray-800 font-bold py-2 px-4 rounded">ì„</button>
            <button onclick="checkParticle('q9','ë¥¼',false)" class="particle-btn flex-1 bg-gray-200 hover:bg-cyan-200 text-gray-800 font-bold py-2 px-4 rounded">ë¥¼</button>
          </div>
          <div id="q9_answer" class="answer-box mt-3 p-3 bg-cyan-100 text-cyan-800 rounded-lg">
            <strong>RÃ©ponse :</strong> ì„.<br><strong>Explication :</strong> AprÃ¨s une consonne (ë°¥), on utilise 'ì„'.
          </div>
        </div>
        <!-- Q10 -->
        <div class="bg-gray-50 p-5 rounded-lg shadow-sm">
          <p class="mb-3 text-lg">10. Ã‰coutez et choisissez la particule de lieu/destination.</p>
          <div class="flex items-center gap-4">
            <button class="audio-btn bg-gray-700 text-white w-12 h-12 rounded-full flex items-center justify-center text-2xl"
                    data-text="ì €ëŠ” ì§‘ì— ë“¤ì–´ê°€ìš”.">ğŸ”Š</button>
            <p class="text-xl font-medium">ì €ëŠ” ì§‘<span id="q10_blank" class="font-bold text-cyan-600">__</span> ë“¤ì–´ê°€ìš”.</p>
          </div>
          <div class="flex gap-4 mt-4" id="q10_options">
            <button onclick="checkParticle('q10','ì—',true)" class="particle-btn flex-1 bg-gray-200 hover:bg-cyan-200 text-gray-800 font-bold py-2 px-4 rounded">ì—</button>
            <button onclick="checkParticle('q10','ì—ì„œ',false)" class="particle-btn flex-1 bg-gray-200 hover:bg-cyan-200 text-gray-800 font-bold py-2 px-4 rounded">ì—ì„œ</button>
          </div>
          <div id="q10_answer" class="answer-box mt-3 p-3 bg-cyan-100 text-cyan-800 rounded-lg">
            <strong>RÃ©ponse :</strong> ì—.<br><strong>Explication :</strong> Destination (verbe de mouvement) â†’ 'ì—'.
          </div>
        </div>
      </div>
    </section>

    <!-- Exercice 3: Vrai ou Faux -->
    <section class="mb-12">
      <h2 class="text-2xl font-bold mb-4 text-gray-700 border-l-4 border-green-500 pl-4">
        Exercice 3 : Vrai ou Faux (O/X í€´ì¦ˆ)
      </h2>
      <div class="space-y-6">
        <!-- Q11 -->
        <div class="bg-gray-50 p-5 rounded-lg shadow-sm">
          <p class="mb-3 text-lg">11. Ã‰coutez la question. L'affirmation est-elle la bonne traduction ?</p>
          <div class="flex items-center gap-4 mb-4">
            <button class="audio-btn bg-gray-700 text-white w-12 h-12 rounded-full flex items-center justify-center text-2xl"
                    data-text="ì˜ ë³´ì—¬ìš”?">ğŸ”Š</button>
            <p class="italic text-gray-600">Affirmation : "Tu me vois bien ?"</p>
          </div>
          <div class="flex gap-4" id="q11_options">
            <button onclick="checkTrueFalse('q11', true)"  class="flex-1 bg-blue-200 hover:bg-blue-300 text-blue-800 font-bold py-2 px-4 rounded">Vrai (O)</button>
            <button onclick="checkTrueFalse('q11', false)" class="flex-1 bg-red-200 hover:bg-red-300 text-red-800 font-bold py-2 px-4 rounded">Faux (X)</button>
          </div>
          <div id="q11_answer" class="answer-box mt-3 p-3 bg-green-100 text-green-800 rounded-lg">
            <strong>RÃ©ponse :</strong> Vrai (O).
          </div>
        </div>
        <!-- Q12 -->
        <div class="bg-gray-50 p-5 rounded-lg shadow-sm">
          <p class="mb-3 text-lg">12. Ã‰coutez la phrase. L'affirmation est-elle correcte ?</p>
          <div class="flex items-center gap-4 mb-4">
            <button class="audio-btn bg-gray-700 text-white w-12 h-12 rounded-full flex items-center justify-center text-2xl"
                    data-text="ì €ëŠ” ìŒ€ì„ ìì£¼ ë¨¹ì–´ìš”.">ğŸ”Š</button>
            <p class="italic text-gray-600">Affirmation : "Je mange souvent des pÃ¢tes."</p>
          </div>
          <div class="flex gap-4" id="q12_options">
            <button onclick="checkTrueFalse('q12', true)"  class="flex-1 bg-blue-200 hover:bg-blue-300 text-blue-800 font-bold py-2 px-4 rounded">Vrai (O)</button>
            <button onclick="checkTrueFalse('q12', false)" class="flex-1 bg-red-200 hover:bg-red-300 text-red-800 font-bold py-2 px-4 rounded">Faux (X)</button>
          </div>
          <div id="q12_answer" class="answer-box mt-3 p-3 bg-red-100 text-red-800 rounded-lg">
            <strong>RÃ©ponse :</strong> Faux (X). ìŒ€ = riz.
          </div>
        </div>
        <!-- Q13 -->
        <div class="bg-gray-50 p-5 rounded-lg shadow-sm">
          <p class="mb-3 text-lg">13. Ã‰coutez la phrase. L'affirmation est-elle correcte ?</p>
          <div class="flex items-center gap-4 mb-4">
            <button class="audio-btn bg-gray-700 text-white w-12 h-12 rounded-full flex items-center justify-center text-2xl"
                    data-text="ì œ ì¹œêµ¬ê°€ ì¹œêµ¬ë“¤ì„ ì•ˆ ë§Œë‚¬ì–´ìš”.">ğŸ”Š</button>
            <p class="italic text-gray-600">Affirmation : "Mon ami a rencontrÃ© ses amis."</p>
          </div>
          <div class="flex gap-4" id="q13_options">
            <button onclick="checkTrueFalse('q13', true)"  class="flex-1 bg-blue-200 hover:bg-blue-300 text-blue-800 font-bold py-2 px-4 rounded">Vrai (O)</button>
            <button onclick="checkTrueFalse('q13', false)" class="flex-1 bg-red-200 hover:bg-red-300 text-red-800 font-bold py-2 px-4 rounded">Faux (X)</button>
          </div>
          <div id="q13_answer" class="answer-box mt-3 p-3 bg-red-100 text-red-800 rounded-lg">
            <strong>RÃ©ponse :</strong> Faux (X). ì•ˆ ë§Œë‚¬ì–´ìš” = ne pas avoir rencontrÃ©.
          </div>
        </div>
        <!-- Q14 -->
        <div class="bg-gray-50 p-5 rounded-lg shadow-sm">
          <p class="mb-3 text-lg">14. Ã‰coutez la phrase. L'affirmation est-elle correcte ?</p>
          <div class="flex items-center gap-4 mb-4">
            <button class="audio-btn bg-gray-700 text-white w-12 h-12 rounded-full flex items-center justify-center text-2xl"
                    data-text="í”„ë‘ìŠ¤ ì‚¬ëŒë“¤ì€ ë°”ê²ŒíŠ¸ë¥¼ ê°€ë” ë¨¹ì–´ìš”.">ğŸ”Š</button>
            <p class="italic text-gray-600">Affirmation : "Les FranÃ§ais mangent parfois de la baguette."</p>
          </div>
          <div class="flex gap-4" id="q14_options">
            <button onclick="checkTrueFalse('q14', true)"  class="flex-1 bg-blue-200 hover:bg-blue-300 text-blue-800 font-bold py-2 px-4 rounded">Vrai (O)</button>
            <button onclick="checkTrueFalse('q14', false)" class="flex-1 bg-red-200 hover:bg-red-300 text-red-800 font-bold py-2 px-4 rounded">Faux (X)</button>
          </div>
          <div id="q14_answer" class="answer-box mt-3 p-3 bg-green-100 text-green-800 rounded-lg">
            <strong>RÃ©ponse :</strong> Vrai (O). ê°€ë” = parfois.
          </div>
        </div>
        <!-- Q15 -->
        <div class="bg-gray-50 p-5 rounded-lg shadow-sm">
          <p class="mb-3 text-lg">15. Ã‰coutez la phrase. L'affirmation est-elle correcte ?</p>
          <div class="flex items-center gap-4 mb-4">
            <button class="audio-btn bg-gray-700 text-white w-12 h-12 rounded-full flex items-center justify-center text-2xl"
                    data-text="ì €ëŠ” ì§‘ì— ë“¤ì–´ê°€ìš”.">ğŸ”Š</button>
            <p class="italic text-gray-600">Affirmation : "J'entre dans un restaurant."</p>
          </div>
          <div class="flex gap-4" id="q15_options">
            <button onclick="checkTrueFalse('q15', true)"  class="flex-1 bg-blue-200 hover:bg-blue-300 text-blue-800 font-bold py-2 px-4 rounded">Vrai (O)</button>
            <button onclick="checkTrueFalse('q15', false)" class="flex-1 bg-red-200 hover:bg-red-300 text-red-800 font-bold py-2 px-4 rounded">Faux (X)</button>
          </div>
          <div id="q15_answer" class="answer-box mt-3 p-3 bg-red-100 text-red-800 rounded-lg">
            <strong>RÃ©ponse :</strong> Faux (X). ì§‘ = maison, ì‹ë‹¹ = restaurant.
          </div>
        </div>
      </div>
    </section>

    <!-- Exercice 4: DictÃ©e et Combinaison -->
    <section>
      <h2 class="text-2xl font-bold mb-4 text-gray-700 border-l-4 border-purple-500 pl-4">
        Exercice 4 : DictÃ©e et Combinaison (ë°›ì•„ì“°ê¸° ë° ë¬¸ì¥ ì—°ê²°)
      </h2>
      <div class="space-y-6">
        <!-- Q16 -->
        <div class="bg-gray-50 p-5 rounded-lg shadow-sm">
          <p class="mb-3 text-lg">16. <strong>DictÃ©e :</strong> Ã‰coutez et Ã©crivez la phrase complÃ¨te.</p>
          <div class="flex items-center gap-4 mb-3">
            <button class="audio-btn bg-gray-700 text-white w-12 h-12 rounded-full flex items-center justify-center text-2xl"
                    data-text="ì €ëŠ” ì¹œêµ¬ë¥¼ ì•ˆ ë§Œë‚˜ê³  ì˜í™”ë¥¼ ì•ˆ ë´¤ì–´ìš”.">ğŸ”Š</button>
            <input type="text" id="q16_input"
                   class="w-full p-2 border-2 border-gray-300 rounded-md focus:border-purple-500 outline-none"
                   placeholder="Ã‰crivez ce que vous entendez...">
          </div>
          <div class="mt-4 text-right">
            <button onclick="toggleAnswer('q16_answer')" class="bg-purple-500 text-white py-1 px-4 rounded-md hover:bg-purple-600 transition">RÃ©ponse</button>
          </div>
          <div id="q16_answer" class="answer-box mt-3 p-3 bg-purple-100 text-purple-800 rounded-lg">
            <strong>Phrase :</strong> ì €ëŠ” ì¹œêµ¬ë¥¼ ì•ˆ ë§Œë‚˜ê³  ì˜í™”ë¥¼ ì•ˆ ë´¤ì–´ìš”.<br>
            <strong>Traduction :</strong> Je n'ai pas rencontrÃ© mes amis et je n'ai pas regardÃ© de film.
          </div>
        </div>
        <!-- Q17 -->
        <div class="bg-gray-50 p-5 rounded-lg shadow-sm">
          <p class="mb-3 text-lg">17. <strong>DictÃ©e :</strong> Ã‰coutez et Ã©crivez la phrase complÃ¨te.</p>
          <div class="flex items-center gap-4 mb-3">
            <button class="audio-btn bg-gray-700 text-white w-12 h-12 rounded-full flex items-center justify-center text-2xl"
                    data-text="ê¹€ì¹˜í•˜ê³  ë°¥ì„ ê°™ì´ ë¨¹ì–´ìš”.">ğŸ”Š</button>
            <input type="text" id="q17_input"
                   class="w-full p-2 border-2 border-gray-300 rounded-md focus:border-purple-500 outline-none"
                   placeholder="Ã‰crivez ce que vous entendez...">
          </div>
          <div class="mt-4 text-right">
            <button onclick="toggleAnswer('q17_answer')" class="bg-purple-500 text-white py-1 px-4 rounded-md hover:bg-purple-600 transition">RÃ©ponse</button>
          </div>
          <div id="q17_answer" class="answer-box mt-3 p-3 bg-purple-100 text-purple-800 rounded-lg">
            <strong>Phrase :</strong> ê¹€ì¹˜í•˜ê³  ë°¥ì„ ê°™ì´ ë¨¹ì–´ìš”.<br>
            <strong>Traduction :</strong> Je mange du kimchi et du riz ensemble.
          </div>
        </div>
        <!-- Q18 -->
        <div class="bg-gray-50 p-5 rounded-lg shadow-sm">
          <p class="mb-3 text-lg">18. <strong>Combinaison (-ê³ ) :</strong> Combinez les deux phrases.</p>
          <div class="mb-4">
            <p class="text-xl font-medium">Phrase 1 : ë¼ì§€ê³ ê¸°ë¥¼ ëƒ„ë¹„ì— ë„£ì–´ìš”.<br>Phrase 2 : ë³¶ì•„ìš”.</p>
          </div>
          <input type="text" id="q18_input"
                 class="w-full p-2 border-2 border-gray-300 rounded-md focus:border-purple-500 outline-none"
                 placeholder="Combinez les deux phrases ici...">
          <div class="mt-4 text-right">
            <button onclick="toggleAnswer('q18_answer')" class="bg-purple-500 text-white py-1 px-4 rounded-md hover:bg-purple-600 transition">RÃ©ponse</button>
          </div>
          <div id="q18_answer" class="answer-box mt-3 p-3 bg-purple-100 text-purple-800 rounded-lg">
            <strong>RÃ©ponse :</strong> ë¼ì§€ê³ ê¸°ë¥¼ ëƒ„ë¹„ì— ë„£ê³  ë³¶ì•„ìš”.<br>
            <strong>Explication :</strong> Radical (ë„£) + ê³  + verbe suivant.
          </div>
        </div>
        <!-- Q19 -->
        <div class="bg-gray-50 p-5 rounded-lg shadow-sm">
          <p class="mb-3 text-lg">19. <strong>Combinaison (-ê³ ) :</strong> Combinez les deux phrases.</p>
          <div class="mb-4">
            <p class="text-xl font-medium">Phrase 1 : ì €ëŠ” ì¹œêµ¬ë¥¼ ë§Œë‚˜ìš”.<br>Phrase 2 : ì˜í™”ë¥¼ ë´ìš”.</p>
          </div>
          <input type="text" id="q19_input"
                 class="w-full p-2 border-2 border-gray-300 rounded-md focus:border-purple-500 outline-none"
                 placeholder="Combinez les deux phrases ici...">
          <div class="mt-4 text-right">
            <button onclick="toggleAnswer('q19_answer')" class="bg-purple-500 text-white py-1 px-4 rounded-md hover:bg-purple-600 transition">RÃ©ponse</button>
          </div>
          <div id="q19_answer" class="answer-box mt-3 p-3 bg-purple-100 text-purple-800 rounded-lg">
            <strong>RÃ©ponse :</strong> ì €ëŠ” ì¹œêµ¬ë¥¼ ë§Œë‚˜ê³  ì˜í™”ë¥¼ ë´ìš”.<br>
            <strong>Traduction :</strong> Je rencontre mes amis et je regarde un film.
          </div>
        </div>
        <!-- Q20 -->
        <div class="bg-gray-50 p-5 rounded-lg shadow-sm">
          <p class="mb-3 text-lg">20. <strong>Combinaison (-ê³ ) :</strong> Combinez les deux phrases.</p>
          <div class="mb-4">
            <p class="text-xl font-medium">Phrase 1 : ì‹ë‹¹ì— ë“¤ì–´ê°€ìš”.<br>Phrase 2 : ê°™ì´ ë¨¹ì–´ìš”.</p>
          </div>
          <input type="text" id="q20_input"
                 class="w-full p-2 border-2 border-gray-300 rounded-md focus:border-purple-500 outline-none"
                 placeholder="Combinez les deux phrases ici...">
          <div class="mt-4 text-right">
            <button onclick="toggleAnswer('q20_answer')" class="bg-purple-500 text-white py-1 px-4 rounded-md hover:bg-purple-600 transition">RÃ©ponse</button>
          </div>
          <div id="q20_answer" class="answer-box mt-3 p-3 bg-purple-100 text-purple-800 rounded-lg">
            <strong>RÃ©ponse :</strong> ì‹ë‹¹ì— ë“¤ì–´ê°€ê³  ê°™ì´ ë¨¹ì–´ìš”.<br>
            <strong>Traduction :</strong> On entre dans le restaurant et on mange ensemble.
          </div>
        </div>
      </div>
    </section>

    <!-- FINISH + RETRY -->
    <div class="mt-8 flex gap-3 justify-end">
      <button id="finishBtn"
              class="bg-emerald-600 hover:bg-emerald-700 text-white font-semibold px-5 py-2 rounded-lg transition">
        ëë‚´ê¸° (ì±„ì  & ì œì¶œ)
      </button>
      <button id="retryBtn"
              class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold px-5 py-2 rounded-lg transition hidden">
        ë‹¤ì‹œí•˜ê¸°
      </button>
    </div>
  </div>

  <!-- RESULT MODAL -->
  <div id="resultModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center p-4 z-50">
    <div class="bg-white w-full max-w-2xl rounded-2xl shadow-xl p-6">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-2xl font-bold text-gray-800">ì±„ì  ê²°ê³¼</h3>
        <button id="closeResult" class="text-gray-500 hover:text-gray-700 text-xl leading-none">&times;</button>
      </div>

      <p id="scoreLine" class="text-lg font-semibold text-gray-700 mb-4">
        ì´ì : <span class="text-indigo-600" id="scoreValue">0</span> / 20
      </p>

      <div class="max-h-[50vh] overflow-auto border rounded-lg">
        <table class="w-full text-sm">
          <thead class="bg-gray-50">
            <tr>
              <th class="p-2 text-left">#</th>
              <th class="p-2 text-left">ë‚´ ë‹µ</th>
              <th class="p-2 text-left">ì •ë‹µ</th>
              <th class="p-2 text-left">ì±„ì </th>
            </tr>
          </thead>
          <tbody id="resultTable"></tbody>
        </table>
      </div>

      <div id="sendStatus" class="mt-4 text-sm text-gray-600"></div>

      <div class="mt-6 flex justify-end gap-2">
        <button id="sendAgainBtn"
                class="hidden bg-amber-500 hover:bg-amber-600 text-white font-semibold px-4 py-2 rounded-lg transition">
          ë‹¤ì‹œ ì „ì†¡
        </button>
        <button id="okBtn"
                class="bg-emerald-600 hover:bg-emerald-700 text-white font-semibold px-4 py-2 rounded-lg transition">
          í™•ì¸
        </button>
      </div>
    </div>
  </div>

  <script>
    /***** -------- ì˜¤ë””ì˜¤ ì¬ìƒ ìœ í‹¸(í¬ë§· ë¶„ê¸° + ì—ëŸ¬ ì•ˆì „) -------- *****/
    let currentAudio = null;

    function normalizeBase64(b64) {
      b64 = b64.replace(/-/g, '+').replace(/_/g, '/');
      const pad = b64.length % 4;
      if (pad === 2) b64 += '==';
      else if (pad === 3) b64 += '=';
      return b64;
    }
    function base64ToArrayBuffer(base64) {
      const normalized = normalizeBase64(base64);
      const binaryString = window.atob(normalized);
      const len = binaryString.length;
      const bytes = new Uint8Array(len);
      for (let i = 0; i < len; i++) bytes[i] = binaryString.charCodeAt(i);
      return bytes.buffer;
    }
    function pcmToWav(pcmData, sampleRate) {
      const pcm16 = new Int16Array(pcmData);
      const header = new ArrayBuffer(44);
      const view = new DataView(header);
      const writeString = (v,o,s)=>{ for(let i=0;i<s.length;i++) v.setUint8(o+i, s.charCodeAt(i)); };
      writeString(view,0,'RIFF'); view.setUint32(4,36+pcm16.byteLength,true);
      writeString(view,8,'WAVE'); writeString(view,12,'fmt ');
      view.setUint32(16,16,true); view.setUint16(20,1,true);
      const numChannels=1; view.setUint16(22,numChannels,true);
      view.setUint32(24,sampleRate,true);
      view.setUint32(28,sampleRate*numChannels*2,true);
      view.setUint16(32,numChannels*2,true);
      view.setUint16(34,16,true);
      writeString(view,36,'data'); view.setUint32(40, pcm16.byteLength, true);
      return new Blob([header, pcm16], { type:'audio/wav' });
    }
    async function generateAndPlayAudio(text, buttonElement) {
      if (buttonElement.classList.contains('loading')) return;
      buttonElement.classList.add('loading');
      const originalContent = buttonElement.innerHTML;
      buttonElement.textContent = '...';
      if (currentAudio) { currentAudio.pause(); currentAudio = null; }

      try {
        const response = await fetch('/.netlify/functions/generate-audio', {
          method: 'POST', headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ text })
        });
        let payloadText = await response.text();
        if (!response.ok) {
          try { const err = JSON.parse(payloadText); throw new Error(err.error || `HTTP ${response.status}`); }
          catch { throw new Error(`HTTP ${response.status}: ${payloadText.slice(0,200)}...`); }
        }
        let result; try { result = JSON.parse(payloadText); }
        catch { throw new Error('ì„œë²„ ì‘ë‹µì„ JSONìœ¼ë¡œ íŒŒì‹±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'); }

        const { audioData, mimeType } = result || {};
        if (!audioData || !mimeType || !mimeType.startsWith('audio/')) {
          throw new Error('ì„œë²„ê°€ ì˜¬ë°”ë¥¸ ì˜¤ë””ì˜¤ ë°ì´í„°ë¥¼ ë°˜í™˜í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
        }
        let blob;
        if (mimeType.startsWith('audio/L16') || mimeType.startsWith('audio/linear16')) {
          const rateMatch = mimeType.match(/rate=(\\d+)/i);
          const sampleRate = rateMatch ? parseInt(rateMatch[1],10) : 24000;
          const pcmData = base64ToArrayBuffer(audioData);
          blob = pcmToWav(pcmData, sampleRate);
        } else {
          const arrBuf = base64ToArrayBuffer(audioData);
          blob = new Blob([arrBuf], { type: mimeType });
        }
        const audioUrl = URL.createObjectURL(blob);
        currentAudio = new Audio(audioUrl);
        currentAudio.play().catch(()=>{ console.warn('ì˜¤ë””ì˜¤ ìë™ì¬ìƒì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤.'); });
        currentAudio.onended = () => {
          buttonElement.classList.remove('loading');
          buttonElement.innerHTML = originalContent;
          URL.revokeObjectURL(audioUrl);
        };
      } catch (e) {
        console.error('ì˜¤ë””ì˜¤ ìƒì„±/ì¬ìƒ ì˜¤ë¥˜:', e);
        alert('ì˜¤ë””ì˜¤ë¥¼ ì¬ìƒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
        buttonElement.classList.remove('loading');
        buttonElement.innerHTML = originalContent;
      }
    }
    document.querySelectorAll('.audio-btn').forEach(btn=>{
      btn.addEventListener('click', (e)=>{
        e.stopPropagation();
        generateAndPlayAudio(btn.dataset.text, btn);
      });
    });

    /***** -------- ì •ë‹µ ë°ì´í„° -------- *****/
    // 1~5: í…ìŠ¤íŠ¸
    const TEXT_ANSWERS = {
      q1_input: ['ë­ë¥¼','ë­˜'],
      q2_input: ['ì•ˆ ë§Œë‚¬ì–´ìš”'],
      q3_input: ['ìŒ€'],
      q4_input: ['ìì£¼'],
      q5_input: ['ë“¤ì–´ê°€ìš”']
    };
    // 6~10: ì¡°ì‚¬ (ì •ë‹µ í‘œì‹œìš©)
    const PARTICLE_ANSWERS = { q6:'ì™€', q7:'ê°€', q8:'ì€', q9:'ì„', q10:'ì—' };
    // 11~15: Vrai/Faux (ì •ë‹µ í‚¤) - true=Vrai, false=Faux
    const TRUE_FALSE_ANSWERS = { q11:true, q12:false, q13:false, q14:true, q15:false };
    // 16~20: ë°›ì•„ì“°ê¸°/ê²°í•©
    const DICT_COMB_ANSWERS = {
      q16_input:'ì €ëŠ” ì¹œêµ¬ë¥¼ ì•ˆ ë§Œë‚˜ê³  ì˜í™”ë¥¼ ì•ˆ ë´¤ì–´ìš”.',
      q17_input:'ê¹€ì¹˜í•˜ê³  ë°¥ì„ ê°™ì´ ë¨¹ì–´ìš”.',
      q18_input:'ë¼ì§€ê³ ê¸°ë¥¼ ëƒ„ë¹„ì— ë„£ê³  ë³¶ì•„ìš”.',
      q19_input:'ì €ëŠ” ì¹œêµ¬ë¥¼ ë§Œë‚˜ê³  ì˜í™”ë¥¼ ë´ìš”.',
      q20_input:'ì‹ë‹¹ì— ë“¤ì–´ê°€ê³  ê°™ì´ ë¨¹ì–´ìš”.'
    };

    /***** -------- ë³´ì¡° ìœ í‹¸ -------- *****/
    const norm = (s)=> (s||'').replace(/\s+/g,' ').replace(/[.]\s*$/,'').trim();
    function toggleAnswer(id){ document.getElementById(id)?.classList.toggle('show'); }

    // ì¡°ì‚¬ ì„ íƒ: ì‚¬ìš©ìì˜ ì„ íƒ ì €ì¥ + ì¦‰ì‹œ í”¼ë“œë°±
    function checkParticle(questionId, chosenParticle, isCorrect) {
      const answerBox = document.getElementById(questionId + '_answer');
      const optionsContainer = document.getElementById(questionId + '_options');
      const blank = document.getElementById(questionId + '_blank');
      if (!answerBox || !optionsContainer || !blank) return;

      blank.textContent = chosenParticle;
      optionsContainer.dataset.selected = chosenParticle;
      answerBox.classList.add('show');

      optionsContainer.querySelectorAll('button').forEach(btn=>{
        btn.disabled = true;
        if (btn.textContent.trim() === chosenParticle) {
          btn.classList.remove('bg-gray-200','hover:bg-cyan-200');
          if (isCorrect){ btn.classList.add('bg-green-500','text-white'); blank.classList.add('text-green-600'); }
          else { btn.classList.add('bg-red-500','text-white'); blank.classList.add('text-red-600'); }
        } else {
          btn.classList.add('opacity-50');
        }
      });
    }
    // Vrai/Faux: ì‚¬ìš©ìì˜ ì„ íƒ ì €ì¥ + ì¦‰ì‹œ í”¼ë“œë°±
    function checkTrueFalse(questionId, userChoseVrai) {
      const correct = TRUE_FALSE_ANSWERS[questionId];
      const isUserCorrect = userChoseVrai === correct;

      const answerBox = document.getElementById(questionId + '_answer');
      const optionsContainer = document.getElementById(questionId + '_options');
      if (!answerBox || !optionsContainer) return;

      answerBox.classList.add('show');
      optionsContainer.dataset.selected = userChoseVrai ? 'Vrai' : 'Faux';

      optionsContainer.querySelectorAll('button').forEach(btn=>{
        btn.disabled = true;
        const isVraiBtn = btn.textContent.includes('Vrai');
        const isCorrectBtn = (isVraiBtn && correct) || (!isVraiBtn && !correct);
        if (isCorrectBtn){ btn.classList.add('ring-4','ring-green-500'); }
        else { btn.classList.add('opacity-50'); }
        const isUserBtn = (isVraiBtn && userChoseVrai) || (!isVraiBtn && !userChoseVrai);
        if (isUserBtn){ btn.classList.add(isUserCorrect ? 'bg-green-500' : 'bg-red-500','text-white'); }
      });
    }

    /***** -------- ëë‚´ê¸°(ì±„ì  & ì œì¶œ 1íšŒ) -------- *****/
    const finishBtn = document.getElementById('finishBtn');
    const retryBtn = document.getElementById('retryBtn');
    const resultModal = document.getElementById('resultModal');
    const closeResult = document.getElementById('closeResult');
    const okBtn = document.getElementById('okBtn');
    const sendAgainBtn = document.getElementById('sendAgainBtn');
    const scoreValue = document.getElementById('scoreValue');
    const resultTable = document.getElementById('resultTable');
    const sendStatus = document.getElementById('sendStatus');
    const exerciseCard = document.getElementById('exerciseCard');

    const SEND_LOCK_KEY = 'listen_ex_submit_locked_v1';
    let submissionLocked = !!localStorage.getItem(SEND_LOCK_KEY);
    let lastPayload = null;

    function buildRow(n, mine, ans, ok) {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td class="p-2 align-top">${n}</td>
        <td class="p-2 align-top break-words">${mine ? mine : '<span class="text-gray-400">â€”</span>'}</td>
        <td class="p-2 align-top break-words">${Array.isArray(ans) ? ans.join(' / ') : ans}</td>
        <td class="p-2 align-top ${ok ? 'text-emerald-600' : 'text-red-600'} font-semibold">${ok ? 'O' : 'X'}</td>
      `;
      return tr;
    }

    function collectAndScore() {
      const results = [];
      let score = 0;
      let qNum = 0;

      // 1~5 text
      for (const id of ['q1_input','q2_input','q3_input','q4_input','q5_input']) {
        qNum++;
        const my = norm(document.getElementById(id)?.value);
        const answers = TEXT_ANSWERS[id];
        const isOk = !!answers?.some(a => norm(a) === my);
        if (isOk) score++;
        results.push({ no:qNum, type:'text', key:id, my, correct:answers, ok:isOk });
      }

      // 6~10 particle
      for (const q of ['q6','q7','q8','q9','q10']) {
        qNum++;
        const sel = document.getElementById(q + '_options')?.dataset?.selected || '';
        const ans = PARTICLE_ANSWERS[q];
        const isOk = sel === ans;
        if (isOk) score++;
        results.push({ no:qNum, type:'particle', key:q, my:sel, correct:ans, ok:isOk });
      }

      // 11~15 true/false
      for (const q of ['q11','q12','q13','q14','q15']) {
        qNum++;
        const selStr = document.getElementById(q + '_options')?.dataset?.selected || '';
        const myBool = selStr === 'Vrai';
        const correct = !!TRUE_FALSE_ANSWERS[q];
        const isOk = myBool === correct;
        if (isOk) score++;
        results.push({ no:qNum, type:'truefalse', key:q, my: selStr || null, correct: correct ? 'Vrai' : 'Faux', ok:isOk });
      }

      // 16~20 dict/comb
      for (const id of ['q16_input','q17_input','q18_input','q19_input','q20_input']) {
        qNum++;
        const myRaw = document.getElementById(id)?.value || '';
        const my = norm(myRaw);
        const ans = DICT_COMB_ANSWERS[id];
        const isOk = norm(ans) === my;
        if (isOk) score++;
        results.push({ no:qNum, type:'dict', key:id, my: myRaw, correct: ans, ok:isOk });
      }

      return { score, results };
    }

    function renderResultTable(data) {
      resultTable.innerHTML = '';
      data.results.forEach(r=>{
        const tr = buildRow(r.no, r.my, r.correct, r.ok);
        resultTable.appendChild(tr);
      });
      scoreValue.textContent = data.score;
    }

    async function submitResults(payload, force=false) {
      const teacherEmail = exerciseCard.dataset.teacherEmail || 'teacher@example.com';
      const endpoint = '/.netlify/functions/submit-results';
      sendStatus.textContent = 'ì œì¶œ ì¤‘â€¦ (ì ì‹œë§Œìš”)';
      sendAgainBtn.classList.add('hidden');

      try {
        if (submissionLocked && !force) {
          sendStatus.textContent = 'ì´ë¯¸ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤. (ì´ë©”ì¼ ì „ì†¡ì€ ìµœì´ˆ 1íšŒ)';
          return { sent:false, locked:true };
        }

        const res = await fetch(endpoint, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ teacherEmail, ...payload })
        });

        if (!res.ok) {
          const text = await res.text();
          throw new Error(`HTTP ${res.status} - ${text.slice(0,200)}`);
        }

        sendStatus.textContent = 'ì œì¶œ ì™„ë£Œ! ì„ ìƒë‹˜ê»˜ ì´ë©”ì¼ì´ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.';
        if (!force) {
          submissionLocked = true;
          localStorage.setItem(SEND_LOCK_KEY, '1');
          finishBtn.disabled = true;
          finishBtn.classList.add('opacity-50','cursor-not-allowed');
          retryBtn.classList.remove('hidden');
        }
        return { sent:true };
      } catch (e) {
        console.error('ì œì¶œ ì‹¤íŒ¨:', e);
        sendStatus.innerHTML = `<span class="text-red-600">ì œì¶œ ì‹¤íŒ¨:</span> ${e.message}`;
        sendAgainBtn.classList.remove('hidden'); // ì‹¤íŒ¨ ì‹œ ì¬ì „ì†¡ í—ˆìš©
        return { sent:false, error:e };
      }
    }

    finishBtn.addEventListener('click', async ()=>{
      // ì±„ì 
      const data = collectAndScore();
      renderResultTable(data);

      // payload êµ¬ì„±
      const studentName = document.getElementById('student_name')?.value || '';
      const studentEmail = document.getElementById('student_email')?.value || '';
      const now = new Date();
      const payload = {
        title: document.title,
        when: now.toISOString(),
        studentName, studentEmail,
        score: data.score, total: 20,
        results: data.results
      };
      lastPayload = payload;

      // ëª¨ë‹¬ ì—´ê¸°
      resultModal.classList.remove('hidden');
      resultModal.classList.add('flex');

      // ìµœì´ˆ 1íšŒë§Œ ì „ì†¡
      await submitResults(payload, /*force*/ false);
    });

    // ëª¨ë‹¬/ë²„íŠ¼
    const closeModal = ()=>{
      resultModal.classList.add('hidden');
      resultModal.classList.remove('flex');
    };
    closeResult.addEventListener('click', closeModal);
    okBtn.addEventListener('click', closeModal);

    // ì¬ì „ì†¡(ì‹¤íŒ¨í–ˆì„ ë•Œë§Œ ë²„íŠ¼ì´ ë‚˜íƒ€ë‚¨)
    sendAgainBtn.addEventListener('click', async ()=>{
      if (!lastPayload) return;
      await submitResults(lastPayload, /*force*/ true);
    });

    // ë‹¤ì‹œí•˜ê¸°(ë¦¬ì…‹) â€” ì „ì†¡ ì ê¸ˆì€ ìœ ì§€(í•œ ë²ˆë§Œ ë©”ì¼ ì „ì†¡)
    retryBtn.addEventListener('click', ()=>{
      // í…ìŠ¤íŠ¸ ì…ë ¥ ë¦¬ì…‹
      ['q1_input','q2_input','q3_input','q4_input','q5_input',
       'q16_input','q17_input','q18_input','q19_input','q20_input'
      ].forEach(id=>{ const el=document.getElementById(id); if (el) el.value=''; });

      // ì¡°ì‚¬/ì§„ìœ„ ë²„íŠ¼ ë³µêµ¬
      ['q6','q7','q8','q9','q10'].forEach(q=>{
        const box = document.getElementById(q + '_options');
        const blank = document.getElementById(q + '_blank');
        if (box) {
          delete box.dataset.selected;
          box.querySelectorAll('button').forEach(btn=>{
            btn.disabled = false;
            btn.classList.remove('opacity-50','bg-green-500','bg-red-500','text-white','ring-4','ring-green-500');
          });
        }
        if (blank) blank.textContent='__', blank.classList.remove('text-green-600','text-red-600');
      });
      ['q11','q12','q13','q14','q15'].forEach(q=>{
        const box = document.getElementById(q + '_options');
        if (box) {
          delete box.dataset.selected;
          box.querySelectorAll('button').forEach(btn=>{
            btn.disabled=false;
            btn.classList.remove('opacity-50','bg-green-500','bg-red-500','text-white','ring-4','ring-green-500');
          });
        }
      });

      // í•´ì„¤ ë°•ìŠ¤ ë‹«ê¸°
      document.querySelectorAll('.answer-box').forEach(b=>b.classList.remove('show'));

      // ì ìˆ˜/í‘œ ì´ˆê¸°í™”
      resultTable.innerHTML = '';
      scoreValue.textContent = '0';
      sendStatus.textContent = '';

      // ëë‚´ê¸° ë²„íŠ¼ì€ ì ê¸ˆ ìœ ì§€ë¡œ ë¹„í™œì„±í™”, ë‹¨ ë‹¤ì‹œí•˜ê¸°ë¡œ ì¬ì—°ìŠµë§Œ ê°€ëŠ¥
      // (ë©”ì¼ì€ ìµœì´ˆ 1íšŒë§Œ ë°œì†¡)
      closeModal();
    });
  </script>
<script>
/**
 * RÃ©ponse â†’ Indice(íŒíŠ¸)ë¡œ ë²„íŠ¼ ë¼ë²¨ ë³€ê²½ + ê° ë¬¸í•­ íŒíŠ¸(ë¶ˆì–´/í•œêµ­ì–´) ì£¼ì…
 * - ê¸°ì¡´ toggleAnswer('qX_answer') ë¡œì§/ì¹´ìš´íŠ¸ ê·¸ëŒ€ë¡œ ì‚¬ìš©
 * - ê¸°ì¡´ answer-box ë°°ê²½ìƒ‰/ìŠ¤íƒ€ì¼ ìœ ì§€, ë‚´ë¶€ ë‚´ìš©ë§Œ íŒíŠ¸ë¡œ êµì²´
 */
document.addEventListener('DOMContentLoaded', () => {
  // 1) "RÃ©ponse" ë²„íŠ¼ í…ìŠ¤íŠ¸ë¥¼ "Indice"ë¡œ ì¼ê´„ ë³€ê²½
  document.querySelectorAll('button[onclick^="toggleAnswer(\'q"][onclick$="_answer\')"]').forEach(btn => {
    btn.textContent = 'Indice';
    // ì›í•˜ë©´ ë²„íŠ¼ ìƒ‰ë„ í†µì¼í•  ìˆ˜ ìˆì–´ìš” (ì£¼ì„ í•´ì œ)
    // btn.classList.remove('bg-indigo-500','bg-purple-500');
    // btn.classList.add('bg-amber-500','hover:bg-amber-600');
  });

  // 2) ë¬¸í•­ë³„ íŒíŠ¸(ë¶ˆì–´/í•œêµ­ì–´) ì£¼ì…
  const HINTS = {
    1: { fr: `Mot interrogatif pour "quoi" (objet) â†’ "ë­/ë¬´ì—‡" + ë¥¼. Contraction frÃ©quente: "ë­˜".`,
         ko: `â€˜ë¬´ì—‡(=ë­)â€™ + ëª©ì ê²© ì¡°ì‚¬ â€˜ë¥¼â€™ â†’ â€˜ë­˜â€™(êµ¬ì–´ì²´).` },
    2: { fr: `NÃ©gation avec "ì•ˆ" + passÃ© -ì•˜/ì—ˆì–´ìš” du verbe rencontrer(ë§Œë‚˜ë‹¤).`,
         ko: `ë¶€ì • "ì•ˆ" + â€˜ë§Œë‚˜ë‹¤â€™ ê³¼ê±°í˜•(ë§Œë‚¬ì–´ìš”) â†’ "ì•ˆ ë§Œë‚¬ì–´ìš”".` },
    3: { fr: `"ìŒ€" = riz cru (non cuit). "ë°¥" = riz cuit.`,
         ko: `â€˜ìŒ€â€™ì€ ë‚ ìŒ€, â€˜ë°¥â€™ì€ ì§€ì€ ë°¥.` },
    4: { fr: `"ìì£¼" = souvent (adverbe de frÃ©quence).`,
         ko: `ë¹ˆë„ ë¶€ì‚¬ â€˜ìì£¼â€™ = ìì£¼(ì¢…ì¢…).` },
    5: { fr: `Entrer = "ë“¤ì–´ê°€ë‹¤". PrÃ©sent poli: "ë“¤ì–´ê°€ìš”".`,
         ko: `â€˜ë“¤ì–´ê°€ë‹¤â€™ì˜ í˜„ì¬ ì¡´ëŒ“ë§ â†’ â€˜ë“¤ì–´ê°€ìš”â€™.` },

    6: { fr: `ì™€/ê³¼: aprÃ¨s voyelle â†’ "ì™€". (ê¹€ì¹˜ + ì™€)`,
         ko: `ëª¨ìŒ ë’¤ì—ëŠ” â€˜ì™€â€™, ììŒ ë’¤ì—ëŠ” â€˜ê³¼â€™.` },
    7: { fr: `Sujet ì´/ê°€: aprÃ¨s voyelle â†’ "ê°€". (ì¹œêµ¬ + ê°€)`,
         ko: `ì£¼ê²© ì¡°ì‚¬: ëª¨ìŒ ë’¤ â€˜ê°€â€™, ììŒ ë’¤ â€˜ì´â€™.` },
    8: { fr: `ThÃ¨me ì€/ëŠ”: aprÃ¨s consonne â†’ "ì€". (ì‚¬ëŒ + ì€)`,
         ko: `ì£¼ì œ ì¡°ì‚¬: ë°›ì¹¨ ìˆìœ¼ë©´ â€˜ì€â€™, ì—†ìœ¼ë©´ â€˜ëŠ”â€™.` },
    9: { fr: `Objet ì„/ë¥¼: aprÃ¨s consonne â†’ "ì„". (ë°¥ + ì„)`,
         ko: `ëª©ì ê²© ì¡°ì‚¬: ë°›ì¹¨ ìˆìœ¼ë©´ â€˜ì„â€™, ì—†ìœ¼ë©´ â€˜ë¥¼â€™.` },
    10:{ fr: `Destination/lieu dâ€™arrivÃ©e avec verbe de mouvement â†’ "ì—".`,
         ko: `ì´ë™/ë„ì°© ì§€ì ì—ëŠ” â€˜ì—â€™ë¥¼ ì‚¬ìš©.` },

    11:{ fr: `"ì˜ ë³´ì—¬ìš”?" = "Tu me vois bien ?" (bien + voir).`,
         ko: `â€˜ì˜ ë³´ì´ë‹¤?â€™ = â€œì˜ ë³´ì—¬ìš”?â€ (ìƒëŒ€ê°€ ì˜ ë³´ì´ëŠ”ì§€ ë¬»ê¸°).` },
    12:{ fr: `"ìŒ€" = riz, pas "pÃ¢tes".`,
         ko: `â€˜ìŒ€â€™ì€ ë°¥ìŒ€, íŒŒìŠ¤íƒ€ëŠ” â€˜íŒŒìŠ¤íƒ€/êµ­ìˆ˜â€™.` },
    13:{ fr: `"ì•ˆ ë§Œë‚¬ì–´ìš”" = ne pas avoir rencontrÃ© (nÃ©gation).`,
         ko: `ë¶€ì • â€˜ì•ˆâ€™ + ë§Œë‚˜ë‹¤ ê³¼ê±° â†’ â€˜ì•ˆ ë§Œë‚¬ì–´ìš”â€™.` },
    14:{ fr: `"ê°€ë”" = parfois, de temps en temps.`,
         ko: `â€˜ê°€ë”â€™ = sometimes(ë•Œë•Œë¡œ).` },
    15:{ fr: `"ì§‘" = maison, "ì‹ë‹¹" = restaurant (ne pas confondre).`,
         ko: `â€˜ì§‘â€™=house, â€˜ì‹ë‹¹â€™=restaurant.` },

    16:{ fr: `EnchaÃ®nement avec "-ê³ " et nÃ©gation "ì•ˆ": â€¦ê³  â€¦ì•ˆ â€¦.`,
         ko: `ì—°ê²° ì–´ë¯¸ â€˜-ê³ â€™ + ë¶€ì • â€˜ì•ˆâ€™ ì¡°í•© ì£¼ì˜.` },
    17:{ fr: `"í•˜ê³ " = et (pour noms), "ê°™ì´" = ensemble.`,
         ko: `ë‚˜ì—´ â€˜í•˜ê³ â€™, í•¨ê»˜ â€˜ê°™ì´â€™.` },
    18:{ fr: `Connexion dâ€™actions: ë„£-ê³  â†’ ë³¶ì•„ìš”.`,
         ko: `ì—°ê²° â€˜-ê³ â€™: ë„£ê³  ë³¶ì•„ìš”.` },
    19:{ fr: `Ordre naturel: ë§Œë‚˜ê³  â†’ (puis) ë´ìš”.`,
         ko: `ë¨¼ì € ë§Œë‚˜ê³ , ê·¸ë‹¤ìŒ ë³¸ë‹¤.` },
    20:{ fr: `Mouvement dâ€™abord (entrer), puis action ensemble.`,
         ko: `ë¨¼ì € ë“¤ì–´ê°€ê³ , ê·¸ë‹¤ìŒ ê°™ì´ ë¨¹ì–´ìš”.` }
  };

  for (let i = 1; i <= 20; i++) {
    const box = document.getElementById(`q${i}_answer`);
    if (!box || !HINTS[i]) continue;

    // ê¸°ì¡´ ì •ë‹µ/ì„¤ëª… í…ìŠ¤íŠ¸ë¥¼ íŒíŠ¸ë¡œ êµì²´(ë¶ˆì–´+í•œêµ­ì–´)
    // ìƒ‰ìƒ/í…Œë‘ë¦¬ ë“± ê¸°ì¡´ answer-box ìŠ¤íƒ€ì¼ì€ ê·¸ëŒ€ë¡œ ìœ ì§€ë©ë‹ˆë‹¤.
    box.innerHTML = `
      <div class="space-y-1">
        <div class="font-semibold">Indice <span class="text-xs text-gray-500">(íŒíŠ¸)</span></div>
        <div><b>FR :</b> ${HINTS[i].fr}</div>
        <div><b>KO :</b> ${HINTS[i].ko}</div>
      </div>
    `;
  }
});
</script>

</body>
</html>

