<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•œêµ­ì–´ ë“£ê¸° ì—°ìŠµ (Exercice d'Ã©coute corÃ©en) - 08/08/2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap');
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f0f4f8;
        }
        .task-container {
            transition: all 0.3s ease-in-out;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .hint {
            background-color: #e0f2fe;
            border-left: 4px solid #38bdf8;
            color: #0c4a6e;
        }
        .correct-answer {
            background-color: #dcfce7;
            border-left: 4px solid #4ade80;
            color: #166534;
        }
        .wrong-answer {
            background-color: #fee2e2;
            border-left: 4px solid #f87171;
            color: #991b1b;
        }
        .btn {
            transition: all 0.2s ease;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .btn-audio { background-color: #60a5fa; color: white; }
        .btn-hint { background-color: #fbbf24; color: #422006; }
        .btn-check { background-color: #34d399; color: white; }
        .btn-action { background-color: #a78bfa; color: white; }
        
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: none;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background-color: #f00;
            opacity: 0.7;
            animation: confetti-fall 3s linear forwards;
            top: -20px;
        }
        @keyframes confetti-fall {
            from { transform: translateY(0) rotate(0deg); }
            to { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }

        /* ì¸ì‡„ìš© ìŠ¤íƒ€ì¼ */
        @media print {
            body {
                background-color: white;
                font-size: 12pt;
            }
            #student-gate, .btn, #action-buttons, .hint, .result-box, #french-input-container, #final-message {
                display: none !important;
            }
            .task-container {
                box-shadow: none;
                border: 1px solid #ccc;
                page-break-inside: avoid;
            }
            .korean-input-print {
                border-bottom: 1px solid #000 !important;
                border: none;
                height: 2em;
            }
            header h1 {
                font-size: 18pt;
            }
            header p, h2 {
                font-size: 14pt;
            }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 p-4 sm:p-6 md:p-8">

    <div class="max-w-4xl mx-auto">
        <!-- í•™ìƒ ì •ë³´ ì…ë ¥ ì„¹ì…˜ -->
        <div id="student-gate" class="bg-white p-8 rounded-xl shadow-lg text-center">
            <h1 class="text-2xl font-bold text-blue-600 mb-4">ë“£ê¸° í‰ê°€ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤! / Bienvenue au test d'Ã©coute !</h1>
            <p class="text-slate-600 mb-6">ì‹œì‘í•˜ê¸° ì „ì— ì´ë¦„ì´ë‚˜ í•™ë²ˆì„ ì…ë ¥í•´ì£¼ì„¸ìš”. / Veuillez entrer votre nom ou votre numÃ©ro d'Ã©tudiant avant de commencer.</p>
            <input type="text" id="student-id-input" class="w-full max-w-sm mx-auto p-3 border-2 border-slate-300 rounded-lg text-center" placeholder="ì˜ˆ: CÃ©dou">
            <button onclick="startTest()" class="mt-6 w-full max-w-sm mx-auto btn bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg text-lg">
                í…ŒìŠ¤íŠ¸ ì‹œì‘! / Commencer le test !
            </button>
        </div>

        <!-- í…ŒìŠ¤íŠ¸ ì½˜í…ì¸  (ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€) -->
        <div id="test-content" class="hidden">
            <header class="text-center mb-8">
                <h1 class="text-3xl sm:text-4xl font-bold text-blue-600">í•œêµ­ì–´ ë“£ê³  ë°›ì•„ì“°ê¸° âœï¸</h1>
                <p class="text-slate-500 mt-2">Exercice d'Ã©coute et de dictÃ©e en corÃ©en (08/08/2025)</p>
            </header>

            <!-- ì»¨íŠ¸ë¡¤ ë²„íŠ¼ (ì¸ì‡„, ì¢…ë£Œ) -->
            <div id="action-buttons" class="flex justify-center gap-4 mb-8">
                 <button onclick="window.print()" class="btn btn-action flex items-center gap-2 py-2 px-4 rounded-lg">
                    <i class="fas fa-print"></i> ì¸ì‡„í•˜ê¸° / Imprimer
                </button>
                <button onclick="finishTest()" class="btn bg-red-500 hover:bg-red-600 text-white flex items-center gap-2 py-2 px-4 rounded-lg">
                    <i class="fas fa-paper-plane"></i> ëë‚´ê³  ê²°ê³¼ ë³´ë‚´ê¸° / Terminer et envoyer
                </button>
            </div>

            <main id="tasks-list" class="space-y-6">
                <!-- Les exercices seront injectÃ©s ici par JavaScript -->
            </main>

            <div id="final-message" class="hidden mt-8 bg-green-100 border-l-4 border-green-500 text-green-700 p-6 rounded-lg text-center">
                <h2 class="font-bold text-2xl">ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤! / Excellent travail ! ğŸ¥³</h2>
                <p class="mt-2">í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ ì„ ìƒë‹˜ê»˜ ë°œì†¡ë˜ë„ë¡ ì´ë©”ì¼ ì•±ì´ ì—´ë¦´ ê±°ì˜ˆìš”. 'ë³´ë‚´ê¸°' ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”! / Votre application de messagerie va s'ouvrir. Veuillez cliquer sur 'Envoyer' !</p>
            </div>
        </div>
    </div>

    <script>
        // --- í•™ìƒ ë°ì´í„° ì¶”ì ì„ ìœ„í•œ ì„¤ì • ---
        let studentData = {
            studentId: null,
            startTime: null,
            endTime: null,
            questions: []
        };
        let testStarted = false;
        const teacherEmail = "votre.email@professeur.fr"; // ì—¬ê¸°ì— ì„ ìƒë‹˜ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”.

        const questions = [
            { id: 1, korean: "ì˜ ë“¤ë ¤ìš”?", french: "Tu mâ€™entends bien ?", initials: "ã…ˆ ã„·ã„¹ã…‡?", hint: "ë“¤ë¦¬ë‹¤: Ãªtre entendu", voice: "female" },
            { id: 2, korean: "ì˜ ë³´ì—¬ìš”?", french: "Tu me vois bien ?", initials: "ã…ˆ ã…‚ã…‡ã…‡?", hint: "ë³´ì´ë‹¤: Ãªtre vu", voice: "male" },
            { id: 3, korean: "ë„¤, ì˜ ë“¤ë ¤ìš”.", french: "Oui, je tâ€™entends bien.", initials: "ã„´, ã…ˆ ã„·ã„¹ã…‡.", hint: "ë„¤: oui", voice: "female" },
            { id: 4, korean: "ë„¤, ì˜ ë³´ì—¬ìš”.", french: "Oui, je te vois bien.", initials: "ã„´, ã…ˆ ã…‚ã…‡ã…‡.", hint: "ë„¤: oui", voice: "male" },
            { id: 5, korean: "ì˜ ë“¤ë¦¬ê³  ì˜ ë³´ì—¬ìš”?", french: "Tu m'entends bien et tu me vois bien ?", initials: "ã…ˆ ã„·ã„¹ã„± ã…ˆ ã…‚ã…‡ã…‡?", hint: "ê·¸ë¦¬ê³ : et", voice: "female" },
            { id: 6, korean: "ì•„ë‹ˆìš”, ì•ˆ ë“¤ë ¤ìš”.", french: "Non, je ne tâ€™entends pas.", initials: "ã…‡ã„´ã…‡, ã…‡ ã„·ã„¹ã…‡.", hint: "ì•„ë‹ˆìš”: non", voice: "male" },
            { id: 7, korean: "ì•„ë‹ˆìš”, ì•ˆ ë³´ì—¬ìš”.", french: "Non, je ne te vois pas.", initials: "ã…‡ã„´ã…‡, ã…‡ ã…‚ã…‡ã…‡.", hint: "ì•„ë‹ˆìš”: non", voice: "female" },
            { id: 8, korean: "ì´í•´í–ˆì–´ìš”.", french: "J'ai compris.", initials: "ã…‡ã…ã…ã…‡ã…‡.", hint: "ì´í•´í•˜ë‹¤: comprendre", voice: "male" },
            { id: 9, korean: "ì´í•´ ëª»í–ˆì–´ìš”.", french: "Je n'ai pas compris.", initials: "ã…‡ã… ã…ã…ã…‡ã…‡.", hint: "ëª»: ne pas pouvoir", voice: "female" },
            { id: 10, korean: "í•œë²ˆ ë” ë§í•´ì£¼ì„¸ìš”.", french: "Pouvez-vous rÃ©pÃ©ter, s'il vous plaÃ®t ?", initials: "ã…ã…‚ ã„· ã…ã…ã…ˆã……ã…‡.", hint: "í•œë²ˆ ë”: encore une fois", voice: "male" },
            { id: 11, korean: "ê¸°ì–µë‚˜ìš”.", french: "Je me souviens.", initials: "ã„±ã…‡ã„´ã…‡.", hint: "ê¸°ì–µë‚˜ë‹¤: se souvenir", voice: "female" },
            { id: 12, korean: "ê¸°ì–µ ì•ˆë‚˜ìš”.", french: "Je ne me souviens pas.", initials: "ã„±ã…‡ ã…‡ã„´ã…‡.", hint: "ì•ˆ: particule de nÃ©gation", voice: "male" },
            { id: 13, korean: "í•œêµ­ì–´ë¡œ ì–´ë–»ê²Œ ë§í•´ìš”?", french: "Comment on dit Ã§a en corÃ©en ?", initials: "ã…ã„±ã…‡ã„¹ ã…‡ã„¸ã… ã…ã…ã…‡?", hint: "ì–´ë–»ê²Œ: comment", voice: "female" },
            { id: 14, korean: "í”„ë‘ìŠ¤ì–´ë¡œ ì–´ë–»ê²Œ ë§í•´ìš”?", french: "Comment on dit Ã§a en franÃ§ais ?", initials: "ã…ã„¹ã……ã…‡ã„¹ ã…‡ã„¸ã… ã…ã…ã…‡?", hint: "í”„ë‘ìŠ¤ì–´: franÃ§ais", voice: "male" },
            { id: 15, korean: "ì¢‹ì€ í•œ ì£¼ ë³´ë‚´ì„¸ìš”.", french: "Passez une bonne semaine.", initials: "ã…ˆã…‡ ã… ã…ˆ ã…‚ã„´ã……ã…‡.", hint: "ë³´ë‚´ë‹¤: passer, envoyer", voice: "female" },
            { id: 16, korean: "ë‹¤ìŒ ì£¼ì— ë´ìš”.", french: "On se voit la semaine prochaine !", initials: "ã„·ã…‡ ã…ˆã…‡ ã…‚ã…‡.", hint: "ë‹¤ìŒ ì£¼: la semaine prochaine", voice: "male" },
            { id: 17, korean: "ì•ˆë…•íˆ ê³„ì„¸ìš”.", french: "Au revoir (quand l'autre reste)", initials: "ã…‡ã„´ã… ã„±ã……ã…‡.", hint: "ê³„ì‹œë‹¤: rester (honorifique)", voice: "female" },
            { id: 18, korean: "ì•ˆë…•íˆ ê°€ì„¸ìš”.", french: "Au revoir (quand l'autre part)", initials: "ã…‡ã„´ã… ã„±ã……ã…‡.", hint: "ê°€ì‹œë‹¤: partir (honorifique)", voice: "male" }
        ];

        // --- í…ŒìŠ¤íŠ¸ ì‹œì‘ ë° ë°ì´í„° ì´ˆê¸°í™” ---
        function startTest() {
            const studentId = document.getElementById('student-id-input').value;
            if (!studentId.trim()) {
                alert("ì´ë¦„ì´ë‚˜ í•™ë²ˆì„ ì…ë ¥í•´ì£¼ì„¸ìš”! / Veuillez entrer votre nom ou votre numÃ©ro d'Ã©tudiant !");
                return;
            }
            studentData.studentId = studentId.trim();

            questions.forEach(q => {
                studentData.questions.push({
                    id: q.id,
                    playCount: 0,
                    wrongAttempts: 0
                });
            });

            document.getElementById('student-gate').classList.add('hidden');
            document.getElementById('test-content').classList.remove('hidden');
        }
        
        function checkAndStartTimer() {
            if (studentData.studentId && !testStarted) {
                studentData.startTime = new Date();
                testStarted = true;
            }
        }

        const tasksList = document.getElementById('tasks-list');
        questions.forEach(q => {
            const taskElement = document.createElement('div');
            taskElement.className = 'task-container bg-white p-5 rounded-xl border border-slate-200';
            taskElement.id = `task-${q.id}`;
            taskElement.innerHTML = `
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-xl font-bold text-slate-700">Exercice ${q.id}</h2>
                    <div class="flex items-center gap-2">
                        <div id="loader-${q.id}" class="loader"></div>
                        <button onclick="playAudio(${q.id})" class="btn btn-audio w-12 h-12 rounded-full flex items-center justify-center text-xl shadow-md">
                            <i class="fas fa-play"></i>
                        </button>
                    </div>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label for="korean-input-${q.id}" class="block mb-1 font-semibold text-slate-600">RÃ©ponse en corÃ©en (í•œêµ­ì–´ ë‹µ)</label>
                        <input type="text" id="korean-input-${q.id}" oninput="checkAndStartTimer()" class="w-full p-3 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-blue-400 transition korean-input-print" placeholder="ì—¬ê¸°ì— ì…ë ¥í•˜ì„¸ìš”... / Ã‰crivez ici...">
                    </div>
                    <div id="french-input-container">
                        <label for="french-input-${q.id}" class="block mb-1 font-semibold text-slate-600">Traduction en franÃ§ais (í”„ë‘ìŠ¤ì–´ ë²ˆì—­)</label>
                        <input type="text" id="french-input-${q.id}" oninput="checkAndStartTimer()" class="w-full p-3 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-blue-400 transition" placeholder="Ã‰crivez ici...">
                    </div>
                </div>
                <div class="flex flex-wrap gap-3 mt-4">
                    <button onclick="showHint(${q.id}, 'initials')" class="btn btn-hint flex-grow sm:flex-grow-0 py-2 px-4 rounded-lg shadow-sm"><i class="far fa-lightbulb mr-2"></i>Indice 1 (ì´ˆì„±)</button>
                    <button onclick="showHint(${q.id}, 'hint')" class="btn btn-hint flex-grow sm:flex-grow-0 py-2 px-4 rounded-lg shadow-sm"><i class="far fa-lightbulb mr-2"></i>Indice 2 (ë‹¨ì–´ ëœ»)</button>
                    <button onclick="checkAnswer(${q.id})" class="btn btn-check flex-grow sm:flex-grow-0 py-2 px-4 rounded-lg shadow-sm font-bold"><i class="fas fa-check mr-2"></i>ì •ë‹µ í™•ì¸ / VÃ©rifier</button>
                </div>
                <div id="hint-box-${q.id}" class="mt-4 p-3 rounded-lg hint hidden"></div>
                <div id="result-box-${q.id}" class="mt-4 p-4 rounded-lg hidden"></div>
            `;
            tasksList.appendChild(taskElement);
        });
        
        let currentAudio = null;
        async function playAudio(id) {
            checkAndStartTimer();
            const stat = studentData.questions.find(q => q.id === id);
            if (stat) stat.playCount++;

            const question = questions.find(q => q.id === id);
            const loader = document.getElementById(`loader-${id}`);
            const buttonIcon = document.querySelector(`#task-${id} .btn-audio i`);
            if (currentAudio && !currentAudio.paused) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
                document.querySelectorAll('.btn-audio i').forEach(icon => icon.className = 'fas fa-play');
            }
            loader.style.display = 'block';
            buttonIcon.style.display = 'none';
            try {
                const response = await fetch(`/.netlify/functions/generate-audio`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text: question.korean, voice: question.voice })
                });
                if (!response.ok) throw new Error(`Audio generation failed: ${response.statusText}`);
                const data = await response.json();
                const audioBlob = new Blob([new Uint8Array(atob(data.audioContent).split("").map(char => char.charCodeAt(0)))], { type: 'audio/mpeg' });
                const audioUrl = URL.createObjectURL(audioBlob);
                currentAudio = new Audio(audioUrl);
                currentAudio.play();
                buttonIcon.className = 'fas fa-pause';
                currentAudio.onended = () => { buttonIcon.className = 'fas fa-play'; };
            } catch (error) {
                console.error('Error playing audio:', error);
                alert("ìŒì„± ì¬ìƒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. / DÃ©solÃ©, une erreur s'est produite lors de la lecture du son.");
                buttonIcon.className = 'fas fa-play';
            } finally {
                loader.style.display = 'none';
                if(buttonIcon.className !== 'fas fa-pause') buttonIcon.style.display = 'block';
                currentAudio.addEventListener('play', () => {
                    buttonIcon.className = 'fas fa-pause';
                    buttonIcon.style.display = 'block';
                    loader.style.display = 'none';
                });
                currentAudio.addEventListener('pause', () => { buttonIcon.className = 'fas fa-play'; });
            }
        }

        function showHint(id, type) {
            checkAndStartTimer();
            const question = questions.find(q => q.id === id);
            const hintBox = document.getElementById(`hint-box-${id}`);
            if (type === 'initials') {
                hintBox.innerHTML = `<strong>ğŸ’¡ Indice 1 (ì´ˆì„±):</strong> ${question.initials}`;
            } else {
                hintBox.innerHTML = `<strong>ğŸ’¡ Indice 2 (ë‹¨ì–´ ëœ» / Mot-clÃ©):</strong> ${question.hint}`;
            }
            hintBox.classList.remove('hidden');
        }
        
        function launchConfetti() {
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.classList.add('confetti');
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.animationDelay = Math.random() * 2 + 's';
                const colors = ['#f87171', '#fbbf24', '#34d399', '#60a5fa', '#c084fc'];
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                document.body.appendChild(confetti);
                setTimeout(() => confetti.remove(), 3000);
            }
        }

        function checkAnswer(id) {
            checkAndStartTimer();
            const question = questions.find(q => q.id === id);
            const koreanInput = document.getElementById(`korean-input-${id}`).value.trim();
            const frenchInput = document.getElementById(`french-input-${id}`).value.trim();
            const resultBox = document.getElementById(`result-box-${id}`);
            const cleanKoreanAnswer = question.korean.replace(/[.?!,]/g, '');
            const cleanKoreanInput = koreanInput.replace(/[.?!,]/g, '');
            const cleanFrenchAnswer = question.french.toLowerCase().replace(/[.?!,']/g, '');
            const cleanFrenchInput = frenchInput.toLowerCase().replace(/[.?!,']/g, '');
            let koreanCorrect = cleanKoreanInput === cleanKoreanAnswer;
            let frenchCorrect = cleanFrenchInput === cleanFrenchAnswer;

            if (!koreanCorrect || !frenchCorrect) {
                const stat = studentData.questions.find(q => q.id === id);
                if (stat) stat.wrongAttempts++;
            }

            let resultHTML = '';
            let resultClass = '';
            if (koreanCorrect && frenchCorrect) {
                resultHTML = `<div class="font-bold text-lg mb-2">ì™„ë²½í•´ìš”!! ğŸ¥³ğŸ‘‘ğŸ‘ (Parfait !!)</div><div>CorÃ©en: ${question.korean}</div><div>FranÃ§ais: ${question.french}</div>`;
                resultClass = 'correct-answer';
                launchConfetti();
            } else {
                resultHTML = `<div class="font-bold text-lg mb-2">ë•¡!! í‹€ë ¸ì–´ìš”!! ğŸ˜­ (Bip !! Faux !!)</div>${getCorrectionHTML(koreanInput, question.korean, frenchInput, question.french)}`;
                resultClass = 'wrong-answer';
            }
            resultBox.innerHTML = resultHTML;
            resultBox.className = `mt-4 p-4 rounded-lg ${resultClass}`;
            resultBox.classList.remove('hidden');
        }

        function getCorrectionHTML(koreanInput, koreanAnswer, frenchInput, frenchAnswer) {
            let koreanCorrection = koreanInput.replace(/[.?!,]/g, '') === koreanAnswer.replace(/[.?!,]/g, '') ? `<div class="text-green-700">ğŸ‡°ğŸ‡· ë‹µì•ˆ (Votre rÃ©ponse) : ${koreanInput} âœ”ï¸</div>` : `<div class="text-red-700">ğŸ‡°ğŸ‡· ë‹µì•ˆ (Votre rÃ©ponse) : ${koreanInput} âŒ</div><div class="text-slate-600">ì •ë‹µ (RÃ©ponse correcte) : ${koreanAnswer}</div>`;
            let frenchCorrection = frenchInput.toLowerCase().replace(/[.?!,']/g, '') === frenchAnswer.toLowerCase().replace(/[.?!,']/g, '') ? `<div class="text-green-700 mt-2">ğŸ‡«ğŸ‡· ë‹µì•ˆ (Votre rÃ©ponse) : ${frenchInput} âœ”ï¸</div>` : `<div class="text-red-700 mt-2">ğŸ‡«ğŸ‡· ë‹µì•ˆ (Votre rÃ©ponse) : ${frenchInput} âŒ</div><div class="text-slate-600">ì •ë‹µ (RÃ©ponse correcte) : ${frenchAnswer}</div>`;
            return `${koreanCorrection}${frenchCorrection}`;
        }

        function finishTest() {
            if (!testStarted) {
                alert("í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•œ í›„ì— ê²°ê³¼ë¥¼ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. / Vous ne pouvez envoyer les rÃ©sultats qu'aprÃ¨s avoir commencÃ© le test.");
                return;
            }
            studentData.endTime = new Date();
            const duration = Math.round((studentData.endTime - studentData.startTime) / 60000);

            const subject = `RÃ©sultats du test de corÃ©en pour ${studentData.studentId}`;
            
            let body = `
                <h1>í•œêµ­ì–´ ë“£ê¸° í‰ê°€ ê²°ê³¼ / RÃ©sultats du test de corÃ©en</h1>
                <p><strong>í•™ìƒ / Ã‰tudiant(e):</strong> ${studentData.studentId}</p>
                <p><strong>ë‚ ì§œ / Date:</strong> ${new Date().toLocaleDateString('fr-FR')}</p>
                <p><strong>ì´ ì†Œìš” ì‹œê°„ / Temps total:</strong> ${duration} minute(s)</p>
                <hr>
                <h2>ë¬¸ì œë³„ ìƒì„¸ ê²°ê³¼ / DÃ©tails par question:</h2>
                <table border="1" cellpadding="5" cellspacing="0" style="border-collapse: collapse; width: 100%;">
                    <thead>
                        <tr style="background-color: #f2f2f2;">
                            <th>ë¬¸ì œ / Question</th>
                            <th>ë“£ê¸° íšŸìˆ˜ / Nb. d'Ã©coutes</th>
                            <th>ì˜¤ë‹µ íšŸìˆ˜ / Nb. d'erreurs</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            studentData.questions.forEach(stat => {
                const questionText = questions.find(q => q.id === stat.id).korean;
                body += `
                    <tr>
                        <td>${stat.id}. ${questionText}</td>
                        <td style="text-align: center;">${stat.playCount}</td>
                        <td style="text-align: center;">${stat.wrongAttempts}</td>
                    </tr>
                `;
            });

            body += `
                    </tbody>
                </table>
            `;

            const mailtoLink = `mailto:${teacherEmail}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            
            document.getElementById('final-message').classList.remove('hidden');
            document.getElementById('action-buttons').classList.add('hidden');

            window.location.href = mailtoLink;
        }
    </script>
</body>
</html>
